(()=>{var Bo=Object.create;var Mi=Object.defineProperty;var Fo=Object.getOwnPropertyDescriptor;var ko=Object.getOwnPropertyNames;var Io=Object.getPrototypeOf,Do=Object.prototype.hasOwnProperty;var Uo=(e,n)=>()=>(n||e((n={exports:{}}).exports,n),n.exports);var Oo=(e,n,c,E)=>{if(n&&typeof n=="object"||typeof n=="function")for(let y of ko(n))!Do.call(e,y)&&y!==c&&Mi(e,y,{get:()=>n[y],enumerable:!(E=Fo(n,y))||E.enumerable});return e};var No=(e,n,c)=>(c=e!=null?Bo(Io(e)):{},Oo(n||!e||!e.__esModule?Mi(c,"default",{value:e,enumerable:!0}):c,e));var mo=Uo((Us,go)=>{var Kt=1e3,Yt=Kt*60,zt=Yt*60,Ot=zt*24,as=Ot*7,ls=Ot*365.25;go.exports=function(e,n){n=n||{};var c=typeof e;if(c==="string"&&e.length>0)return us(e);if(c==="number"&&isFinite(e))return n.long?cs(e):hs(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))};function us(e){if(e=String(e),!(e.length>100)){var n=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(n){var c=parseFloat(n[1]),E=(n[2]||"ms").toLowerCase();switch(E){case"years":case"year":case"yrs":case"yr":case"y":return c*ls;case"weeks":case"week":case"w":return c*as;case"days":case"day":case"d":return c*Ot;case"hours":case"hour":case"hrs":case"hr":case"h":return c*zt;case"minutes":case"minute":case"mins":case"min":case"m":return c*Yt;case"seconds":case"second":case"secs":case"sec":case"s":return c*Kt;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return c;default:return}}}}function hs(e){var n=Math.abs(e);return n>=Ot?Math.round(e/Ot)+"d":n>=zt?Math.round(e/zt)+"h":n>=Yt?Math.round(e/Yt)+"m":n>=Kt?Math.round(e/Kt)+"s":e+"ms"}function cs(e){var n=Math.abs(e);return n>=Ot?Tr(e,n,Ot,"day"):n>=zt?Tr(e,n,zt,"hour"):n>=Yt?Tr(e,n,Yt,"minute"):n>=Kt?Tr(e,n,Kt,"second"):e+" ms"}function Tr(e,n,c,E){var y=n>=c*1.5;return Math.round(e/c)+" "+E+(y?"s":"")}});var an=Object.defineProperty,Lo=(e,n,c)=>n in e?an(e,n,{enumerable:!0,configurable:!0,writable:!0,value:c}):e[n]=c,s=(e,n)=>an(e,"name",{value:n,configurable:!0}),_o=(e,n)=>{for(var c in n)an(e,c,{get:n[c],enumerable:!0})},ze=(e,n,c)=>(Lo(e,typeof n!="symbol"?n+"":n,c),c),Go=(()=>{for(var e=new Uint8Array(128),n=0;n<64;n++)e[n<26?n+65:n<52?n+71:n<62?n-4:n*4-205]=n;return c=>{for(var E=c.length,y=new Uint8Array((E-(c[E-1]=="=")-(c[E-2]=="="))*3/4|0),W=0,Z=0;W<E;){var O=e[c.charCodeAt(W++)],Q=e[c.charCodeAt(W++)],q=e[c.charCodeAt(W++)],se=e[c.charCodeAt(W++)];y[Z++]=O<<2|Q>>4,y[Z++]=Q<<4|q>>2,y[Z++]=q<<6|se}return y}})();function $e(e){return e*Math.PI/180}s($e,"deg2rad");function jt(e){return e*180/Math.PI}s(jt,"rad2deg");function Et(e,n,c){return n>c?Et(e,c,n):Math.min(Math.max(e,n),c)}s(Et,"clamp");function et(e,n,c){if(typeof e=="number"&&typeof n=="number")return e+(n-e)*c;if(e instanceof S&&n instanceof S||e instanceof te&&n instanceof te)return e.lerp(n,c);throw new Error(`Bad value for lerp(): ${e}, ${n}. Only number, Vec2 and Color is supported.`)}s(et,"lerp");function xr(e,n,c,E,y){return E+(e-n)/(c-n)*(y-E)}s(xr,"map");function ji(e,n,c,E,y){return Et(xr(e,n,c,E,y),E,y)}s(ji,"mapc");var Ue=class{x=0;y=0;constructor(e=0,n=e){this.x=e,this.y=n}static fromAngle(e){let n=$e(e);return new Ue(Math.cos(n),Math.sin(n))}clone(){return new Ue(this.x,this.y)}add(...e){let n=B(...e);return new Ue(this.x+n.x,this.y+n.y)}sub(...e){let n=B(...e);return new Ue(this.x-n.x,this.y-n.y)}scale(...e){let n=B(...e);return new Ue(this.x*n.x,this.y*n.y)}dist(...e){let n=B(...e);return this.sub(n).len()}sdist(...e){let n=B(...e);return this.sub(n).slen()}len(){return Math.sqrt(this.dot(this))}slen(){return this.dot(this)}unit(){let e=this.len();return e===0?new Ue(0):this.scale(1/e)}normal(){return new Ue(this.y,-this.x)}reflect(e){return this.sub(e.scale(2*this.dot(e)))}project(e){return e.scale(e.dot(this)/e.len())}reject(e){return this.sub(this.project(e))}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}angle(...e){let n=B(...e);return jt(Math.atan2(this.y-n.y,this.x-n.x))}angleBetween(...e){let n=B(...e);return jt(Math.atan2(this.cross(n),this.dot(n)))}lerp(e,n){return new Ue(et(this.x,e.x,n),et(this.y,e.y,n))}slerp(e,n){let c=this.dot(e),E=this.cross(e),y=Math.atan2(E,c);return this.scale(Math.sin((1-n)*y)).add(e.scale(Math.sin(n*y))).scale(1/E)}isZero(){return this.x===0&&this.y===0}toFixed(e){return new Ue(Number(this.x.toFixed(e)),Number(this.y.toFixed(e)))}transform(e){return e.multVec2(this)}eq(e){return this.x===e.x&&this.y===e.y}bbox(){return new xe(this,0,0)}toString(){return`vec2(${this.x.toFixed(2)}, ${this.y.toFixed(2)})`}},S=Ue;s(S,"Vec2"),ze(S,"LEFT",new Ue(-1,0)),ze(S,"RIGHT",new Ue(1,0)),ze(S,"UP",new Ue(0,-1)),ze(S,"DOWN",new Ue(0,1));function B(...e){if(e.length===1){if(e[0]instanceof S)return new S(e[0].x,e[0].y);if(Array.isArray(e[0])&&e[0].length===2)return new S(...e[0])}return new S(...e)}s(B,"vec2");var be=class{r=255;g=255;b=255;constructor(e,n,c){this.r=Et(e,0,255),this.g=Et(n,0,255),this.b=Et(c,0,255)}static fromArray(e){return new be(e[0],e[1],e[2])}static fromHex(e){if(typeof e=="number")return new be(e>>16&255,e>>8&255,e>>0&255);if(typeof e=="string"){let n=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return new be(parseInt(n[1],16),parseInt(n[2],16),parseInt(n[3],16))}else throw new Error("Invalid hex color format")}static fromHSL(e,n,c){if(n==0)return new be(255*c,255*c,255*c);let E=s((q,se,M)=>(M<0&&(M+=1),M>1&&(M-=1),M<1/6?q+(se-q)*6*M:M<1/2?se:M<2/3?q+(se-q)*(2/3-M)*6:q),"hue2rgb"),y=c<.5?c*(1+n):c+n-c*n,W=2*c-y,Z=E(W,y,e+1/3),O=E(W,y,e),Q=E(W,y,e-1/3);return new be(Math.round(Z*255),Math.round(O*255),Math.round(Q*255))}clone(){return new be(this.r,this.g,this.b)}lighten(e){return new be(this.r+e,this.g+e,this.b+e)}darken(e){return this.lighten(-e)}invert(){return new be(255-this.r,255-this.g,255-this.b)}mult(e){return new be(this.r*e.r/255,this.g*e.g/255,this.b*e.b/255)}lerp(e,n){return new be(et(this.r,e.r,n),et(this.g,e.g,n),et(this.b,e.b,n))}eq(e){return this.r===e.r&&this.g===e.g&&this.b===e.b}toString(){return`rgb(${this.r}, ${this.g}, ${this.b})`}toHex(){return"#"+((1<<24)+(this.r<<16)+(this.g<<8)+this.b).toString(16).slice(1)}},te=be;s(te,"Color"),ze(te,"RED",new be(255,0,0)),ze(te,"GREEN",new be(0,255,0)),ze(te,"BLUE",new be(0,0,255)),ze(te,"YELLOW",new be(255,255,0)),ze(te,"MAGENTA",new be(255,0,255)),ze(te,"CYAN",new be(0,255,255)),ze(te,"WHITE",new be(255,255,255)),ze(te,"BLACK",new be(0,0,0));function de(...e){if(e.length===0)return new te(255,255,255);if(e.length===1){if(e[0]instanceof te)return e[0].clone();if(typeof e[0]=="string")return te.fromHex(e[0]);if(Array.isArray(e[0])&&e[0].length===3)return te.fromArray(e[0])}return new te(...e)}s(de,"rgb");var Wo=s((e,n,c)=>te.fromHSL(e,n,c),"hsl2rgb"),ye=class{x=0;y=0;w=1;h=1;constructor(e,n,c,E){this.x=e,this.y=n,this.w=c,this.h=E}scale(e){return new ye(this.x+this.w*e.x,this.y+this.h*e.y,this.w*e.w,this.h*e.h)}pos(){return new S(this.x,this.y)}clone(){return new ye(this.x,this.y,this.w,this.h)}eq(e){return this.x===e.x&&this.y===e.y&&this.w===e.w&&this.h===e.h}toString(){return`quad(${this.x}, ${this.y}, ${this.w}, ${this.h})`}};s(ye,"Quad");function ve(e,n,c,E){return new ye(e,n,c,E)}s(ve,"quad");var Ve=class{m=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];constructor(e){e&&(this.m=e)}static translate(e){return new Ve([1,0,0,0,0,1,0,0,0,0,1,0,e.x,e.y,0,1])}static scale(e){return new Ve([e.x,0,0,0,0,e.y,0,0,0,0,1,0,0,0,0,1])}static rotateX(e){e=$e(-e);let n=Math.cos(e),c=Math.sin(e);return new Ve([1,0,0,0,0,n,-c,0,0,c,n,0,0,0,0,1])}static rotateY(e){e=$e(-e);let n=Math.cos(e),c=Math.sin(e);return new Ve([n,0,c,0,0,1,0,0,-c,0,n,0,0,0,0,1])}static rotateZ(e){e=$e(-e);let n=Math.cos(e),c=Math.sin(e);return new Ve([n,-c,0,0,c,n,0,0,0,0,1,0,0,0,0,1])}translate(e){return this.m[12]+=this.m[0]*e.x+this.m[4]*e.y,this.m[13]+=this.m[1]*e.x+this.m[5]*e.y,this.m[14]+=this.m[2]*e.x+this.m[6]*e.y,this.m[15]+=this.m[3]*e.x+this.m[7]*e.y,this}scale(e){return this.m[0]*=e.x,this.m[4]*=e.y,this.m[1]*=e.x,this.m[5]*=e.y,this.m[2]*=e.x,this.m[6]*=e.y,this.m[3]*=e.x,this.m[7]*=e.y,this}rotate(e){e=$e(-e);let n=Math.cos(e),c=Math.sin(e),E=this.m[0],y=this.m[1],W=this.m[4],Z=this.m[5];return this.m[0]=E*n+y*c,this.m[1]=-E*c+y*n,this.m[4]=W*n+Z*c,this.m[5]=-W*c+Z*n,this}mult(e){let n=[];for(let c=0;c<4;c++)for(let E=0;E<4;E++)n[c*4+E]=this.m[0*4+E]*e.m[c*4+0]+this.m[1*4+E]*e.m[c*4+1]+this.m[2*4+E]*e.m[c*4+2]+this.m[3*4+E]*e.m[c*4+3];return new Ve(n)}multVec2(e){return new S(e.x*this.m[0]+e.y*this.m[4]+this.m[12],e.x*this.m[1]+e.y*this.m[5]+this.m[13])}getTranslation(){return new S(this.m[12],this.m[13])}getScale(){if(this.m[0]!=0||this.m[1]!=0){let e=this.m[0]*this.m[5]-this.m[1]*this.m[4],n=Math.sqrt(this.m[0]*this.m[0]+this.m[1]*this.m[1]);return new S(n,e/n)}else if(this.m[4]!=0||this.m[5]!=0){let e=this.m[0]*this.m[5]-this.m[1]*this.m[4],n=Math.sqrt(this.m[4]*this.m[4]+this.m[5]*this.m[5]);return new S(e/n,n)}else return new S(0,0)}getRotation(){if(this.m[0]!=0||this.m[1]!=0){let e=Math.sqrt(this.m[0]*this.m[0]+this.m[1]*this.m[1]);return jt(this.m[1]>0?Math.acos(this.m[0]/e):-Math.acos(this.m[0]/e))}else if(this.m[4]!=0||this.m[5]!=0){let e=Math.sqrt(this.m[4]*this.m[4]+this.m[5]*this.m[5]);return jt(Math.PI/2-(this.m[5]>0?Math.acos(-this.m[4]/e):-Math.acos(this.m[4]/e)))}else return 0}getSkew(){if(this.m[0]!=0||this.m[1]!=0){let e=Math.sqrt(this.m[0]*this.m[0]+this.m[1]*this.m[1]);return new S(Math.atan(this.m[0]*this.m[4]+this.m[1]*this.m[5])/(e*e),0)}else if(this.m[4]!=0||this.m[5]!=0){let e=Math.sqrt(this.m[4]*this.m[4]+this.m[5]*this.m[5]);return new S(0,Math.atan(this.m[0]*this.m[4]+this.m[1]*this.m[5])/(e*e))}else return new S(0,0)}invert(){let e=[],n=this.m[10]*this.m[15]-this.m[14]*this.m[11],c=this.m[9]*this.m[15]-this.m[13]*this.m[11],E=this.m[9]*this.m[14]-this.m[13]*this.m[10],y=this.m[8]*this.m[15]-this.m[12]*this.m[11],W=this.m[8]*this.m[14]-this.m[12]*this.m[10],Z=this.m[8]*this.m[13]-this.m[12]*this.m[9],O=this.m[6]*this.m[15]-this.m[14]*this.m[7],Q=this.m[5]*this.m[15]-this.m[13]*this.m[7],q=this.m[5]*this.m[14]-this.m[13]*this.m[6],se=this.m[4]*this.m[15]-this.m[12]*this.m[7],M=this.m[4]*this.m[14]-this.m[12]*this.m[6],ae=this.m[5]*this.m[15]-this.m[13]*this.m[7],d=this.m[4]*this.m[13]-this.m[12]*this.m[5],ne=this.m[6]*this.m[11]-this.m[10]*this.m[7],He=this.m[5]*this.m[11]-this.m[9]*this.m[7],ke=this.m[5]*this.m[10]-this.m[9]*this.m[6],b=this.m[4]*this.m[11]-this.m[8]*this.m[7],le=this.m[4]*this.m[10]-this.m[8]*this.m[6],C=this.m[4]*this.m[9]-this.m[8]*this.m[5];e[0]=this.m[5]*n-this.m[6]*c+this.m[7]*E,e[4]=-(this.m[4]*n-this.m[6]*y+this.m[7]*W),e[8]=this.m[4]*c-this.m[5]*y+this.m[7]*Z,e[12]=-(this.m[4]*E-this.m[5]*W+this.m[6]*Z),e[1]=-(this.m[1]*n-this.m[2]*c+this.m[3]*E),e[5]=this.m[0]*n-this.m[2]*y+this.m[3]*W,e[9]=-(this.m[0]*c-this.m[1]*y+this.m[3]*Z),e[13]=this.m[0]*E-this.m[1]*W+this.m[2]*Z,e[2]=this.m[1]*O-this.m[2]*Q+this.m[3]*q,e[6]=-(this.m[0]*O-this.m[2]*se+this.m[3]*M),e[10]=this.m[0]*ae-this.m[1]*se+this.m[3]*d,e[14]=-(this.m[0]*q-this.m[1]*M+this.m[2]*d),e[3]=-(this.m[1]*ne-this.m[2]*He+this.m[3]*ke),e[7]=this.m[0]*ne-this.m[2]*b+this.m[3]*le,e[11]=-(this.m[0]*He-this.m[1]*b+this.m[3]*C),e[15]=this.m[0]*ke-this.m[1]*le+this.m[2]*C;let k=this.m[0]*e[0]+this.m[1]*e[4]+this.m[2]*e[8]+this.m[3]*e[12];for(let I=0;I<4;I++)for(let J=0;J<4;J++)e[I*4+J]*=1/k;return new Ve(e)}clone(){return new Ve([...this.m])}toString(){return this.m.toString()}};s(Ve,"Mat4");function nn(e,n,c,E=Math.sin){return e+(E(c)+1)/2*(n-e)}s(nn,"wave");var qo=1103515245,Ho=12345,Pi=2147483648,ln=class{seed;constructor(e){this.seed=e}gen(){return this.seed=(qo*this.seed+Ho)%Pi,this.seed/Pi}genNumber(e,n){return e+this.gen()*(n-e)}genVec2(e,n){return new S(this.genNumber(e.x,n.x),this.genNumber(e.y,n.y))}genColor(e,n){return new te(this.genNumber(e.r,n.r),this.genNumber(e.g,n.g),this.genNumber(e.b,n.b))}genAny(...e){if(e.length===0)return this.gen();if(e.length===1){if(typeof e[0]=="number")return this.genNumber(0,e[0]);if(e[0]instanceof S)return this.genVec2(B(0,0),e[0]);if(e[0]instanceof te)return this.genColor(de(0,0,0),e[0])}else if(e.length===2){if(typeof e[0]=="number"&&typeof e[1]=="number")return this.genNumber(e[0],e[1]);if(e[0]instanceof S&&e[1]instanceof S)return this.genVec2(e[0],e[1]);if(e[0]instanceof te&&e[1]instanceof te)return this.genColor(e[0],e[1])}}};s(ln,"RNG");var on=new ln(Date.now());function Ki(e){return e!=null&&(on.seed=e),on.seed}s(Ki,"randSeed");function sr(...e){return on.genAny(...e)}s(sr,"rand");function un(...e){return Math.floor(sr(...e))}s(un,"randi");function Yi(e){return sr()<=e}s(Yi,"chance");function zi(e){return e[un(e.length)]}s(zi,"choose");function Qi(e,n){return e.pos.x+e.width>n.pos.x&&e.pos.x<n.pos.x+n.width&&e.pos.y+e.height>n.pos.y&&e.pos.y<n.pos.y+n.height}s(Qi,"testRectRect");function Ji(e,n){if(e.p1.x===e.p2.x&&e.p1.y===e.p2.y||n.p1.x===n.p2.x&&n.p1.y===n.p2.y)return null;let c=(n.p2.y-n.p1.y)*(e.p2.x-e.p1.x)-(n.p2.x-n.p1.x)*(e.p2.y-e.p1.y);if(c===0)return null;let E=((n.p2.x-n.p1.x)*(e.p1.y-n.p1.y)-(n.p2.y-n.p1.y)*(e.p1.x-n.p1.x))/c,y=((e.p2.x-e.p1.x)*(e.p1.y-n.p1.y)-(e.p2.y-e.p1.y)*(e.p1.x-n.p1.x))/c;return E<0||E>1||y<0||y>1?null:E}s(Ji,"testLineLineT");function qt(e,n){let c=Ji(e,n);return c?B(e.p1.x+c*(e.p2.x-e.p1.x),e.p1.y+c*(e.p2.y-e.p1.y)):null}s(qt,"testLineLine");function Xi(e,n){if(ar(e,n.p1)||ar(e,n.p2))return!0;let c=e.points();return!!qt(n,new ht(c[0],c[1]))||!!qt(n,new ht(c[1],c[2]))||!!qt(n,new ht(c[2],c[3]))||!!qt(n,new ht(c[3],c[0]))}s(Xi,"testRectLine");function ar(e,n){return n.x>e.pos.x&&n.x<e.pos.x+e.width&&n.y>e.pos.y&&n.y<e.pos.y+e.height}s(ar,"testRectPoint");function Zi(e,n){let c=n.sub(e.p1),E=e.p2.sub(e.p1);if(Math.abs(c.cross(E))>Number.EPSILON)return!1;let y=c.dot(E)/E.dot(E);return y>=0&&y<=1}s(Zi,"testLinePoint");function hn(e,n){let c=e.p2.sub(e.p1),E=c.dot(c),y=e.p1.sub(n.center),W=2*c.dot(y),Z=y.dot(y)-n.radius*n.radius,O=W*W-4*E*Z;if(E<=Number.EPSILON||O<0)return!1;if(O==0){let Q=-W/(2*E);if(Q>=0&&Q<=1)return!0}else{let Q=(-W+Math.sqrt(O))/(2*E),q=(-W-Math.sqrt(O))/(2*E);if(Q>=0&&Q<=1||q>=0&&q<=1)return!0}return cn(n,e.p1)}s(hn,"testLineCircle");function cn(e,n){return e.center.sdist(n)<e.radius*e.radius}s(cn,"testCirclePoint");function $i(e,n){let c=n.pts[n.pts.length-1];for(let E of n.pts){if(hn(new ht(c,E),e))return!0;c=E}return cn(e,n.pts[0])?!0:dn(n,e.center)}s($i,"testCirclePolygon");function dn(e,n){let c=!1,E=e.pts;for(let y=0,W=E.length-1;y<E.length;W=y++)E[y].y>n.y!=E[W].y>n.y&&n.x<(E[W].x-E[y].x)*(n.y-E[y].y)/(E[W].y-E[y].y)+E[y].x&&(c=!c);return c}s(dn,"testPolygonPoint");var ht=class{p1;p2;constructor(e,n){this.p1=e.clone(),this.p2=n.clone()}transform(e){return new ht(e.multVec2(this.p1),e.multVec2(this.p2))}bbox(){return xe.fromPoints(this.p1,this.p2)}area(){return this.p1.dist(this.p2)}clone(){return new ht(this.p1,this.p2)}};s(ht,"Line");var xe=class{pos;width;height;constructor(e,n,c){this.pos=e.clone(),this.width=n,this.height=c}static fromPoints(e,n){return new xe(e.clone(),n.x-e.x,n.y-e.y)}center(){return new S(this.pos.x+this.width/2,this.pos.y+this.height/2)}points(){return[this.pos,this.pos.add(this.width,0),this.pos.add(this.width,this.height),this.pos.add(0,this.height)]}transform(e){return new Ut(this.points().map(n=>e.multVec2(n)))}bbox(){return this.clone()}area(){return this.width*this.height}clone(){return new xe(this.pos.clone(),this.width,this.height)}distToPoint(e){return Math.sqrt(this.sdistToPoint(e))}sdistToPoint(e){let n=this.pos,c=this.pos.add(this.width,this.height),E=Math.max(n.x-e.x,0,e.x-c.x),y=Math.max(n.y-e.y,0,e.y-c.y);return E*E+y*y}};s(xe,"Rect");var Sr=class{center;radius;constructor(e,n){this.center=e.clone(),this.radius=n}transform(e){return new Mr(this.center,this.radius,this.radius).transform(e)}bbox(){return xe.fromPoints(this.center.sub(B(this.radius)),this.center.add(B(this.radius)))}area(){return this.radius*this.radius*Math.PI}clone(){return new Sr(this.center,this.radius)}};s(Sr,"Circle");var Mr=class{center;radiusX;radiusY;constructor(e,n,c){this.center=e.clone(),this.radiusX=n,this.radiusY=c}transform(e){return new Mr(e.multVec2(this.center),e.m[0]*this.radiusX,e.m[5]*this.radiusY)}bbox(){return xe.fromPoints(this.center.sub(B(this.radiusX,this.radiusY)),this.center.add(B(this.radiusX,this.radiusY)))}area(){return this.radiusX*this.radiusY*Math.PI}clone(){return new Mr(this.center,this.radiusX,this.radiusY)}};s(Mr,"Ellipse");var Ut=class{pts;constructor(e){if(e.length<3)throw new Error("Polygons should have at least 3 vertices");this.pts=e}transform(e){return new Ut(this.pts.map(n=>e.multVec2(n)))}bbox(){let e=B(Number.MAX_VALUE),n=B(-Number.MAX_VALUE);for(let c of this.pts)e.x=Math.min(e.x,c.x),n.x=Math.max(n.x,c.x),e.y=Math.min(e.y,c.y),n.y=Math.max(n.y,c.y);return xe.fromPoints(e,n)}area(){let e=0,n=this.pts.length;for(let c=0;c<n;c++){let E=this.pts[c],y=this.pts[(c+1)%n];e+=E.x*y.y*.5,e-=y.x*E.y*.5}return Math.abs(e)}clone(){return new Ut(this.pts.map(e=>e.clone()))}};s(Ut,"Polygon");function eo(e,n){let c=Number.MAX_VALUE,E=B(0);for(let y of[e,n])for(let W=0;W<y.pts.length;W++){let Z=y.pts[W],O=y.pts[(W+1)%y.pts.length].sub(Z).normal().unit(),Q=Number.MAX_VALUE,q=-Number.MAX_VALUE;for(let d=0;d<e.pts.length;d++){let ne=e.pts[d].dot(O);Q=Math.min(Q,ne),q=Math.max(q,ne)}let se=Number.MAX_VALUE,M=-Number.MAX_VALUE;for(let d=0;d<n.pts.length;d++){let ne=n.pts[d].dot(O);se=Math.min(se,ne),M=Math.max(M,ne)}let ae=Math.min(q,M)-Math.max(Q,se);if(ae<0)return null;if(ae<Math.abs(c)){let d=M-Q,ne=se-q;c=Math.abs(d)<Math.abs(ne)?d:ne,E=O.scale(c)}}return E}s(eo,"sat");var pn=class extends Map{lastID;constructor(...e){super(...e),this.lastID=0}push(e){let n=this.lastID;return this.set(n,e),this.lastID++,n}pushd(e){let n=this.push(e);return()=>this.delete(n)}};s(pn,"IDList");var Vt=class{paused=!1;cancel;constructor(e){this.cancel=e}static join(e){let n=new Vt(()=>e.forEach(c=>c.cancel()));return Object.defineProperty(n,"paused",{get:()=>e[0].paused,set:c=>e.forEach(E=>E.paused=c)}),n.paused=!1,n}};s(Vt,"EventController");var Ye=class{handlers=new pn;add(e){let n=this.handlers.pushd((...E)=>{c.paused||e(...E)}),c=new Vt(n);return c}addOnce(e){let n=this.add((...c)=>{n.cancel(),e(...c)});return n}next(){return new Promise(e=>this.addOnce(e))}trigger(...e){this.handlers.forEach(n=>n(...e))}numListeners(){return this.handlers.size}};s(Ye,"Event");var Ht=class{handlers={};on(e,n){return this.handlers[e]||(this.handlers[e]=new Ye),this.handlers[e].add(n)}onOnce(e,n){let c=this.on(e,(...E)=>{c.cancel(),n(...E)});return c}next(e){return new Promise(n=>{this.onOnce(e,(...c)=>n(c[0]))})}trigger(e,...n){this.handlers[e]&&this.handlers[e].trigger(...n)}remove(e){delete this.handlers[e]}clear(){this.handlers={}}numListeners(e){return this.handlers[e]?.numListeners()??0}};s(Ht,"EventHandler");function fn(e,n){let c=typeof e,E=typeof n;if(c!==E)return!1;if(c==="object"&&E==="object"&&e!==null&&n!==null){let y=Object.keys(e),W=Object.keys(n);if(y.length!==W.length)return!1;for(let Z of y){let O=e[Z],Q=n[Z];if(!(typeof O=="function"&&typeof Q=="function")&&!fn(O,Q))return!1}return!0}return e===n}s(fn,"deepEq");function to(e){let n=window.atob(e),c=n.length,E=new Uint8Array(c);for(let y=0;y<c;y++)E[y]=n.charCodeAt(y);return E.buffer}s(to,"base64ToArrayBuffer");function ro(e){return to(e.split(",")[1])}s(ro,"dataURLToArrayBuffer");function Pr(e,n){let c=document.createElement("a");c.href=n,c.download=e,c.click()}s(Pr,"download");function gn(e,n){Pr(e,"data:text/plain;charset=utf-8,"+n)}s(gn,"downloadText");function no(e,n){gn(e,JSON.stringify(n))}s(no,"downloadJSON");function sn(e,n){let c=URL.createObjectURL(n);Pr(e,c),URL.revokeObjectURL(c)}s(sn,"downloadBlob");var Ti=s(e=>e.match(/^data:\w+\/\w+;base64,.+/),"isDataURL"),jo=s(e=>e.split(".").pop(),"getExt"),Ko=(()=>{let e=0;return()=>e++})(),io=class{_items;_compareFn;constructor(e=(n,c)=>n<c){this._compareFn=e,this._items=[]}insert(e){this._items.push(e),this.moveUp(this._items.length-1)}remove(){if(this._items.length===0)return null;let e=this._items[0],n=this._items.pop();return this._items.length!==0&&(this._items[0]=n,this.moveDown(0)),e}clear(){this._items.splice(0,this._items.length)}moveUp(e){for(;e>0;){let n=Math.floor((e-1)/2);if(!this._compareFn(this._items[e],this._items[n])&&this._items[e]>=this._items[n])break;this.swap(e,n),e=n}}moveDown(e){for(;e<Math.floor(this._items.length/2);){let n=2*e+1;if(n<this._items.length-1&&!this._compareFn(this._items[n],this._items[n+1])&&++n,this._compareFn(this._items[e],this._items[n]))break;this.swap(e,n),e=n}}swap(e,n){[this._items[e],this._items[n]]=[this._items[n],this._items[e]]}get length(){return this._items.length}};s(io,"BinaryHeap");var Ri={"Joy-Con L+R (STANDARD GAMEPAD Vendor: 057e Product: 200e)":{buttons:{0:"south",1:"east",2:"west",3:"north",4:"lshoulder",5:"rshoulder",6:"ltrigger",7:"rtrigger",8:"select",9:"start",10:"lstick",11:"rstick",12:"dpad-up",13:"dpad-down",14:"dpad-left",15:"dpad-right",16:"home",17:"capture"},sticks:{left:{x:0,y:1},right:{x:2,y:3}}},"Joy-Con (L) (STANDARD GAMEPAD Vendor: 057e Product: 2006)":{buttons:{0:"south",1:"east",2:"west",3:"north",4:"lshoulder",5:"rshoulder",9:"select",10:"lstick",16:"start"},sticks:{left:{x:0,y:1}}},"Joy-Con (R) (STANDARD GAMEPAD Vendor: 057e Product: 2007)":{buttons:{0:"south",1:"east",2:"west",3:"north",4:"lshoulder",5:"rshoulder",9:"start",10:"lstick",16:"select"},sticks:{left:{x:0,y:1}}},"Pro Controller (STANDARD GAMEPAD Vendor: 057e Product: 2009)":{buttons:{0:"south",1:"east",2:"west",3:"north",4:"lshoulder",5:"rshoulder",6:"ltrigger",7:"rtrigger",8:"select",9:"start",10:"lstick",11:"rstick",12:"dpad-up",13:"dpad-down",14:"dpad-left",15:"dpad-right",16:"home",17:"capture"},sticks:{left:{x:0,y:1},right:{x:2,y:3}}},default:{buttons:{0:"south",1:"east",2:"west",3:"north",4:"lshoulder",5:"rshoulder",6:"ltrigger",7:"rtrigger",8:"select",9:"start",10:"lstick",11:"rstick",12:"dpad-up",13:"dpad-down",14:"dpad-left",15:"dpad-right",16:"home"},sticks:{left:{x:0,y:1},right:{x:2,y:3}}}},or=class{pressed=new Set([]);pressedRepeat=new Set([]);released=new Set([]);down=new Set([]);update(){this.pressed.clear(),this.released.clear(),this.pressedRepeat.clear()}press(e){this.pressed.add(e),this.pressedRepeat.add(e),this.down.add(e)}pressRepeat(e){this.pressedRepeat.add(e)}release(e){this.down.delete(e),this.pressed.delete(e),this.released.add(e)}};s(or,"ButtonState");var oo=class{buttonState=new or;stickState=new Map};s(oo,"GamepadState");var so=class{dts=[];timer=0;fps=0;tick(e){this.dts.push(e),this.timer+=e,this.timer>=1&&(this.timer=0,this.fps=Math.round(1/(this.dts.reduce((n,c)=>n+c)/this.dts.length)),this.dts=[])}};s(so,"FPSCounter");var Yo=s(e=>{if(!e.canvas)throw new Error("Please provide a canvas");let n={canvas:e.canvas,loopID:null,stopped:!1,dt:0,time:0,realTime:0,fpsCounter:new so,timeScale:1,skipTime:!1,numFrames:0,paused:!1,mousePos:new S(0),mouseDeltaPos:new S(0),keyState:new or,mouseState:new or,mergedGamepadState:new oo,gamepadStates:new Map,gamepads:[],charInputted:[],isMouseMoved:!1,lastWidth:e.canvas.offsetWidth,lastHeight:e.canvas.offsetHeight,events:new Ht};function c(){return n.canvas}s(c,"canvas");function E(){return n.dt*n.timeScale}s(E,"dt");function y(){return n.time}s(y,"time");function W(){return n.fpsCounter.fps}s(W,"fps");function Z(){return n.numFrames}s(Z,"numFrames");function O(){return n.canvas.toDataURL()}s(O,"screenshot");function Q(h){n.canvas.style.cursor=h}s(Q,"setCursor");function q(){return n.canvas.style.cursor}s(q,"getCursor");function se(h){if(h)try{let v=n.canvas.requestPointerLock();v.catch&&v.catch(P=>console.error(P))}catch(v){console.error(v)}else document.exitPointerLock()}s(se,"setCursorLocked");function M(){return!!document.pointerLockElement}s(M,"isCursorLocked");function ae(h){h.requestFullscreen?h.requestFullscreen():h.webkitRequestFullscreen&&h.webkitRequestFullscreen()}s(ae,"enterFullscreen");function d(){document.exitFullscreen?document.exitFullscreen():document.webkitExitFullScreen&&document.webkitExitFullScreen()}s(d,"exitFullscreen");function ne(){return document.fullscreenElement||document.webkitFullscreenElement}s(ne,"getFullscreenElement");function He(h=!0){h?ae(n.canvas):d()}s(He,"setFullscreen");function ke(){return!!ne()}s(ke,"isFullscreen");function b(){n.stopped=!0;for(let h in m)n.canvas.removeEventListener(h,m[h]);for(let h in V)document.removeEventListener(h,V[h]);for(let h in F)window.removeEventListener(h,F[h]);De.disconnect()}s(b,"quit");function le(h){n.loopID!==null&&cancelAnimationFrame(n.loopID);let v=0,P=s(H=>{if(n.stopped)return;if(n.paused||document.visibilityState!=="visible"){n.loopID=requestAnimationFrame(P);return}let K=H/1e3,ge=K-n.realTime,Me=e.maxFPS?1/e.maxFPS:0;n.realTime=K,v+=ge,v>Me&&(n.skipTime||(n.dt=v,n.time+=E(),n.fpsCounter.tick(n.dt)),v=0,n.skipTime=!1,n.numFrames++,wt(),h(),Ct()),n.loopID=requestAnimationFrame(P)},"frame");P(0)}s(le,"run");function C(){return"ontouchstart"in window||navigator.maxTouchPoints>0}s(C,"isTouchscreen");function k(){return n.mousePos.clone()}s(k,"mousePos");function I(){return n.mouseDeltaPos.clone()}s(I,"mouseDeltaPos");function J(h="left"){return n.mouseState.pressed.has(h)}s(J,"isMousePressed");function L(h="left"){return n.mouseState.down.has(h)}s(L,"isMouseDown");function R(h="left"){return n.mouseState.released.has(h)}s(R,"isMouseReleased");function Oe(){return n.isMouseMoved}s(Oe,"isMouseMoved");function Ne(h){return h===void 0?n.keyState.pressed.size>0:n.keyState.pressed.has(h)}s(Ne,"isKeyPressed");function Qe(h){return h===void 0?n.keyState.pressedRepeat.size>0:n.keyState.pressedRepeat.has(h)}s(Qe,"isKeyPressedRepeat");function Le(h){return h===void 0?n.keyState.down.size>0:n.keyState.down.has(h)}s(Le,"isKeyDown");function Je(h){return h===void 0?n.keyState.released.size>0:n.keyState.released.has(h)}s(Je,"isKeyReleased");function tt(h){return h===void 0?n.mergedGamepadState.buttonState.pressed.size>0:n.mergedGamepadState.buttonState.pressed.has(h)}s(tt,"isGamepadButtonPressed");function rt(h){return h===void 0?n.mergedGamepadState.buttonState.down.size>0:n.mergedGamepadState.buttonState.down.has(h)}s(rt,"isGamepadButtonDown");function Ze(h){return h===void 0?n.mergedGamepadState.buttonState.released.size>0:n.mergedGamepadState.buttonState.released.has(h)}s(Ze,"isGamepadButtonReleased");function ct(h){return n.events.on("resize",h)}s(ct,"onResize");let nt=s((h,v)=>{if(typeof h=="function")return n.events.on("keyDown",h);if(typeof h=="string"&&typeof v=="function")return n.events.on("keyDown",P=>P===h&&v(h))},"onKeyDown"),Nt=s((h,v)=>{if(typeof h=="function")return n.events.on("keyPress",h);if(typeof h=="string"&&typeof v=="function")return n.events.on("keyPress",P=>P===h&&v(h))},"onKeyPress"),it=s((h,v)=>{if(typeof h=="function")return n.events.on("keyPressRepeat",h);if(typeof h=="string"&&typeof v=="function")return n.events.on("keyPressRepeat",P=>P===h&&v(h))},"onKeyPressRepeat"),dt=s((h,v)=>{if(typeof h=="function")return n.events.on("keyRelease",h);if(typeof h=="string"&&typeof v=="function")return n.events.on("keyRelease",P=>P===h&&v(h))},"onKeyRelease");function pt(h,v){return typeof h=="function"?n.events.on("mouseDown",P=>h(P)):n.events.on("mouseDown",P=>P===h&&v(P))}s(pt,"onMouseDown");function ot(h,v){return typeof h=="function"?n.events.on("mousePress",P=>h(P)):n.events.on("mousePress",P=>P===h&&v(P))}s(ot,"onMousePress");function _e(h,v){return typeof h=="function"?n.events.on("mouseRelease",P=>h(P)):n.events.on("mouseRelease",P=>P===h&&v(P))}s(_e,"onMouseRelease");function Xe(h){return n.events.on("mouseMove",()=>h(k(),I()))}s(Xe,"onMouseMove");function xt(h){return n.events.on("charInput",h)}s(xt,"onCharInput");function St(h){return n.events.on("touchStart",h)}s(St,"onTouchStart");function we(h){return n.events.on("touchMove",h)}s(we,"onTouchMove");function Mt(h){return n.events.on("touchEnd",h)}s(Mt,"onTouchEnd");function Pt(h){return n.events.on("scroll",h)}s(Pt,"onScroll");function Ee(h,v){if(typeof h=="function")return n.events.on("gamepadButtonDown",h);if(typeof h=="string"&&typeof v=="function")return n.events.on("gamepadButtonDown",P=>P===h&&v(h))}s(Ee,"onGamepadButtonDown");function ft(h,v){if(typeof h=="function")return n.events.on("gamepadButtonPress",h);if(typeof h=="string"&&typeof v=="function")return n.events.on("gamepadButtonPress",P=>P===h&&v(h))}s(ft,"onGamepadButtonPress");function gt(h,v){if(typeof h=="function")return n.events.on("gamepadButtonRelease",h);if(typeof h=="string"&&typeof v=="function")return n.events.on("gamepadButtonRelease",P=>P===h&&v(h))}s(gt,"onGamepadButtonRelease");function mt(h,v){return n.events.on("gamepadStick",(P,H)=>P===h&&v(H))}s(mt,"onGamepadStick");function je(h){n.events.on("gamepadConnect",h)}s(je,"onGamepadConnect");function Tt(h){n.events.on("gamepadDisconnect",h)}s(Tt,"onGamepadDisconnect");function Ge(h){return n.mergedGamepadState.stickState.get(h)||new S(0)}s(Ge,"getGamepadStick");function Rt(){return[...n.charInputted]}s(Rt,"charInputted");function Ie(){return[...n.gamepads]}s(Ie,"getGamepads");function wt(){n.events.trigger("input"),n.keyState.down.forEach(h=>n.events.trigger("keyDown",h)),n.mouseState.down.forEach(h=>n.events.trigger("mouseDown",h)),w()}s(wt,"processInput");function Ct(){n.keyState.update(),n.mouseState.update(),n.mergedGamepadState.buttonState.update(),n.mergedGamepadState.stickState.forEach((h,v)=>{n.mergedGamepadState.stickState.set(v,new S(0))}),n.charInputted=[],n.isMouseMoved=!1,n.gamepadStates.forEach(h=>{h.buttonState.update(),h.stickState.forEach((v,P)=>{h.stickState.set(P,new S(0))})})}s(Ct,"resetInput");function Ke(h){let v={index:h.index,isPressed:P=>n.gamepadStates.get(h.index).buttonState.pressed.has(P),isDown:P=>n.gamepadStates.get(h.index).buttonState.down.has(P),isReleased:P=>n.gamepadStates.get(h.index).buttonState.released.has(P),getStick:P=>n.gamepadStates.get(h.index).stickState.get(P)};return n.gamepads.push(v),n.gamepadStates.set(h.index,{buttonState:new or,stickState:new Map([["left",new S(0)],["right",new S(0)]])}),v}s(Ke,"registerGamepad");function At(h){n.gamepads=n.gamepads.filter(v=>v.index!==h.index),n.gamepadStates.delete(h.index)}s(At,"removeGamepad");function w(){for(let h of navigator.getGamepads())h&&!n.gamepadStates.has(h.index)&&Ke(h);for(let h of n.gamepads){let v=navigator.getGamepads()[h.index],P=(e.gamepads??{})[v.id]??Ri[v.id]??Ri.default,H=n.gamepadStates.get(h.index);for(let K=0;K<v.buttons.length;K++)v.buttons[K].pressed?(H.buttonState.down.has(P.buttons[K])||(n.mergedGamepadState.buttonState.press(P.buttons[K]),H.buttonState.press(P.buttons[K]),n.events.trigger("gamepadButtonPress",P.buttons[K])),n.events.trigger("gamepadButtonDown",P.buttons[K])):H.buttonState.down.has(P.buttons[K])&&(n.mergedGamepadState.buttonState.release(P.buttons[K]),H.buttonState.release(P.buttons[K]),n.events.trigger("gamepadButtonRelease",P.buttons[K]));for(let K in P.sticks){let ge=P.sticks[K],Me=new S(v.axes[ge.x],v.axes[ge.y]);H.stickState.set(K,Me),n.mergedGamepadState.stickState.set(K,Me),n.events.trigger("gamepadStick",K,Me)}}}s(w,"processGamepad");let m={},V={},F={};m.mousemove=h=>{let v=new S(h.offsetX,h.offsetY),P=new S(h.movementX,h.movementY);n.events.onOnce("input",()=>{n.isMouseMoved=!0,n.mousePos=v,n.mouseDeltaPos=P,n.events.trigger("mouseMove")})};let X=["left","middle","right","back","forward"];m.mousedown=h=>{n.events.onOnce("input",()=>{let v=X[h.button];v&&(n.mouseState.press(v),n.events.trigger("mousePress",v))})},m.mouseup=h=>{n.events.onOnce("input",()=>{let v=X[h.button];v&&(n.mouseState.release(v),n.events.trigger("mouseRelease",v))})};let Ce=new Set([" ","ArrowLeft","ArrowRight","ArrowUp","ArrowDown","Tab"]),G={ArrowLeft:"left",ArrowRight:"right",ArrowUp:"up",ArrowDown:"down"," ":"space"};m.keydown=h=>{Ce.has(h.key)&&h.preventDefault(),n.events.onOnce("input",()=>{let v=G[h.key]||h.key.toLowerCase();v.length===1?(n.events.trigger("charInput",v),n.charInputted.push(v)):v==="space"&&(n.events.trigger("charInput"," "),n.charInputted.push(" ")),h.repeat?(n.keyState.pressRepeat(v),n.events.trigger("keyPressRepeat",v)):(n.keyState.press(v),n.events.trigger("keyPressRepeat",v),n.events.trigger("keyPress",v))})},m.keyup=h=>{n.events.onOnce("input",()=>{let v=G[h.key]||h.key.toLowerCase();n.keyState.release(v),n.events.trigger("keyRelease",v)})},m.touchstart=h=>{h.preventDefault(),n.events.onOnce("input",()=>{let v=[...h.changedTouches],P=n.canvas.getBoundingClientRect();e.touchToMouse!==!1&&(n.mousePos=new S(v[0].clientX-P.x,v[0].clientY-P.y),n.mouseState.press("left"),n.events.trigger("mousePress","left")),v.forEach(H=>{n.events.trigger("touchStart",new S(H.clientX-P.x,H.clientY-P.y),H)})})},m.touchmove=h=>{h.preventDefault(),n.events.onOnce("input",()=>{let v=[...h.changedTouches],P=n.canvas.getBoundingClientRect();e.touchToMouse!==!1&&(n.mousePos=new S(v[0].clientX-P.x,v[0].clientY-P.y),n.events.trigger("mouseMove")),v.forEach(H=>{n.events.trigger("touchMove",new S(H.clientX-P.x,H.clientY-P.y),H)})})},m.touchend=h=>{n.events.onOnce("input",()=>{let v=[...h.changedTouches],P=n.canvas.getBoundingClientRect();e.touchToMouse!==!1&&(n.mousePos=new S(v[0].clientX-P.x,v[0].clientY-P.y),n.mouseState.release("left"),n.events.trigger("mouseRelease","left")),v.forEach(H=>{n.events.trigger("touchEnd",new S(H.clientX-P.x,H.clientY-P.y),H)})})},m.touchcancel=h=>{n.events.onOnce("input",()=>{let v=[...h.changedTouches],P=n.canvas.getBoundingClientRect();e.touchToMouse!==!1&&(n.mousePos=new S(v[0].clientX-P.x,v[0].clientY-P.y),n.mouseState.release("left"),n.events.trigger("mouseRelease","left")),v.forEach(H=>{n.events.trigger("touchEnd",new S(H.clientX-P.x,H.clientY-P.y),H)})})},m.wheel=h=>{h.preventDefault(),n.events.onOnce("input",()=>{n.events.trigger("scroll",new S(h.deltaX,h.deltaY))})},m.contextmenu=h=>h.preventDefault(),V.visibilitychange=()=>{document.visibilityState==="visible"&&(n.skipTime=!0)},F.gamepadconnected=h=>{let v=Ke(h.gamepad);n.events.onOnce("input",()=>{n.events.trigger("gamepadConnect",v)})},F.gamepaddisconnected=h=>{let v=Ie().filter(P=>P.index===h.gamepad.index)[0];At(h.gamepad),n.events.onOnce("input",()=>{n.events.trigger("gamepadDisconnect",v)})};for(let h in m)n.canvas.addEventListener(h,m[h]);for(let h in V)document.addEventListener(h,V[h]);for(let h in F)window.addEventListener(h,F[h]);let De=new ResizeObserver(h=>{for(let v of h)if(v.target===n.canvas){if(n.lastWidth===n.canvas.offsetWidth&&n.lastHeight===n.canvas.offsetHeight)return;n.lastWidth=n.canvas.offsetWidth,n.lastHeight=n.canvas.offsetHeight,n.events.onOnce("input",()=>{n.events.trigger("resize")})}});return De.observe(n.canvas),{dt:E,time:y,run:le,canvas:c,fps:W,numFrames:Z,quit:b,setFullscreen:He,isFullscreen:ke,setCursor:Q,screenshot:O,getGamepads:Ie,getCursor:q,setCursorLocked:se,isCursorLocked:M,isTouchscreen:C,mousePos:k,mouseDeltaPos:I,isKeyDown:Le,isKeyPressed:Ne,isKeyPressedRepeat:Qe,isKeyReleased:Je,isMouseDown:L,isMousePressed:J,isMouseReleased:R,isMouseMoved:Oe,isGamepadButtonPressed:tt,isGamepadButtonDown:rt,isGamepadButtonReleased:Ze,getGamepadStick:Ge,charInputted:Rt,onResize:ct,onKeyDown:nt,onKeyPress:Nt,onKeyPressRepeat:it,onKeyRelease:dt,onMouseDown:pt,onMousePress:ot,onMouseRelease:_e,onMouseMove:Xe,onCharInput:xt,onTouchStart:St,onTouchMove:we,onTouchEnd:Mt,onScroll:Pt,onGamepadButtonDown:Ee,onGamepadButtonPress:ft,onGamepadButtonRelease:gt,onGamepadStick:mt,onGamepadConnect:je,onGamepadDisconnect:Tt,events:n.events,get paused(){return n.paused},set paused(h){n.paused=h}}},"default"),vr=2.5949095,Ci=1.70158+1,Bi=2*Math.PI/3,Fi=2*Math.PI/4.5,Vr={linear:e=>e,easeInSine:e=>1-Math.cos(e*Math.PI/2),easeOutSine:e=>Math.sin(e*Math.PI/2),easeInOutSine:e=>-(Math.cos(Math.PI*e)-1)/2,easeInQuad:e=>e*e,easeOutQuad:e=>1-(1-e)*(1-e),easeInOutQuad:e=>e<.5?2*e*e:1-Math.pow(-2*e+2,2)/2,easeInCubic:e=>e*e*e,easeOutCubic:e=>1-Math.pow(1-e,3),easeInOutCubic:e=>e<.5?4*e*e*e:1-Math.pow(-2*e+2,3)/2,easeInQuart:e=>e*e*e*e,easeOutQuart:e=>1-Math.pow(1-e,4),easeInOutQuart:e=>e<.5?8*e*e*e*e:1-Math.pow(-2*e+2,4)/2,easeInQuint:e=>e*e*e*e*e,easeOutQuint:e=>1-Math.pow(1-e,5),easeInOutQuint:e=>e<.5?16*e*e*e*e*e:1-Math.pow(-2*e+2,5)/2,easeInExpo:e=>e===0?0:Math.pow(2,10*e-10),easeOutExpo:e=>e===1?1:1-Math.pow(2,-10*e),easeInOutExpo:e=>e===0?0:e===1?1:e<.5?Math.pow(2,20*e-10)/2:(2-Math.pow(2,-20*e+10))/2,easeInCirc:e=>1-Math.sqrt(1-Math.pow(e,2)),easeOutCirc:e=>Math.sqrt(1-Math.pow(e-1,2)),easeInOutCirc:e=>e<.5?(1-Math.sqrt(1-Math.pow(2*e,2)))/2:(Math.sqrt(1-Math.pow(-2*e+2,2))+1)/2,easeInBack:e=>Ci*e*e*e-1.70158*e*e,easeOutBack:e=>1+Ci*Math.pow(e-1,3)+1.70158*Math.pow(e-1,2),easeInOutBack:e=>e<.5?Math.pow(2*e,2)*((vr+1)*2*e-vr)/2:(Math.pow(2*e-2,2)*((vr+1)*(e*2-2)+vr)+2)/2,easeInElastic:e=>e===0?0:e===1?1:-Math.pow(2,10*e-10)*Math.sin((e*10-10.75)*Bi),easeOutElastic:e=>e===0?0:e===1?1:Math.pow(2,-10*e)*Math.sin((e*10-.75)*Bi)+1,easeInOutElastic:e=>e===0?0:e===1?1:e<.5?-(Math.pow(2,20*e-10)*Math.sin((20*e-11.125)*Fi))/2:Math.pow(2,-20*e+10)*Math.sin((20*e-11.125)*Fi)/2+1,easeInBounce:e=>1-Vr.easeOutBounce(1-e),easeOutBounce:e=>e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375,easeInOutBounce:e=>e<.5?(1-Vr.easeOutBounce(1-2*e))/2:(1+Vr.easeOutBounce(2*e-1))/2},ir=Vr,ao=class{time;action;finished=!1;paused=!1;constructor(e,n){this.time=e,this.action=n}tick(e){return this.finished||this.paused?!1:(this.time-=e,this.time<=0?(this.action(),this.finished=!0,this.time=0,!0):!1)}reset(e){this.time=e,this.finished=!1}};s(ao,"Timer");var zo="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAD0AAAA1CAYAAADyMeOEAAAAAXNSR0IArs4c6QAAAoVJREFUaIHdm7txwkAQhheGAqACiCHzOKQDQrqgILpwSAeEDBnEUAF0gCMxZ7G72qce/mec2Lpf9+3unaS78wgSNZ8uX5729+d1FNWXUuGmXlBOUUEIMckEpeQJgBu6C+BSFngztBR2vd+ovY+7g+p6LbgaWgJrAeUkDYIUXgXdBBwNi6kpABJwMTQH3AZsXRR8GHTfgEth8E3gjdAUcNewpbTgY85sCMCUuOokozE0YM0YRzM9NGAAXd8+omAF5h4lnmBRvpSnZHyLoLEbaN+aKB9KWv/KWw0tAbbANnlG+UvB2dm77NxxdwgBpjrF/d7rW9cbmpvio2A5z8iAYpVU8pGZlo6/2+MSco2lHfd3rv9jAP038e1xef9o2mjvYb2OqpqKE81028/jeietlSEVO5FRWsxWsJit1G3aFpW8iWe5RwpiCZAk25QvV6nz6fIlynRGuTd5WqpJ4guAlDfVKBK87hXljflgv1ON6fV+4+5gVlA17SfeG0heKqQd4l4jI/wrmaA9N9R4ar+wpHJDZyrrfcH0nB66PqAzPi76pn+faSyJk/vzOorYhGurQrzj/P68jtBMawHaHBIR9xoD5O34dy0qQOSYHvqExq2TpT2nf76+w7y251OYF0CRaU+J920TwLUa6inx6OxE6g80lu2ux7Y2eJLF/rCXE6zEPdnenk9o+4ih9AEdnW2q81HXl5LuU6OTl2fXUhqganbXAGq3g6jJOWV/OnoesO6YqqEB/GdNsjf7uHtwj2DzmRNpp7iOZfm6D9oAxB6Yi1gC4oIYeo4MIPdopEQRB+cAko5J1tW386HpB2Kz1eop4Epdwls/kgZ1sh8gZsEjdcWkr//D8Qu3Z3l5Nl1NtAAAAABJRU5ErkJggg==",Qo={};_o(Qo,{default:()=>lo});var lo=Go("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L5QNSqT5iiySS9Ja2SV//5ME0ak//+4KgAAABgQBAADAMDgYCAEgCteQ0fZH6+ICXA357+MPfhR/+ywRf/U///LVTEFNRTMuMTAwVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVX/+5JknQAFoWhGLm5gBClBmT3GiAAAAAGkHAAAIAAANIOAAARVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV"),Jo="data:image/png;base64,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",Xo="data:image/png;base64,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",Zo="3000.0.14",ki=" !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~",yr="topleft",Ii=64,$o="monospace",br="monospace",es=36,Di=64,Ui=256,Oi=2048,Ni=2048,Li=2048,_i=2048,Gi=.1,ts=64,Wi="nearest",rs=1,uo=[{name:"a_pos",size:2},{name:"a_uv",size:2},{name:"a_color",size:4}],Er=uo.reduce((e,n)=>e+n.size,0),ho=2048,qi=ho*4*Er,Hi=ho*6,ns=`
attribute vec2 a_pos;
attribute vec2 a_uv;
attribute vec4 a_color;

varying vec2 v_pos;
varying vec2 v_uv;
varying vec4 v_color;

vec4 def_vert() {
	return vec4(a_pos, 0.0, 1.0);
}

{{user}}

void main() {
	vec4 pos = vert(a_pos, a_uv, a_color);
	v_pos = a_pos;
	v_uv = a_uv;
	v_color = a_color;
	gl_Position = pos;
}
`,is=`
precision mediump float;

varying vec2 v_pos;
varying vec2 v_uv;
varying vec4 v_color;

uniform sampler2D u_tex;

vec4 def_frag() {
	return v_color * texture2D(u_tex, v_uv);
}

{{user}}

void main() {
	gl_FragColor = frag(v_pos, v_uv, v_color, u_tex);
	if (gl_FragColor.a == 0.0) {
		discard;
	}
}
`,tn=`
vec4 vert(vec2 pos, vec2 uv, vec4 color) {
	return def_vert();
}
`,rn=`
vec4 frag(vec2 pos, vec2 uv, vec4 color, sampler2D tex) {
	return def_frag();
}
`,os=new Set(["id","require"]),ss=new Set(["add","update","draw","destroy","inspect","drawInspect"]);function Dt(e){switch(e){case"topleft":return new S(-1,-1);case"top":return new S(0,-1);case"topright":return new S(1,-1);case"left":return new S(-1,0);case"center":return new S(0,0);case"right":return new S(1,0);case"botleft":return new S(-1,1);case"bot":return new S(0,1);case"botright":return new S(1,1);default:return e}}s(Dt,"anchorPt");function co(e){switch(e){case"left":return 0;case"center":return .5;case"right":return 1;default:return 0}}s(co,"alignPt");function po(e){return e.createBuffer(1,1,44100)}s(po,"createEmptyAudioBuffer");var fo=s((e={})=>{let n=e.root??document.body;n===document.body&&(document.body.style.width="100%",document.body.style.height="100%",document.body.style.margin="0px",document.documentElement.style.width="100%",document.documentElement.style.height="100%");let c=e.canvas??(()=>{let t=document.createElement("canvas");return n.appendChild(t),t})(),E=e.scale??1,y=e.width&&e.height&&!e.stretch&&!e.letterbox;y?(c.width=e.width*E,c.height=e.height*E):(c.width=c.parentElement.offsetWidth,c.height=c.parentElement.offsetHeight);let W=c.width,Z=c.height,O=e.pixelDensity||window.devicePixelRatio;c.width*=O,c.height*=O;let Q=["outline: none","cursor: default"];y?(Q.push(`width: ${W}px`),Q.push(`height: ${Z}px`)):(Q.push("width: 100%"),Q.push("height: 100%")),e.crisp&&(Q.push("image-rendering: pixelated"),Q.push("image-rendering: crisp-edges")),c.style.cssText=Q.join(";"),c.tabIndex=0;let q=document.createElement("canvas");q.width=Ui,q.height=Ui;let se=q.getContext("2d",{willReadFrequently:!0}),M=Yo({canvas:c,touchToMouse:e.touchToMouse,gamepads:e.gamepads,pixelDensity:e.pixelDensity,maxFPS:e.maxFPS}),ae=[],d=M.canvas().getContext("webgl",{antialias:!0,depth:!0,stencil:!0,alpha:!0,preserveDrawingBuffer:!0});class ne{src=null;glTex;width;height;constructor(r,i,o={}){this.glTex=d.createTexture(),ae.push(()=>this.free()),this.bind(),r&&i&&d.texImage2D(d.TEXTURE_2D,0,d.RGBA,r,i,0,d.RGBA,d.UNSIGNED_BYTE,null),this.width=r,this.height=i;let a=(()=>{switch(o.filter??e.texFilter){case"linear":return d.LINEAR;case"nearest":return d.NEAREST;default:return d.NEAREST}})(),u=(()=>{switch(o.wrap){case"repeat":return d.REPEAT;case"clampToEdge":return d.CLAMP_TO_EDGE;default:return d.CLAMP_TO_EDGE}})();d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,a),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,a),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,u),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,u),this.unbind()}static fromImage(r,i={}){let o=new ne(0,0,i);return o.bind(),d.texImage2D(d.TEXTURE_2D,0,d.RGBA,d.RGBA,d.UNSIGNED_BYTE,r),o.width=r.width,o.height=r.height,o.unbind(),o.src=r,o}update(r,i=0,o=0){this.bind(),d.texSubImage2D(d.TEXTURE_2D,0,i,o,d.RGBA,d.UNSIGNED_BYTE,r),this.unbind()}bind(){d.bindTexture(d.TEXTURE_2D,this.glTex)}unbind(){d.bindTexture(d.TEXTURE_2D,null)}free(){d.deleteTexture(this.glTex)}}s(ne,"Texture");class He{tex;canvas;ctx;x=0;y=0;curHeight=0;constructor(r,i){this.canvas=document.createElement("canvas"),this.canvas.width=r,this.canvas.height=i,this.tex=ne.fromImage(this.canvas),this.ctx=this.canvas.getContext("2d")}add(r){if(r.width>this.canvas.width||r.height>this.canvas.height)throw new Error(`Texture size (${r.width} x ${r.height}) exceeds limit (${this.canvas.width} x ${this.canvas.height})`);this.x+r.width>this.canvas.width&&(this.x=0,this.y+=this.curHeight,this.curHeight=0),this.y+r.height>this.canvas.height&&(this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.tex=ne.fromImage(this.canvas),this.x=0,this.y=0,this.curHeight=0);let i=new S(this.x,this.y);return this.x+=r.width,r.height>this.curHeight&&(this.curHeight=r.height),r instanceof ImageData?this.ctx.putImageData(r,i.x,i.y):this.ctx.drawImage(r,i.x,i.y),this.tex.update(this.canvas),[this.tex,new ye(i.x/this.canvas.width,i.y/this.canvas.height,r.width/this.canvas.width,r.height/this.canvas.height)]}}s(He,"TexPacker");class ke{tex;glFrameBuffer;glRenderBuffer;constructor(r,i,o={}){this.tex=new ne(r,i,o),this.glFrameBuffer=d.createFramebuffer(),this.glRenderBuffer=d.createRenderbuffer(),ae.push(()=>this.free()),this.bind(),d.renderbufferStorage(d.RENDERBUFFER,d.DEPTH_STENCIL,r,i),d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,this.tex.glTex,0),d.framebufferRenderbuffer(d.FRAMEBUFFER,d.DEPTH_STENCIL_ATTACHMENT,d.RENDERBUFFER,this.glRenderBuffer),this.unbind()}get width(){return this.tex.width}get height(){return this.tex.height}bind(){d.bindFramebuffer(d.FRAMEBUFFER,this.glFrameBuffer),d.bindRenderbuffer(d.RENDERBUFFER,this.glRenderBuffer)}unbind(){d.bindFramebuffer(d.FRAMEBUFFER,null),d.bindRenderbuffer(d.RENDERBUFFER,null)}free(){d.deleteFramebuffer(this.glFrameBuffer),d.deleteRenderbuffer(this.glRenderBuffer),this.tex.free()}}s(ke,"FrameBuffer");let b=(()=>{let t=w(tn,rn),r=ne.fromImage(new ImageData(new Uint8ClampedArray([255,255,255,255]),1,1)),i=e.width&&e.height?new ke(e.width*O,e.height*O):new ke(d.drawingBufferWidth,d.drawingBufferHeight),o=null,a=1;e.background&&(o=te.fromArray(e.background),a=e.background[3]??1,d.clearColor(o.r/255,o.g/255,o.b/255,a)),d.enable(d.BLEND),d.enable(d.SCISSOR_TEST),d.blendFuncSeparate(d.SRC_ALPHA,d.ONE_MINUS_SRC_ALPHA,d.ONE,d.ONE_MINUS_SRC_ALPHA);let u=d.createBuffer();d.bindBuffer(d.ARRAY_BUFFER,u),d.bufferData(d.ARRAY_BUFFER,qi*4,d.DYNAMIC_DRAW),uo.reduce((f,A,T)=>(d.vertexAttribPointer(T,A.size,d.FLOAT,!1,Er*4,f),d.enableVertexAttribArray(T),f+A.size*4),0),d.bindBuffer(d.ARRAY_BUFFER,null);let l=d.createBuffer();d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,l),d.bufferData(d.ELEMENT_ARRAY_BUFFER,Hi*4,d.DYNAMIC_DRAW),d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,null);let g=ne.fromImage(new ImageData(new Uint8ClampedArray([128,128,128,255,190,190,190,255,190,190,190,255,128,128,128,255]),2,2),{wrap:"repeat",filter:"nearest"});return{drawCalls:0,lastDrawCalls:0,defShader:t,curShader:t,frameBuffer:i,postShader:null,postShaderUniform:null,defTex:r,curTex:r,curUniform:{},vbuf:u,ibuf:l,vqueue:[],iqueue:[],transform:new Ve,transformStack:[],bgTex:g,bgColor:o,bgAlpha:a,width:e.width??d.drawingBufferWidth/O/E,height:e.height??d.drawingBufferHeight/O/E,viewport:{x:0,y:0,width:d.drawingBufferWidth,height:d.drawingBufferHeight}}})();class le{tex;frames=[new ye(0,0,1,1)];anims={};slice9=null;constructor(r,i,o={},a=null){this.tex=r,i&&(this.frames=i),this.anims=o,this.slice9=a}static from(r,i={}){return typeof r=="string"?le.fromURL(r,i):Promise.resolve(le.fromImage(r,i))}static fromImage(r,i={}){let[o,a]=L.packer.add(r),u=i.frames?i.frames.map(l=>new ye(a.x+l.x*a.w,a.y+l.y*a.h,l.w*a.w,l.h*a.h)):dt(i.sliceX||1,i.sliceY||1,a.x,a.y,a.w,a.h);return new le(o,u,i.anims,i.slice9)}static fromURL(r,i={}){return Ze(r).then(o=>le.fromImage(o,i))}}s(le,"SpriteData");class C{buf;constructor(r){this.buf=r}static fromArrayBuffer(r){return new Promise((i,o)=>k.ctx.decodeAudioData(r,i,o)).then(i=>new C(i))}static fromURL(r){return Ti(r)?C.fromArrayBuffer(ro(r)):rt(r).then(i=>C.fromArrayBuffer(i))}}s(C,"SoundData");let k=(()=>{let t=new(window.AudioContext||window.webkitAudioContext),r=t.createGain();r.connect(t.destination);let i=new C(po(t));return t.decodeAudioData(lo.buffer.slice(0)).then(o=>{i.buf=o}).catch(o=>{console.error("Failed to load burp: ",o)}),{ctx:t,masterNode:r,burpSnd:i}})();class I{loaded=!1;data=null;error=null;onLoadEvents=new Ye;onErrorEvents=new Ye;onFinishEvents=new Ye;constructor(r){r.then(i=>{this.data=i,this.onLoadEvents.trigger(i)}).catch(i=>{if(this.error=i,this.onErrorEvents.numListeners()>0)this.onErrorEvents.trigger(i);else throw i}).finally(()=>{this.onFinishEvents.trigger(),this.loaded=!0})}static loaded(r){let i=new I(Promise.resolve(r));return i.data=r,i.loaded=!0,i}onLoad(r){return this.loaded&&this.data?r(this.data):this.onLoadEvents.add(r),this}onError(r){return this.loaded&&this.error?r(this.error):this.onErrorEvents.add(r),this}onFinish(r){return this.loaded?r():this.onFinishEvents.add(r),this}then(r){return this.onLoad(r)}catch(r){return this.onError(r)}finally(r){return this.onFinish(r)}}s(I,"Asset");class J{assets=new Map;lastUID=0;add(r,i){let o=r??this.lastUID+++"",a=new I(i);return this.assets.set(o,a),a}addLoaded(r,i){let o=r??this.lastUID+++"",a=I.loaded(i);return this.assets.set(o,a),a}get(r){return this.assets.get(r)}progress(){if(this.assets.size===0)return 1;let r=0;return this.assets.forEach(i=>{i.loaded&&r++}),r/this.assets.size}}s(J,"AssetBucket");let L={urlPrefix:"",sprites:new J,fonts:new J,bitmapFonts:new J,sounds:new J,shaders:new J,custom:new J,packer:new He(Li,_i),loaded:!1},R={events:new Ht,objEvents:new Ht,root:hr([]),gravity:0,scenes:{},logs:[],cam:{pos:null,scale:new S(1),angle:0,shake:0,transform:new Ve}};function Oe(t){return L.custom.add(null,t)}s(Oe,"load");function Ne(){let t=[L.sprites,L.sounds,L.shaders,L.fonts,L.bitmapFonts,L.custom];return t.reduce((r,i)=>r+i.progress(),0)/t.length}s(Ne,"loadProgress");function Qe(t){return t!==void 0&&(L.urlPrefix=t),L.urlPrefix}s(Qe,"loadRoot");function Le(t){let r=L.urlPrefix+t;return fetch(r).then(i=>{if(!i.ok)throw new Error(`Failed to fetch ${r}`);return i})}s(Le,"fetchURL");function Je(t){return Le(t).then(r=>r.json())}s(Je,"fetchJSON");function tt(t){return Le(t).then(r=>r.text())}s(tt,"fetchText");function rt(t){return Le(t).then(r=>r.arrayBuffer())}s(rt,"fetchArrayBuffer");function Ze(t){let r=new Image;return r.crossOrigin="anonymous",r.src=Ti(t)?t:L.urlPrefix+t,new Promise((i,o)=>{r.onload=()=>i(r),r.onerror=()=>o(new Error(`Failed to load image from "${t}"`))})}s(Ze,"loadImg");function ct(t,r){return L.custom.add(t,Je(r))}s(ct,"loadJSON");class nt{fontface;outline;filter;constructor(r,i={}){this.fontface=r,this.outline=i.outline??0,this.filter=i.filter??Wi}}s(nt,"FontData");function Nt(t,r,i={}){let o=new FontFace(t,typeof r=="string"?`url(${r})`:r);return document.fonts.add(o),L.fonts.add(t,o.load().catch(a=>{throw new Error(`Failed to load font from "${r}": ${a}`)}).then(a=>new nt(a,i)))}s(Nt,"loadFont");function it(t,r,i,o,a={}){return L.bitmapFonts.add(t,Ze(r).then(u=>m(ne.fromImage(u,a),i,o,a.chars??ki)))}s(it,"loadBitmapFont");function dt(t=1,r=1,i=0,o=0,a=1,u=1){let l=[],g=a/t,f=u/r;for(let A=0;A<r;A++)for(let T=0;T<t;T++)l.push(new ye(i+T*g,o+A*f,g,f));return l}s(dt,"slice");function pt(t,r){return Oe(typeof r=="string"?new Promise((i,o)=>{Je(r).then(a=>{pt(t,a).then(i).catch(o)})}):le.from(t).then(i=>{let o={};for(let a in r){let u=r[a],l=i.frames[0],g=Li*l.w,f=_i*l.h,A=u.frames?u.frames.map(Y=>new ye(l.x+(u.x+Y.x)/g*l.w,l.y+(u.y+Y.y)/f*l.h,Y.w/g*l.w,Y.h/f*l.h)):dt(u.sliceX||1,u.sliceY||1,l.x+u.x/g*l.w,l.y+u.y/f*l.h,u.width/g*l.w,u.height/f*l.h),T=new le(i.tex,A,u.anims);L.sprites.addLoaded(a,T),o[a]=T}return o}))}s(pt,"loadSpriteAtlas");function ot(t,r={}){let i=document.createElement("canvas"),o=t[0].width,a=t[0].height;i.width=o*t.length,i.height=a;let u=i.getContext("2d");t.forEach((g,f)=>{g instanceof ImageData?u.putImageData(g,f*o,0):u.drawImage(g,f*o,0)});let l=u.getImageData(0,0,t.length*o,a);return le.fromImage(l,{...r,sliceX:t.length,sliceY:1})}s(ot,"createSpriteSheet");function _e(t,r,i={sliceX:1,sliceY:1,anims:{}}){return Array.isArray(r)?r.some(o=>typeof o=="string")?L.sprites.add(t,Promise.all(r.map(o=>typeof o=="string"?Ze(o):Promise.resolve(o))).then(o=>ot(o,i))):L.sprites.addLoaded(t,ot(r,i)):typeof r=="string"?L.sprites.add(t,le.from(r,i)):L.sprites.addLoaded(t,le.fromImage(r,i))}s(_e,"loadSprite");function Xe(t,r){return L.sprites.add(t,new Promise(async i=>{let o=typeof r=="string"?await Je(r):r,a=await Promise.all(o.frames.map(Ze)),u=document.createElement("canvas");u.width=o.width,u.height=o.height*o.frames.length;let l=u.getContext("2d");a.forEach((f,A)=>{l.drawImage(f,0,A*o.height)});let g=await _e(null,u,{sliceY:o.frames.length,anims:o.anims});i(g)}))}s(Xe,"loadPedit");function xt(t,r,i){typeof r=="string"&&!i&&(i=r.replace(new RegExp(`${jo(r)}$`),"json"));let o=typeof i=="string"?Je(i):Promise.resolve(i);return L.sprites.add(t,o.then(a=>{let u=a.meta.size,l=a.frames.map(f=>new ye(f.frame.x/u.w,f.frame.y/u.h,f.frame.w/u.w,f.frame.h/u.h)),g={};for(let f of a.meta.frameTags)f.from===f.to?g[f.name]=f.from:g[f.name]={from:f.from,to:f.to,speed:10,loop:!0,pingpong:f.direction==="pingpong"};return le.from(r,{frames:l,anims:g})}))}s(xt,"loadAseprite");function St(t,r,i){return L.shaders.addLoaded(t,w(r,i))}s(St,"loadShader");function we(t,r,i){let o=s(u=>u?tt(u):Promise.resolve(null),"resolveUrl"),a=Promise.all([o(r),o(i)]).then(([u,l])=>w(u,l));return L.shaders.add(t,a)}s(we,"loadShaderURL");function Mt(t,r,i={}){return L.sounds.add(t,typeof r=="string"?C.fromURL(r):C.fromArrayBuffer(r))}s(Mt,"loadSound");function Pt(t="bean"){return _e(t,zo)}s(Pt,"loadBean");function Ee(t){return L.sprites.get(t)}s(Ee,"getSprite");function ft(t){return L.sounds.get(t)}s(ft,"getSound");function gt(t){return L.fonts.get(t)}s(gt,"getFont");function mt(t){return L.bitmapFonts.get(t)}s(mt,"getBitmapFont");function je(t){return L.shaders.get(t)}s(je,"getShader");function Tt(t){return L.custom.get(t)}s(Tt,"getAsset");function Ge(t){if(typeof t=="string"){let r=Ee(t);if(r)return r;if(Ne()<1)return null;throw new Error(`Sprite not found: ${t}`)}else{if(t instanceof le)return I.loaded(t);if(t instanceof I)return t;throw new Error(`Invalid sprite: ${t}`)}}s(Ge,"resolveSprite");function Rt(t){if(typeof t=="string"){let r=ft(t);if(r)return r;if(Ne()<1)return null;throw new Error(`Sound not found: ${t}`)}else{if(t instanceof C)return I.loaded(t);if(t instanceof I)return t;throw new Error(`Invalid sound: ${t}`)}}s(Rt,"resolveSound");function Ie(t){if(!t)return b.defShader;if(typeof t=="string"){let r=je(t);if(r)return r.data??r;if(Ne()<1)return null;throw new Error(`Shader not found: ${t}`)}else if(t instanceof I)return t.data?t.data:t;return t}s(Ie,"resolveShader");function wt(t){if(!t)return wt(e.font??$o);if(typeof t=="string"){let r=mt(t),i=gt(t);if(r)return r.data??r;if(i)return i.data??i;if(document.fonts.check(`${Di}px ${t}`))return t;if(Ne()<1)return null;throw new Error(`Font not found: ${t}`)}else if(t instanceof I)return t.data?t.data:t;return t}s(wt,"resolveFont");function Ct(t){return t!==void 0&&(k.masterNode.gain.value=t),k.masterNode.gain.value}s(Ct,"volume");function Ke(t,r={}){let i=k.ctx,o=r.paused??!1,a=i.createBufferSource(),u=new Ye,l=i.createGain(),g=r.seek??0,f=0,A=0,T=!1;a.loop=!!r.loop,a.detune.value=r.detune??0,a.playbackRate.value=r.speed??1,a.connect(l),a.onended=()=>{re()>=a.buffer?.duration&&u.trigger()},l.connect(k.masterNode),l.gain.value=r.volume??1;let Y=s(_=>{a.buffer=_.buf,o||(f=i.currentTime,a.start(0,g),T=!0)},"start"),oe=Rt(t);oe instanceof I&&oe.onLoad(Y);let re=s(()=>{if(!a.buffer)return 0;let _=o?A-f:i.currentTime-f,$=a.buffer.duration;return a.loop?_%$:Math.min(_,$)},"getTime"),he=s(_=>{let $=i.createBufferSource();return $.buffer=_.buffer,$.loop=_.loop,$.playbackRate.value=_.playbackRate.value,$.detune.value=_.detune.value,$.onended=_.onended,$.connect(l),$},"cloneNode");return{set paused(_){if(o!==_)if(o=_,_)T&&(a.stop(),T=!1),A=i.currentTime;else{a=he(a);let $=A-f;a.start(0,$),T=!0,f=i.currentTime-$,A=0}},get paused(){return o},play(_=0){this.seek(_),this.paused=!1},seek(_){a.buffer?.duration&&(_>a.buffer.duration||(o?(a=he(a),f=A-_):(a.stop(),a=he(a),f=i.currentTime-_,a.start(0,_),T=!0,A=0)))},set speed(_){a.playbackRate.value=_},get speed(){return a.playbackRate.value},set detune(_){a.detune.value=_},get detune(){return a.detune.value},set volume(_){l.gain.value=Math.max(_,0)},get volume(){return l.gain.value},set loop(_){a.loop=_},get loop(){return a.loop},duration(){return a.buffer?.duration??0},time(){return re()%this.duration()},onEnd(_){return u.add(_)},then(_){return this.onEnd(_)}}}s(Ke,"play");function At(t){return Ke(k.burpSnd,t)}s(At,"burp");function w(t=tn,r=rn){let i=ns.replace("{{user}}",t??tn),o=is.replace("{{user}}",r??rn),a=d.createShader(d.VERTEX_SHADER),u=d.createShader(d.FRAGMENT_SHADER);d.shaderSource(a,i),d.shaderSource(u,o),d.compileShader(a),d.compileShader(u);let l=d.createProgram();if(ae.push(()=>d.deleteProgram(l)),d.attachShader(l,a),d.attachShader(l,u),d.bindAttribLocation(l,0,"a_pos"),d.bindAttribLocation(l,1,"a_uv"),d.bindAttribLocation(l,2,"a_color"),d.linkProgram(l),!d.getProgramParameter(l,d.LINK_STATUS)){let g=s(Y=>{let oe=/^ERROR:\s0:(?<line>\d+):\s(?<msg>.+)/,re=Y.match(oe);return{line:Number(re.groups.line),msg:re.groups.msg.replace(/\n\0$/,"")}},"formatShaderError"),f=d.getShaderInfoLog(a),A=d.getShaderInfoLog(u),T="";if(f){let Y=g(f);T+=`Vertex shader line ${Y.line-14}: ${Y.msg}`}if(A){let Y=g(A);T+=`Fragment shader line ${Y.line-14}: ${Y.msg}`}throw new Error(T)}return d.deleteShader(a),d.deleteShader(u),{bind(){d.useProgram(l)},unbind(){d.useProgram(null)},free(){d.deleteProgram(l)},send(g){for(let f in g){let A=g[f],T=d.getUniformLocation(l,f);typeof A=="number"?d.uniform1f(T,A):A instanceof Ve?d.uniformMatrix4fv(T,!1,new Float32Array(A.m)):A instanceof te?d.uniform3f(T,A.r,A.g,A.b):A instanceof S&&d.uniform2f(T,A.x,A.y)}}}}s(w,"makeShader");function m(t,r,i,o){let a=t.width/r,u={},l=o.split("").entries();for(let[g,f]of l)u[f]=new ye(g%a*r,Math.floor(g/a)*i,r,i);return{tex:t,map:u,size:i}}s(m,"makeFont");function V(t,r,i,o=b.defTex,a=b.defShader,u={}){let l=Ie(a);if(!l||l instanceof I)return;(o!==b.curTex||l!==b.curShader||!fn(b.curUniform,u)||b.vqueue.length+t.length*Er>qi||b.iqueue.length+r.length>Hi)&&F();let g=i?b.transform:R.cam.transform.mult(b.transform);for(let f of t){let A=De(g.multVec2(f.pos));b.vqueue.push(A.x,A.y,f.uv.x,f.uv.y,f.color.r/255,f.color.g/255,f.color.b/255,f.opacity)}for(let f of r)b.iqueue.push(f+b.vqueue.length/Er-t.length);b.curTex=o,b.curShader=l,b.curUniform=u}s(V,"drawRaw");function F(){!b.curTex||!b.curShader||b.vqueue.length===0||b.iqueue.length===0||(d.bindBuffer(d.ARRAY_BUFFER,b.vbuf),d.bufferSubData(d.ARRAY_BUFFER,0,new Float32Array(b.vqueue)),d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,b.ibuf),d.bufferSubData(d.ELEMENT_ARRAY_BUFFER,0,new Uint16Array(b.iqueue)),b.curShader.bind(),b.curShader.send(b.curUniform),b.curTex.bind(),d.drawElements(d.TRIANGLES,b.iqueue.length,d.UNSIGNED_SHORT,0),b.curTex.unbind(),b.curShader.unbind(),d.bindBuffer(d.ARRAY_BUFFER,null),d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,null),b.vqueue.length=0,b.iqueue.length=0,b.drawCalls++)}s(F,"flush");function X(){d.clear(d.COLOR_BUFFER_BIT),b.frameBuffer.bind(),d.viewport(0,0,b.frameBuffer.width,b.frameBuffer.height),d.clear(d.COLOR_BUFFER_BIT),b.bgColor||at(()=>{Me({width:Te(),height:Be(),quad:new ye(0,0,Te()/Ii,Be()/Ii),tex:b.bgTex,fixed:!0})}),b.drawCalls=0,b.transformStack.length=0,b.transform=new Ve}s(X,"frameStart");function Ce(t,r){b.postShader=t,b.postShaderUniform=r??null}s(Ce,"usePostEffect");function G(){F(),b.frameBuffer.unbind(),d.viewport(0,0,d.drawingBufferWidth,d.drawingBufferHeight),F();let t=b.width,r=b.height;b.width=d.drawingBufferWidth/O,b.height=d.drawingBufferHeight/O,Bt({flipY:!0,tex:b.frameBuffer.tex,pos:new S(b.viewport.x,b.viewport.y),width:b.viewport.width,height:b.viewport.height,shader:b.postShader,uniform:typeof b.postShaderUniform=="function"?b.postShaderUniform():b.postShaderUniform,fixed:!0}),F(),b.width=t,b.height=r,b.lastDrawCalls=b.drawCalls}s(G,"frameEnd");function De(t){return new S(t.x/Te()*2-1,-t.y/Be()*2+1)}s(De,"screen2ndc");function h(t){b.transform=t.clone()}s(h,"pushMatrix");function v(...t){if(t[0]===void 0)return;let r=B(...t);r.x===0&&r.y===0||b.transform.translate(r)}s(v,"pushTranslate");function P(...t){if(t[0]===void 0)return;let r=B(...t);r.x===1&&r.y===1||b.transform.scale(r)}s(P,"pushScale");function H(t){t&&b.transform.rotate(t)}s(H,"pushRotate");function K(){b.transformStack.push(b.transform.clone())}s(K,"pushTransform");function ge(){b.transformStack.length>0&&(b.transform=b.transformStack.pop())}s(ge,"popTransform");function Me(t){if(t.width===void 0||t.height===void 0)throw new Error('drawUVQuad() requires property "width" and "height".');if(t.width<=0||t.height<=0)return;let r=t.width,i=t.height,o=Dt(t.anchor||yr).scale(new S(r,i).scale(-.5)),a=t.quad||new ye(0,0,1,1),u=t.color||de(255,255,255),l=t.opacity??1,g=t.tex?Gi/t.tex.width:0,f=t.tex?Gi/t.tex.height:0,A=a.x+g,T=a.y+f,Y=a.w-g*2,oe=a.h-f*2;K(),v(t.pos),H(t.angle),P(t.scale),v(o),V([{pos:new S(-r/2,i/2),uv:new S(t.flipX?A+Y:A,t.flipY?T:T+oe),color:u,opacity:l},{pos:new S(-r/2,-i/2),uv:new S(t.flipX?A+Y:A,t.flipY?T+oe:T),color:u,opacity:l},{pos:new S(r/2,-i/2),uv:new S(t.flipX?A:A+Y,t.flipY?T+oe:T),color:u,opacity:l},{pos:new S(r/2,i/2),uv:new S(t.flipX?A:A+Y,t.flipY?T:T+oe),color:u,opacity:l}],[0,1,3,1,2,3],t.fixed,t.tex,t.shader,t.uniform),ge()}s(Me,"drawUVQuad");function Bt(t){if(!t.tex)throw new Error('drawTexture() requires property "tex".');let r=t.quad??new ye(0,0,1,1),i=t.tex.width*r.w,o=t.tex.height*r.h,a=new S(1);if(t.tiled){let u=Math.ceil((t.width||i)/i),l=Math.ceil((t.height||o)/o),g=Dt(t.anchor||yr).add(new S(1,1)).scale(.5).scale(u*i,l*o);for(let f=0;f<u;f++)for(let A=0;A<l;A++)Me(Object.assign({},t,{pos:(t.pos||new S(0)).add(new S(i*f,o*A)).sub(g),scale:a.scale(t.scale||new S(1)),tex:t.tex,quad:r,width:i,height:o,anchor:"topleft"}))}else t.width&&t.height?(a.x=t.width/i,a.y=t.height/o):t.width?(a.x=t.width/i,a.y=a.x):t.height&&(a.y=t.height/o,a.x=a.y),Me(Object.assign({},t,{scale:a.scale(t.scale||new S(1)),tex:t.tex,quad:r,width:i,height:o}))}s(Bt,"drawTexture");function lr(t){if(!t.sprite)throw new Error('drawSprite() requires property "sprite"');let r=Ge(t.sprite);if(!r||!r.data)return;let i=r.data.frames[t.frame??0];if(!i)throw new Error(`Frame not found: ${t.frame??0}`);Bt(Object.assign({},t,{tex:r.data.tex,quad:i.scale(t.quad??new ye(0,0,1,1))}))}s(lr,"drawSprite");function D(t,r,i,o,a,u=1){o=$e(o%360),a=$e(a%360),a<=o&&(a+=Math.PI*2);let l=[],g=Math.ceil((a-o)/$e(8)*u),f=(a-o)/g;for(let A=o;A<a;A+=f)l.push(t.add(r*Math.cos(A),i*Math.sin(A)));return l.push(t.add(r*Math.cos(a),i*Math.sin(a))),l}s(D,"getArcPts");function pe(t){if(t.width===void 0||t.height===void 0)throw new Error('drawRect() requires property "width" and "height".');if(t.width<=0||t.height<=0)return;let r=t.width,i=t.height,o=Dt(t.anchor||yr).add(1,1).scale(new S(r,i).scale(-.5)),a=[new S(0,0),new S(r,0),new S(r,i),new S(0,i)];if(t.radius){let u=Math.min(Math.min(r,i)/2,t.radius);a=[new S(u,0),new S(r-u,0),...D(new S(r-u,u),u,u,270,360),new S(r,u),new S(r,i-u),...D(new S(r-u,i-u),u,u,0,90),new S(r-u,i),new S(u,i),...D(new S(u,i-u),u,u,90,180),new S(0,i-u),new S(0,u),...D(new S(u,u),u,u,180,270)]}vt(Object.assign({},t,{offset:o,pts:a,...t.gradient?{colors:t.horizontal?[t.gradient[0],t.gradient[1],t.gradient[1],t.gradient[0]]:[t.gradient[0],t.gradient[0],t.gradient[1],t.gradient[1]]}:{}}))}s(pe,"drawRect");function st(t){let{p1:r,p2:i}=t;if(!r||!i)throw new Error('drawLine() requires properties "p1" and "p2".');let o=t.width||1,a=i.sub(r).unit().normal().scale(o*.5),u=[r.sub(a),r.add(a),i.add(a),i.sub(a)].map(l=>({pos:new S(l.x,l.y),uv:new S(0),color:t.color??te.WHITE,opacity:t.opacity??1}));V(u,[0,1,3,1,2,3],t.fixed,b.defTex,t.shader,t.uniform)}s(st,"drawLine");function Lt(t){let r=t.pts;if(!r)throw new Error('drawLines() requires property "pts".');if(!(r.length<2))if(t.radius&&r.length>=3){let i=r[0].sdist(r[1]);for(let a=1;a<r.length-1;a++)i=Math.min(r[a].sdist(r[a+1]),i);let o=Math.min(t.radius,Math.sqrt(i)/2);st(Object.assign({},t,{p1:r[0],p2:r[1]}));for(let a=1;a<r.length-2;a++){let u=r[a],l=r[a+1];st(Object.assign({},t,{p1:u,p2:l}))}st(Object.assign({},t,{p1:r[r.length-2],p2:r[r.length-1]}))}else for(let i=0;i<r.length-1;i++)st(Object.assign({},t,{p1:r[i],p2:r[i+1]})),t.join!=="none"&&Ft(Object.assign({},t,{pos:r[i],radius:t.width/2}))}s(Lt,"drawLines");function Br(t){if(!t.p1||!t.p2||!t.p3)throw new Error('drawPolygon() requires properties "p1", "p2" and "p3".');return vt(Object.assign({},t,{pts:[t.p1,t.p2,t.p3]}))}s(Br,"drawTriangle");function Ft(t){if(typeof t.radius!="number")throw new Error('drawCircle() requires property "radius".');t.radius!==0&&Fr(Object.assign({},t,{radiusX:t.radius,radiusY:t.radius,angle:0}))}s(Ft,"drawCircle");function Fr(t){if(t.radiusX===void 0||t.radiusY===void 0)throw new Error('drawEllipse() requires properties "radiusX" and "radiusY".');if(t.radiusX===0||t.radiusY===0)return;let r=t.start??0,i=t.end??360,o=Dt(t.anchor??"center").scale(new S(-t.radiusX,-t.radiusY)),a=D(o,t.radiusX,t.radiusY,r,i,t.resolution);a.unshift(o);let u=Object.assign({},t,{pts:a,radius:0,...t.gradient?{colors:[t.gradient[0],...Array(a.length-1).fill(t.gradient[1])]}:{}});if(i-r>=360&&t.outline){t.fill!==!1&&vt(Object.assign(u,{outline:null})),vt(Object.assign(u,{pts:a.slice(1),fill:!1}));return}vt(u)}s(Fr,"drawEllipse");function vt(t){if(!t.pts)throw new Error('drawPolygon() requires property "pts".');let r=t.pts.length;if(!(r<3)){if(K(),v(t.pos),P(t.scale),H(t.angle),v(t.offset),t.fill!==!1){let i=t.color??te.WHITE,o=t.pts.map((u,l)=>({pos:new S(u.x,u.y),uv:new S(0,0),color:t.colors?t.colors[l]??i:i,opacity:t.opacity??1})),a=[...Array(r-2).keys()].map(u=>[0,u+1,u+2]).flat();V(o,t.indices??a,t.fixed,b.defTex,t.shader,t.uniform)}t.outline&&Lt({pts:[...t.pts,t.pts[0]],radius:t.radius,width:t.outline.width,color:t.outline.color,join:t.outline.join,uniform:t.uniform,fixed:t.fixed,opacity:t.opacity}),ge()}}s(vt,"drawPolygon");function kr(t,r,i){F(),d.clear(d.STENCIL_BUFFER_BIT),d.enable(d.STENCIL_TEST),d.stencilFunc(d.NEVER,1,255),d.stencilOp(d.REPLACE,d.REPLACE,d.REPLACE),r(),F(),d.stencilFunc(i,1,255),d.stencilOp(d.KEEP,d.KEEP,d.KEEP),t(),F(),d.disable(d.STENCIL_TEST)}s(kr,"drawStenciled");function wn(t,r){kr(t,r,d.EQUAL)}s(wn,"drawMasked");function An(t,r){kr(t,r,d.NOTEQUAL)}s(An,"drawSubtracted");function Ir(){return(b.viewport.width+b.viewport.height)/(b.width+b.height)}s(Ir,"getViewportScale");function at(t){F();let r=b.width,i=b.height;b.width=b.viewport.width,b.height=b.viewport.height,t(),F(),b.width=r,b.height=i}s(at,"drawUnscaled");function Dr(t,r){r.pos&&(t.pos=t.pos.add(r.pos)),r.scale&&(t.scale=t.scale.scale(B(r.scale))),r.angle&&(t.angle+=r.angle),r.color&&(t.color=t.color.mult(r.color)),r.opacity&&(t.opacity*=r.opacity)}s(Dr,"applyCharTransform");let vn=/\[(?<style>\w+)\](?<text>.*?)\[\/\k<style>\]/g;function yn(t){let r={},i=t.replace(vn,"$2"),o=0;for(let a of t.matchAll(vn)){let u=a.index-o;for(let l=0;l<a.groups.text.length;l++)r[l+u]=[a.groups.style];o+=a[0].length-a.groups.text.length}return{charStyleMap:r,text:i}}s(yn,"compileStyledText");let Ur={};function yt(t){if(t.text===void 0)throw new Error('formatText() requires property "text".');let r=wt(t.font);if(t.text===""||r instanceof I||!r)return{width:0,height:0,chars:[],opt:t};let{charStyleMap:i,text:o}=yn(t.text+""),a=o.split("");if(r instanceof nt||typeof r=="string"){let ee=r instanceof nt?r.fontface.family:r,ce=r instanceof nt?{outline:r.outline,filter:r.filter}:{outline:0,filter:Wi},z=Ur[ee]??{font:{tex:new ne(Oi,Ni,{filter:ce.filter}),map:{},size:Di},cursor:new S(0),outline:ce.outline};Ur[ee]||(Ur[ee]=z),r=z.font;for(let qe of a)if(!z.font.map[qe]){let x=se;x.clearRect(0,0,q.width,q.height),x.font=`${r.size}px ${ee}`,x.textBaseline="top",x.textAlign="left",x.fillStyle="#ffffff";let N=x.measureText(qe),U=Math.ceil(N.width),j=r.size;z.outline&&(x.lineJoin="round",x.lineWidth=z.outline*2,x.strokeStyle="#000000",x.strokeText(qe,z.outline,z.outline),U+=z.outline*2,j+=z.outline*3),x.fillText(qe,z.outline,z.outline);let ie=x.getImageData(0,0,U,j);if(z.cursor.x+U>Oi&&(z.cursor.x=0,z.cursor.y+=j,z.cursor.y>Ni))throw new Error("Font atlas exceeds character limit");r.tex.update(ie,z.cursor.x,z.cursor.y),r.map[qe]=new ye(z.cursor.x,z.cursor.y,U,j),z.cursor.x+=U}}let u=t.size||r.size,l=B(t.scale??1).scale(u/r.size),g=t.lineSpacing??0,f=t.letterSpacing??0,A=0,T=0,Y=0,oe=[],re=[],he=0,_=null,$=null;for(;he<a.length;){let ee=a[he];if(ee===`
`)Y+=u+g,oe.push({width:A-f,chars:re}),_=null,$=null,A=0,re=[];else{let ce=r.map[ee];if(ce){let z=ce.w*l.x;t.width&&A+z>t.width&&(Y+=u+g,_!=null&&(he-=re.length-_,ee=a[he],ce=r.map[ee],z=ce.w*l.x,re=re.slice(0,_-1),A=$),_=null,$=null,oe.push({width:A-f,chars:re}),A=0,re=[]),re.push({tex:r.tex,width:ce.w,height:ce.h,quad:new ye(ce.x/r.tex.width,ce.y/r.tex.height,ce.w/r.tex.width,ce.h/r.tex.height),ch:ee,pos:new S(A,Y),opacity:t.opacity??1,color:t.color??te.WHITE,scale:B(l),angle:0}),ee===" "&&(_=re.length,$=A),A+=z,T=Math.max(T,A),A+=f}}he++}oe.push({width:A-f,chars:re}),Y+=u,t.width&&(T=t.width);let Fe=[];for(let ee of oe){let ce=(T-ee.width)*co(t.align??"left");for(let z of ee.chars){let qe=r.map[z.ch],x=Fe.length;if(z.pos=z.pos.add(ce,0).add(qe.w*l.x*.5,qe.h*l.y*.5),t.transform){let N=typeof t.transform=="function"?t.transform(x,z.ch):t.transform;N&&Dr(z,N)}if(i[x]){let N=i[x];for(let U of N){let j=t.styles[U],ie=typeof j=="function"?j(x,z.ch):j;ie&&Dr(z,ie)}}Fe.push(z)}}return{width:T,height:Y,chars:Fe,opt:t}}s(yt,"formatText");function Or(t){bt(yt(t))}s(Or,"drawText");function bt(t){K(),v(t.opt.pos),H(t.opt.angle),v(Dt(t.opt.anchor??"topleft").add(1,1).scale(t.width,t.height).scale(-.5)),t.chars.forEach(r=>{Me({tex:r.tex,width:r.width,height:r.height,pos:r.pos,scale:r.scale,angle:r.angle,color:r.color,opacity:r.opacity,quad:r.quad,anchor:"center",uniform:t.opt.uniform,shader:t.opt.shader,fixed:t.opt.fixed})}),ge()}s(bt,"drawFormattedText");function Te(){return b.width}s(Te,"width");function Be(){return b.height}s(Be,"height");let _t={};function bn(t){return new S((t.x-b.viewport.x)*Te()/b.viewport.width,(t.y-b.viewport.y)*Be()/b.viewport.height)}s(bn,"windowToContent");function Vn(t){return new S(t.x*b.viewport.width/b.width,t.y*b.viewport.height/b.height)}s(Vn,"contentToView");function Qt(){return bn(M.mousePos())}s(Qt,"mousePos"),_t.error=t=>{if(t.error)mr(t.error);else{if(t.message==="Script error.")return;mr(new Error(t.message))}},_t.unhandledrejection=t=>mr(t.reason);for(let t in _t)window.addEventListener(t,_t[t]);let me={inspect:!1,timeScale:1,showLog:!0,fps:()=>M.fps(),numFrames:()=>M.numFrames(),stepFrame:Qr,drawCalls:()=>b.drawCalls,clearLog:()=>R.logs=[],log:t=>{let r=e.logMax??rs,i=t instanceof Error?"error":"info";R.logs.unshift(`${`[time]${M.time().toFixed(2)}[/time] `}[${i}]${t?.toString?t.toString():t}[/${i}]`),R.logs.length>r&&(R.logs=R.logs.slice(0,r))},error:t=>me.log(new Error(t.toString?t.toString():t)),curRecording:null,get paused(){return M.paused},set paused(t){M.paused=t,t?k.ctx.suspend():k.ctx.resume()}};function We(){return M.dt()}s(We,"dt");function En(...t){return t.length>0&&(R.cam.pos=B(...t)),R.cam.pos?R.cam.pos.clone():tr()}s(En,"camPos");function xn(...t){return t.length>0&&(R.cam.scale=B(...t)),R.cam.scale.clone()}s(xn,"camScale");function Sn(t){return t!==void 0&&(R.cam.angle=t),R.cam.angle}s(Sn,"camRot");function Mn(t=12){R.cam.shake+=t}s(Mn,"shake");function ur(t){return R.cam.transform.multVec2(t)}s(ur,"toScreen");function Nr(t){return R.cam.transform.invert().multVec2(t)}s(Nr,"toWorld");function Jt(t){let r=new Ve;return t.pos&&r.translate(t.pos),t.scale&&r.scale(t.scale),t.angle&&r.rotate(t.angle),t.parent?r.mult(t.parent.transform):r}s(Jt,"calcTransform");function hr(t){let r=new Map,i={},o=new Ht,a=null,u={id:Ko(),hidden:!1,paused:!1,transform:new Ve,children:[],parent:null,add(l){let g=(()=>{if(Array.isArray(l))return hr(l);if(l.parent)throw new Error("Cannot add a game obj that already has a parent.");return l})();return g.parent=this,g.transform=Jt(g),this.children.push(g),g.trigger("add",g),R.events.trigger("add",g),g},readd(l){let g=this.children.indexOf(l);return g!==-1&&(this.children.splice(g,1),this.children.push(l)),l},remove(l){let g=this.children.indexOf(l);if(g!==-1){l.parent=null,this.children.splice(g,1);let f=s(A=>{A.trigger("destroy"),R.events.trigger("destroy",A),A.children.forEach(T=>f(T))},"trigger");f(l)}},removeAll(l){if(l)this.get(l).forEach(g=>this.remove(g));else for(let g of[...this.children])this.remove(g)},update(){this.paused||(this.children.sort((l,g)=>(l.z??0)-(g.z??0)).forEach(l=>l.update()),this.trigger("update"))},draw(){this.hidden||(K(),v(this.pos),P(this.scale),H(this.angle),this.trigger("draw"),this.children.sort((l,g)=>(l.z??0)-(g.z??0)).forEach(l=>l.draw()),ge())},drawInspect(){this.hidden||(K(),v(this.pos),P(this.scale),H(this.angle),this.children.sort((l,g)=>(l.z??0)-(g.z??0)).forEach(l=>l.drawInspect()),this.trigger("drawInspect"),ge())},use(l){if(!l)return;if(typeof l=="string")return this.use({id:l});let g=[];l.id&&(this.unuse(l.id),i[l.id]=[],g=i[l.id],r.set(l.id,l));for(let A in l){if(os.has(A))continue;let T=Object.getOwnPropertyDescriptor(l,A);if(typeof T.value=="function"&&(l[A]=l[A].bind(this)),T.set&&Object.defineProperty(l,A,{set:T.set.bind(this)}),T.get&&Object.defineProperty(l,A,{get:T.get.bind(this)}),ss.has(A)){let Y=A==="add"?()=>{a=s(oe=>g.push(oe),"onCurCompCleanup"),l[A](),a=null}:l[A];g.push(this.on(A,Y).cancel)}else if(this[A]===void 0)Object.defineProperty(this,A,{get:()=>l[A],set:Y=>l[A]=Y,configurable:!0,enumerable:!0}),g.push(()=>delete this[A]);else throw new Error(`Duplicate component property: "${A}"`)}let f=s(()=>{if(l.require){for(let A of l.require)if(!this.c(A))throw new Error(`Component "${l.id}" requires component "${A}"`)}},"checkDeps");l.destroy&&g.push(l.destroy.bind(this)),this.exists()?(f(),l.add&&(a=s(A=>g.push(A),"onCurCompCleanup"),l.add.call(this),a=null)):l.require&&g.push(this.on("add",f).cancel)},unuse(l){i[l]&&(i[l].forEach(g=>g()),delete i[l]),r.has(l)&&r.delete(l)},c(l){return r.get(l)},get(l,g={}){let f=g.recursive?this.children.flatMap(s(function A(T){return[T,...T.children.flatMap(A)]},"recurse")):this.children;if(f=f.filter(A=>l?A.is(l):!0),g.liveUpdate){let A=s(T=>g.recursive?this.isAncestorOf(T):T.parent===this,"isChild");cr(T=>{A(T)&&T.is(l)&&f.push(T)}),_r(T=>{if(A(T)&&T.is(l)){let Y=f.findIndex(oe=>oe.id===T.id);Y!==-1&&f.splice(Y,1)}})}return f},isAncestorOf(l){return l.parent?l.parent===this||this.isAncestorOf(l.parent):!1},exists(){return R.root.isAncestorOf(this)},is(l){if(l==="*")return!0;if(Array.isArray(l)){for(let g of l)if(!this.c(g))return!1;return!0}else return this.c(l)!=null},on(l,g){let f=o.on(l,g.bind(this));return a&&a(()=>f.cancel()),f},trigger(l,...g){o.trigger(l,...g),R.objEvents.trigger(l,this,...g)},destroy(){this.parent&&this.parent.remove(this)},inspect(){let l={};for(let[g,f]of r)l[g]=f.inspect?f.inspect():null;return l},onAdd(l){return this.on("add",l)},onUpdate(l){return this.on("update",l)},onDraw(l){return this.on("draw",l)},onDestroy(l){return this.on("destroy",l)},clearEvents(){o.clear()}};for(let l of t)u.use(l);return u}s(hr,"make");function lt(t,r,i){return R.objEvents[t]||(R.objEvents[t]=new pn),R.objEvents.on(t,(o,...a)=>{o.is(r)&&i(o,...a)})}s(lt,"on");let Lr=s((t,r)=>{if(typeof t=="function"&&r===void 0){let i=rr([{update:t}]);return{get paused(){return i.paused},set paused(o){i.paused=o},cancel:()=>i.destroy()}}else if(typeof t=="string")return lt("update",t,r)},"onUpdate"),bo=s((t,r)=>{if(typeof t=="function"&&r===void 0){let i=rr([{draw:t}]);return{get paused(){return i.hidden},set paused(o){i.hidden=o},cancel:()=>i.destroy()}}else if(typeof t=="string")return lt("draw",t,r)},"onDraw");function cr(t,r){if(typeof t=="function"&&r===void 0)return R.events.on("add",t);if(typeof t=="string")return lt("add",t,r)}s(cr,"onAdd");function _r(t,r){if(typeof t=="function"&&r===void 0)return R.events.on("destroy",t);if(typeof t=="string")return lt("destroy",t,r)}s(_r,"onDestroy");function Pn(t,r,i){return lt("collide",t,(o,a,u)=>a.is(r)&&i(o,a,u))}s(Pn,"onCollide");function Tn(t,r,i){return lt("collideUpdate",t,(o,a,u)=>a.is(r)&&i(o,a,u))}s(Tn,"onCollideUpdate");function Rn(t,r,i){return lt("collideEnd",t,(o,a,u)=>a.is(r)&&i(o,a,u))}s(Rn,"onCollideEnd");function Xt(t,r){gi(t,{recursive:!0}).forEach(r),cr(t,r)}s(Xt,"forAllCurrentAndFuture");function Cn(t,r){if(typeof t=="function")return M.onMousePress(t);{let i=[];return Xt(t,o=>{if(!o.area)throw new Error("onClick() requires the object to have area() component");i.push(o.onClick(()=>r(o)))}),Vt.join(i)}}s(Cn,"onClick");function Bn(t,r){let i=[];return Xt(t,o=>{if(!o.area)throw new Error("onHover() requires the object to have area() component");i.push(o.onHover(()=>r(o)))}),Vt.join(i)}s(Bn,"onHover");function Fn(t,r){let i=[];return Xt(t,o=>{if(!o.area)throw new Error("onHoverUpdate() requires the object to have area() component");i.push(o.onHoverUpdate(()=>r(o)))}),Vt.join(i)}s(Fn,"onHoverUpdate");function kn(t,r){let i=[];return Xt(t,o=>{if(!o.area)throw new Error("onHoverEnd() requires the object to have area() component");i.push(o.onHoverEnd(()=>r(o)))}),Vt.join(i)}s(kn,"onHoverEnd");function Zt(t,r){let i=0,o=[];r&&o.push(r);let a=Lr(()=>{i+=We(),i>=t&&(a.cancel(),o.forEach(u=>u()))});return{paused:a.paused,cancel:a.cancel,onEnd(u){o.push(u)},then(u){return this.onEnd(u),this}}}s(Zt,"wait");function In(t,r){let i=null,o=s(()=>{i=Zt(t,o),r()},"newAction");return i=Zt(0,o),{get paused(){return i.paused},set paused(a){i.paused=a},cancel:()=>i.cancel()}}s(In,"loop");function Gr(){M.onKeyPress("f1",()=>{me.inspect=!me.inspect}),M.onKeyPress("f2",()=>{me.clearLog()}),M.onKeyPress("f8",()=>{me.paused=!me.paused}),M.onKeyPress("f7",()=>{me.timeScale=Gt(Et(me.timeScale-.2,0,2),1)}),M.onKeyPress("f9",()=>{me.timeScale=Gt(Et(me.timeScale+.2,0,2),1)}),M.onKeyPress("f10",()=>{me.stepFrame()})}s(Gr,"enterDebugMode");function Wr(){M.onKeyPress("b",()=>At())}s(Wr,"enterBurpMode");function Dn(t){R.gravity=t}s(Dn,"setGravity");function Un(){return R.gravity}s(Un,"getGravity");function On(...t){t.length===1||t.length===2?(b.bgColor=de(t[0]),t[1]&&(b.bgAlpha=t[1])):(t.length===3||t.length===4)&&(b.bgColor=de(t[0],t[1],t[2]),t[3]&&(b.bgAlpha=t[3])),d.clearColor(b.bgColor.r/255,b.bgColor.g/255,b.bgColor.b/255,b.bgAlpha)}s(On,"setBackground");function Nn(){return b.bgColor.clone()}s(Nn,"getBackground");function $t(...t){return{id:"pos",pos:B(...t),moveBy(...r){this.pos=this.pos.add(B(...r))},move(...r){this.moveBy(B(...r).scale(We()))},moveTo(...r){if(typeof r[0]=="number"&&typeof r[1]=="number")return this.moveTo(B(r[0],r[1]),r[2]);let i=r[0],o=r[1];if(o===void 0){this.pos=B(i);return}let a=i.sub(this.pos);if(a.len()<=o*We()){this.pos=B(i);return}this.move(a.unit().scale(o))},worldPos(){return this.parent?this.parent.transform.multVec2(this.pos):this.pos},screenPos(){return this.fixed?this.pos:ur(this.pos)},inspect(){return`(${Math.round(this.pos.x)}, ${Math.round(this.pos.y)})`},drawInspect(){Ft({color:de(255,0,0),radius:4/Ir()})}}}s($t,"pos");function er(...t){return t.length===0?er(1):{id:"scale",scale:B(...t),scaleTo(...r){this.scale=B(...r)},scaleBy(...r){this.scale.scale(B(...r))},inspect(){return`(${Gt(this.scale.x,2)}, ${Gt(this.scale.y,2)})`}}}s(er,"scale");function Ln(t){return{id:"rotate",angle:t??0,rotateBy(r){this.angle+=r},rotateTo(r){this.angle=r},inspect(){return`${Math.round(this.angle)}`}}}s(Ln,"rotate");function _n(...t){return{id:"color",color:de(...t),inspect(){return this.color.toString()}}}s(_n,"color");function Gt(t,r){return Number(t.toFixed(r))}s(Gt,"toFixed");function Gn(t){return{id:"opacity",opacity:t??1,inspect(){return`${Gt(this.opacity,1)}`},fadeOut(r=1,i=ir.linear){return wr(this.opacity,0,r,o=>this.opacity=o,i)}}}s(Gn,"opacity");function dr(t){if(!t)throw new Error("Please define an anchor");return{id:"anchor",anchor:t,inspect(){return typeof this.anchor=="string"?this.anchor:this.anchor.toString()}}}s(dr,"anchor");function Wn(t){return{id:"z",z:t,inspect(){return`${this.z}`}}}s(Wn,"z");function qn(t,r){return{id:"follow",require:["pos"],follow:{obj:t,offset:r??B(0)},add(){t.exists()&&(this.pos=this.follow.obj.pos.add(this.follow.offset))},update(){t.exists()&&(this.pos=this.follow.obj.pos.add(this.follow.offset))}}}s(qn,"follow");function Hn(t,r){let i=typeof t=="number"?S.fromAngle(t):t.unit();return{id:"move",require:["pos"],update(){this.move(i.scale(r))}}}s(Hn,"move");let Vo=200;function jn(t={}){let r=t.distance??Vo,i=!1;return{id:"offscreen",require:["pos"],isOffScreen(){let o=ur(this.pos),a=new xe(B(0),Te(),Be());return!ar(a,o)&&a.sdistToPoint(o)>r*r},onExitScreen(o){return this.on("exitView",o)},onEnterScreen(o){return this.on("enterView",o)},update(){this.isOffScreen()?(i||(this.trigger("exitView"),i=!0),t.hide&&(this.hidden=!0),t.pause&&(this.paused=!0),t.destroy&&this.destroy()):(i&&(this.trigger("enterView"),i=!1),t.hide&&(this.hidden=!1),t.pause&&(this.paused=!1))}}}s(jn,"offscreen");function Kn(t={}){let r={},i=new Set;return{id:"area",collisionIgnore:t.collisionIgnore??[],add(){this.area.cursor&&this.onHover(()=>M.setCursor(this.area.cursor)),this.onCollideUpdate((o,a)=>{r[o.id]||this.trigger("collide",o,a),r[o.id]=a,i.add(o.id)})},update(){for(let o in r)i.has(Number(o))||(this.trigger("collideEnd",r[o].target),delete r[o]);i.clear()},drawInspect(){let o=this.localArea();K(),P(this.area.scale),v(this.area.offset);let a={outline:{width:4/Ir(),color:de(0,0,255)},anchor:this.anchor,fill:!1,fixed:this.fixed};o instanceof xe?pe({...a,pos:o.pos,width:o.width,height:o.height}):o instanceof Ut?vt({...a,pts:o.pts}):o instanceof Sr&&Ft({...a,pos:o.center,radius:o.radius}),ge()},area:{shape:t.shape??null,scale:t.scale?B(t.scale):B(1),offset:t.offset??B(0),cursor:t.cursor??null},isClicked(){return M.isMousePressed()&&this.isHovering()},isHovering(){let o=this.fixed?Qt():Nr(Qt());return this.hasPoint(o)},checkCollision(o){return r[o.id]??null},getCollisions(){return Object.values(r)},isColliding(o){return!!r[o.id]},isOverlapping(o){let a=r[o.id];return a&&a.hasOverlap()},onClick(o){let a=M.onMousePress("left",()=>{this.isHovering()&&o()});return this.onDestroy(()=>a.cancel()),a},onHover(o){let a=!1;return this.onUpdate(()=>{a?a=this.isHovering():this.isHovering()&&(a=!0,o())})},onHoverUpdate(o){return this.onUpdate(()=>{this.isHovering()&&o()})},onHoverEnd(o){let a=!1;return this.onUpdate(()=>{a?this.isHovering()||(a=!1,o()):a=this.isHovering()})},onCollide(o,a){if(typeof o=="function"&&a===void 0)return this.on("collide",o);if(typeof o=="string")return this.onCollide((u,l)=>{u.is(o)&&a(u,l)})},onCollideUpdate(o,a){if(typeof o=="function"&&a===void 0)return this.on("collideUpdate",o);if(typeof o=="string")return this.on("collideUpdate",(u,l)=>u.is(o)&&a(u,l))},onCollideEnd(o,a){if(typeof o=="function"&&a===void 0)return this.on("collideEnd",o);if(typeof o=="string")return this.on("collideEnd",u=>u.is(o)&&a(u))},hasPoint(o){return dn(this.worldArea(),o)},resolveCollision(o){let a=this.checkCollision(o);a&&!a.resolved&&(this.pos=this.pos.add(a.displacement),a.resolved=!0)},localArea(){return this.area.shape?this.area.shape:this.renderArea()},worldArea(){let o=this.localArea();if(!(o instanceof Ut||o instanceof xe))throw new Error("Only support polygon and rect shapes for now");let a=this.transform.clone().scale(B(this.area.scale??1)).translate(this.area.offset);if(o instanceof xe){let u=Dt(this.anchor||yr).add(1,1).scale(-.5).scale(o.width,o.height);a.translate(u)}return o.transform(a)},screenArea(){let o=this.worldArea();return this.fixed?o:o.transform(R.cam.transform)}}}s(Kn,"area");function kt(t){return{color:t.color,opacity:t.opacity,anchor:t.anchor,outline:t.outline,fixed:t.fixed,shader:t.shader,uniform:t.uniform}}s(kt,"getRenderProps");function pr(t,r={}){let i=null,o=null,a=new Ye;if(!t)throw new Error("Please pass the resource name or data to sprite()");let u=s((l,g,f,A)=>{let T=B(1,1);return f&&A?(T.x=f/(l.width*g.w),T.y=A/(l.height*g.h)):f?(T.x=f/(l.width*g.w),T.y=T.x):A&&(T.y=A/(l.height*g.h),T.x=T.y),T},"calcTexScale");return{id:"sprite",width:0,height:0,frame:r.frame||0,quad:r.quad||new ye(0,0,1,1),animSpeed:r.animSpeed??1,flipX:r.flipX??!1,flipY:r.flipY??!1,draw(){if(!i)return;let l=i.frames[this.frame??0];if(!l)throw new Error(`Frame not found: ${this.frame??0}`);if(i.slice9){let{left:g,right:f,top:A,bottom:T}=i.slice9,Y=i.tex.width*l.w,oe=i.tex.height*l.h,re=this.width-g-f,he=this.height-A-T,_=g/Y,$=f/Y,Fe=1-_-$,ee=A/oe,ce=T/oe,z=1-ee-ce,qe=[ve(0,0,_,ee),ve(_,0,Fe,ee),ve(_+Fe,0,$,ee),ve(0,ee,_,z),ve(_,ee,Fe,z),ve(_+Fe,ee,$,z),ve(0,ee+z,_,ce),ve(_,ee+z,Fe,ce),ve(_+Fe,ee+z,$,ce),ve(0,0,g,A),ve(g,0,re,A),ve(g+re,0,f,A),ve(0,A,g,he),ve(g,A,re,he),ve(g+re,A,f,he),ve(0,A+he,g,T),ve(g,A+he,re,T),ve(g+re,A+he,f,T)];for(let x=0;x<9;x++){let N=qe[x],U=qe[x+9];Bt(Object.assign(kt(this),{pos:U.pos(),tex:i.tex,quad:l.scale(N),flipX:this.flipX,flipY:this.flipY,tiled:r.tiled,width:U.w,height:U.h}))}}else Bt(Object.assign(kt(this),{tex:i.tex,quad:l,flipX:this.flipX,flipY:this.flipY,tiled:r.tiled,width:this.width,height:this.height}))},add(){let l=s(f=>{let A=f.frames[0].clone();r.quad&&(A=A.scale(r.quad));let T=u(f.tex,A,r.width,r.height);this.width=f.tex.width*A.w*T.x,this.height=f.tex.height*A.h*T.y,r.anim&&this.play(r.anim),i=f,a.trigger(i)},"setSpriteData"),g=Ge(t);g?g.onLoad(l):fr(()=>l(Ge(t).data))},update(){if(!o)return;let l=i.anims[o.name];if(typeof l=="number"){this.frame=l;return}if(l.speed===0)throw new Error("Sprite anim speed cannot be 0");o.timer+=We()*this.animSpeed,o.timer>=1/o.speed&&(o.timer=0,l.from>l.to?(this.frame--,this.frame<l.to&&(o.loop?this.frame=l.from:(this.frame++,o.onEnd(),this.stop()))):(this.frame++,this.frame>l.to&&(o.loop?this.frame=l.from:(this.frame--,o.onEnd(),this.stop()))))},play(l,g={}){if(!i){a.add(()=>this.play(l,g));return}let f=i.anims[l];if(f===void 0)throw new Error(`Anim not found: ${l}`);o&&this.stop(),o=typeof f=="number"?{name:l,timer:0,loop:!1,pingpong:!1,speed:0,onEnd:()=>{}}:{name:l,timer:0,loop:g.loop??f.loop??!1,pingpong:g.pingpong??f.pingpong??!1,speed:g.speed??f.speed??10,onEnd:g.onEnd??(()=>{})},this.frame=typeof f=="number"?f:f.from,this.trigger("animStart",l)},stop(){if(!o)return;let l=o.name;o=null,this.trigger("animEnd",l)},numFrames(){return i?.frames.length??0},curAnim(){return o?.name},onAnimEnd(l){return this.on("animEnd",l)},onAnimStart(l){return this.on("animStart",l)},renderArea(){return new xe(B(0),this.width,this.height)},inspect(){if(typeof t=="string")return`"${t}"`}}}s(pr,"sprite");function Yn(t,r={}){function i(o){let a=yt(Object.assign(kt(o),{text:o.text+"",size:o.textSize,font:o.font,width:r.width&&o.width,align:o.align,letterSpacing:o.letterSpacing,lineSpacing:o.lineSpacing,transform:o.textTransform,styles:o.textStyles}));return r.width||(o.width=a.width/(o.scale?.x||1)),o.height=a.height/(o.scale?.y||1),a}return s(i,"update"),{id:"text",text:t,textSize:r.size??es,font:r.font,width:r.width,height:0,align:r.align,lineSpacing:r.lineSpacing,letterSpacing:r.letterSpacing,textTransform:r.transform,textStyles:r.styles,add(){fr(()=>i(this))},draw(){bt(i(this))},renderArea(){return new xe(B(0),this.width,this.height)}}}s(Yn,"text");function zn(t,r,i={}){return{id:"rect",width:t,height:r,radius:i.radius||0,draw(){pe(Object.assign(kt(this),{width:this.width,height:this.height,radius:this.radius}))},renderArea(){return new xe(B(0),this.width,this.height)},inspect(){return`${Math.ceil(this.width)}, ${Math.ceil(this.height)}`}}}s(zn,"rect");function Qn(t,r){return{id:"rect",width:t,height:r,draw(){Me(Object.assign(kt(this),{width:this.width,height:this.height}))},renderArea(){return new xe(B(0),this.width,this.height)},inspect(){return`${Math.ceil(this.width)}, ${Math.ceil(this.height)}`}}}s(Qn,"uvquad");function Jn(t){return{id:"circle",radius:t,draw(){Ft(Object.assign(kt(this),{radius:this.radius}))},renderArea(){return new xe(new S(this.anchor?0:-this.radius),this.radius*2,this.radius*2)},inspect(){return`${Math.ceil(this.radius)}`}}}s(Jn,"circle");function Xn(t=1,r=de(0,0,0)){return{id:"outline",outline:{width:t,color:r}}}s(Xn,"outline");function qr(){return{id:"timer",wait(t,r){let i=[];r&&i.push(r);let o=0,a=this.onUpdate(()=>{o+=We(),o>=t&&(i.forEach(u=>u()),a.cancel())});return{get paused(){return a.paused},set paused(u){a.paused=u},cancel:a.cancel,onEnd(u){i.push(u)},then(u){return this.onEnd(u),this}}},loop(t,r){let i=null,o=s(()=>{i=this.wait(t,o),r()},"newAction");return i=this.wait(0,o),{get paused(){return i.paused},set paused(a){i.paused=a},cancel:()=>i.cancel()}},tween(t,r,i,o,a=ir.linear){let u=0,l=[],g=this.onUpdate(()=>{u+=We();let f=Math.min(u/i,1);o(et(t,r,a(f))),f===1&&(g.cancel(),o(r),l.forEach(A=>A()))});return{get paused(){return g.paused},set paused(f){g.paused=f},onEnd(f){l.push(f)},then(f){return this.onEnd(f),this},cancel(){g.cancel()},finish(){g.cancel(),o(r),l.forEach(f=>f())}}}}}s(qr,"timer");let Eo=640,xo=65536;function Zn(t={}){let r=B(0),i=null,o=null,a=!1;return{id:"body",require:["pos","area"],jumpForce:t.jumpForce??Eo,gravityScale:t.gravityScale??1,isStatic:t.isStatic??!1,mass:t.mass??1,add(){if(this.mass===0)throw new Error("Can't set body mass to 0");this.onCollideUpdate((u,l)=>{if(u.is("body")&&!l.resolved&&(this.trigger("beforePhysicsResolve",l),u.trigger("beforePhysicsResolve",l.reverse()),!l.resolved&&!(this.isStatic&&u.isStatic))){if(!this.isStatic&&!u.isStatic){let g=this.mass+u.mass;this.pos=this.pos.add(l.displacement.scale(u.mass/g)),u.pos=u.pos.add(l.displacement.scale(-this.mass/g)),this.transform=Jt(this),u.transform=Jt(u)}else{let g=!this.isStatic&&u.isStatic?l:l.reverse();g.source.pos=g.source.pos.add(g.displacement),g.source.transform=Jt(g.source)}l.resolved=!0,this.trigger("physicsResolve",l),u.trigger("physicsResolve",l.reverse())}}),this.onPhysicsResolve(u=>{R.gravity&&(u.isBottom()&&this.isFalling()?(r.y=0,i=u.target,o=u.target.pos,a?a=!1:this.trigger("ground",i)):u.isTop()&&this.isJumping()&&(r.y=0,this.trigger("headbutt",u.target)))})},update(){if(!R.gravity||this.isStatic)return;if(a&&(i=null,o=null,this.trigger("fallOff"),a=!1),i)if(!this.isOverlapping(i)||!i.exists()||!i.is("body"))a=!0;else{!i.pos.eq(o)&&t.stickToPlatform!==!1&&this.moveBy(i.pos.sub(o)),o=i.pos;return}let u=r.y;r.y+=R.gravity*this.gravityScale*We(),r.y=Math.min(r.y,t.maxVelocity??xo),u<0&&r.y>=0&&this.trigger("fall"),this.move(r)},onPhysicsResolve(u){return this.on("physicsResolve",u)},onBeforePhysicsResolve(u){return this.on("beforePhysicsResolve",u)},curPlatform(){return i},isGrounded(){return i!==null},isFalling(){return r.y>0},isJumping(){return r.y<0},jump(u){i=null,o=null,r.y=-u||-this.jumpForce},onGround(u){return this.on("ground",u)},onFall(u){return this.on("fall",u)},onFallOff(u){return this.on("fallOff",u)},onHeadbutt(u){return this.on("headbutt",u)}}}s(Zn,"body");function $n(t=2){let r=t;return{id:"doubleJump",require:["body"],numJumps:t,add(){this.onGround(()=>{r=this.numJumps})},doubleJump(i){r<=0||(r<this.numJumps&&this.trigger("doubleJump"),r--,this.jump(i))},onDoubleJump(i){return this.on("doubleJump",i)},inspect(){return`${r}`}}}s($n,"doubleJump");function ei(t,r){return{id:"shader",shader:t,...typeof r=="function"?{uniform:r(),update(){this.uniform=r()}}:{uniform:r}}}s(ei,"shader");function ti(){return{id:"fixed",fixed:!0}}s(ti,"fixed");function Hr(t){return{id:"stay",stay:!0,scenesToStay:t}}s(Hr,"stay");function ri(t){if(t==null)throw new Error("health() requires the initial amount of hp");let r=t;return{id:"health",hurt(i=1){this.setHP(t-i),this.trigger("hurt",i)},heal(i=1){this.setHP(t+i),this.trigger("heal",i)},hp(){return t},maxHP(){return r},setHP(i){t=i,t<=0&&this.trigger("death")},onHurt(i){return this.on("hurt",i)},onHeal(i){return this.on("heal",i)},onDeath(i){return this.on("death",i)},inspect(){return`${t}`}}}s(ri,"health");function ni(t,r={}){if(t==null)throw new Error("lifespan() requires time");let i=r.fade??0;return{id:"lifespan",async add(){await Zt(t),i>0&&this.opacity&&await wr(this.opacity,0,i,o=>this.opacity=o,ir.linear),this.destroy()}}}s(ni,"lifespan");function ii(t,r,i){if(!t)throw new Error("state() requires an initial state");let o={};function a(f){o[f]||(o[f]={enter:new Ye,end:new Ye,update:new Ye,draw:new Ye})}s(a,"initStateEvents");function u(f,A,T){return a(A),o[A][f].add(T)}s(u,"on");function l(f,A,...T){a(A),o[A][f].trigger(...T)}s(l,"trigger");let g=!1;return{id:"state",state:t,enterState(f,...A){if(g=!0,r&&!r.includes(f))throw new Error(`State not found: ${f}`);let T=this.state;if(i){if(!i?.[T])return;let Y=typeof i[T]=="string"?[i[T]]:i[T];if(!Y.includes(f))throw new Error(`Cannot transition state from "${T}" to "${f}". Available transitions: ${Y.map(oe=>`"${oe}"`).join(", ")}`)}l("end",T,...A),this.state=f,l("enter",f,...A),l("enter",`${T} -> ${f}`,...A)},onStateTransition(f,A,T){return u("enter",`${f} -> ${A}`,T)},onStateEnter(f,A){return u("enter",f,A)},onStateUpdate(f,A){return u("update",f,A)},onStateDraw(f,A){return u("draw",f,A)},onStateEnd(f,A){return u("end",f,A)},update(){g||(l("enter",t),g=!0),l("update",this.state)},draw(){l("draw",this.state)},inspect(){return this.state}}}s(ii,"state");function oi(t=1){let r=0,i=!1;return{require:["opacity"],add(){this.opacity=0},update(){i||(r+=We(),this.opacity=xr(r,0,t,0,1),r>=t&&(this.opacity=1,i=!0))}}}s(oi,"fadeIn");function fr(t){L.loaded?t():R.events.on("load",t)}s(fr,"onLoad");function si(t,r){R.scenes[t]=r}s(si,"scene");function ai(t,...r){if(!R.scenes[t])throw new Error(`Scene not found: ${t}`);R.events.onOnce("frameEnd",()=>{R.events.trigger("sceneLeave",t),M.events.clear(),R.events.clear(),R.objEvents.clear(),[...R.root.children].forEach(i=>{(!i.stay||i.scenesToStay&&!i.scenesToStay.includes(t))&&R.root.remove(i)}),R.root.clearEvents(),R.cam={pos:null,scale:B(1),angle:0,shake:0,transform:new Ve},R.scenes[t](...r),e.debug!==!1&&Gr(),e.burp&&Wr()})}s(ai,"go");function li(t){return R.events.on("sceneLeave",t)}s(li,"onSceneLeave");function ui(t,r){try{return JSON.parse(window.localStorage[t])}catch{return r?(jr(t,r),r):null}}s(ui,"getData");function jr(t,r){window.localStorage[t]=JSON.stringify(r)}s(jr,"setData");function Kr(t){let r=t(Wt);for(let i in r)Wt[i]=r[i],e.global!==!1&&(window[i]=r[i]);return Wt}s(Kr,"plug");function tr(){return B(Te()/2,Be()/2)}s(tr,"center");let So;(t=>(t[t.None=0]="None",t[t.Left=1]="Left",t[t.Top=2]="Top",t[t.LeftTop=3]="LeftTop",t[t.Right=4]="Right",t[t.Horizontal=5]="Horizontal",t[t.RightTop=6]="RightTop",t[t.HorizontalTop=7]="HorizontalTop",t[t.Bottom=8]="Bottom",t[t.LeftBottom=9]="LeftBottom",t[t.Vertical=10]="Vertical",t[t.LeftVertical=11]="LeftVertical",t[t.RightBottom=12]="RightBottom",t[t.HorizontalBottom=13]="HorizontalBottom",t[t.RightVertical=14]="RightVertical",t[t.All=15]="All"))(So||={});function Yr(t={}){let r=B(0),i=t.isObstacle??!1,o=t.cost??0,a=t.edges??[],u=s(()=>{let g={left:1,top:2,right:4,bottom:8};return a.map(f=>g[f]||0).reduce((f,A)=>f|A,0)},"getEdgeMask"),l=u();return{id:"tile",tilePosOffset:t.offset??B(0),set tilePos(g){let f=this.getLevel();r=g.clone(),this.pos=B(this.tilePos.x*f.tileWidth(),this.tilePos.y*f.tileHeight()).add(this.tilePosOffset)},get tilePos(){return r},set isObstacle(g){i!==g&&(i=g,this.getLevel().invalidateNavigationMap())},get isObstacle(){return i},set cost(g){o!==g&&(o=g,this.getLevel().invalidateNavigationMap())},get cost(){return o},set edges(g){a=g,l=u(),this.getLevel().invalidateNavigationMap()},get edges(){return a},get edgeMask(){return l},getLevel(){return this.parent},moveLeft(){this.tilePos=this.tilePos.add(B(-1,0))},moveRight(){this.tilePos=this.tilePos.add(B(1,0))},moveUp(){this.tilePos=this.tilePos.add(B(0,-1))},moveDown(){this.tilePos=this.tilePos.add(B(0,1))}}}s(Yr,"tile");function hi(t,r){if(!r.tileWidth||!r.tileHeight)throw new Error("Must provide tileWidth and tileHeight.");let i=rr([$t(r.pos??B(0))]),o=t.length,a=0,u=null,l=null,g=null,f=null,A=s(x=>x.x+x.y*a,"tile2Hash"),T=s(x=>B(Math.floor(x%a),Math.floor(x/a)),"hash2Tile"),Y=s(()=>{u=[];for(let x of i.children)oe(x)},"createSpatialMap"),oe=s(x=>{let N=A(x.tilePos);u[N]?u[N].push(x):u[N]=[x]},"insertIntoSpatialMap"),re=s(x=>{let N=A(x.tilePos);if(u[N]){let U=u[N].indexOf(x);U>=0&&u[N].splice(U,1)}},"removeFromSpatialMap"),he=s(()=>{let x=!1;for(let N of i.children){let U=i.pos2Tile(N.pos);(N.tilePos.x!=U.x||N.tilePos.y!=U.y)&&(x=!0,re(N),N.tilePos.x=U.x,N.tilePos.y=U.y,oe(N))}x&&i.trigger("spatial_map_changed")},"updateSpatialMap"),_=s(()=>{let x=i.getSpatialMap(),N=i.numRows()*i.numColumns();l?l.length=N:l=new Array(N),l.fill(1,0,N);for(let U=0;U<x.length;U++){let j=x[U];if(j){let ie=0;for(let ue of j)if(ue.isObstacle){ie=1/0;break}else ie+=ue.cost;l[U]=ie||1}}},"createCostMap"),$=s(()=>{let x=i.getSpatialMap(),N=i.numRows()*i.numColumns();g?g.length=N:g=new Array(N),g.fill(15,0,N);for(let U=0;U<x.length;U++){let j=x[U];if(j){let ie=j.length,ue=15;for(let Ae=0;Ae<ie;Ae++)ue|=j[Ae].edgeMask;g[U]=ue}}},"createEdgeMap"),Fe=s(()=>{let x=i.numRows()*i.numColumns(),N=s((j,ie)=>{let ue=[];for(ue.push(j);ue.length>0;){let Ae=ue.pop();z(Ae).forEach(Pe=>{f[Pe]<0&&(f[Pe]=ie,ue.push(Pe))})}},"traverse");f?f.length=x:f=new Array(x),f.fill(-1,0,x);let U=0;for(let j=0;j<l.length;j++){if(f[j]>=0){U++;continue}N(j,U),U++}},"createConnectivityMap"),ee=s((x,N)=>l[N],"getCost"),ce=s((x,N)=>{let U=T(x),j=T(N);return U.dist(j)},"getHeuristic"),z=s((x,N)=>{let U=[],j=Math.floor(x%a),ie=j>0&&g[x]&1&&l[x-1]!==1/0,ue=x>=a&&g[x]&2&&l[x-a]!==1/0,Ae=j<a-1&&g[x]&4&&l[x+1]!==1/0,Pe=x<a*o-a-1&&g[x]&8&&l[x+a]!==1/0;return N?(ie&&(ue&&U.push(x-a-1),U.push(x-1),Pe&&U.push(x+a-1)),ue&&U.push(x-a),Ae&&(ue&&U.push(x-a+1),U.push(x+1),Pe&&U.push(x+a+1)),Pe&&U.push(x+a)):(ie&&U.push(x-1),ue&&U.push(x-a),Ae&&U.push(x+1),Pe&&U.push(x+a)),U},"getNeighbours"),qe={id:"level",tileWidth(){return r.tileWidth},tileHeight(){return r.tileHeight},spawn(x,...N){let U=B(...N),j=(()=>{if(typeof x=="string"){if(r.tiles[x]){if(typeof r.tiles[x]!="function")throw new Error("Level symbol def must be a function returning a component list");return r.tiles[x](U)}else if(r.wildcardTile)return r.wildcardTile(x,U)}else{if(Array.isArray(x))return x;throw new Error("Expected a symbol or a component list")}})();if(!j)return null;let ie=!1,ue=!1;for(let Pe of j)Pe.id==="tile"&&(ue=!0),Pe.id==="pos"&&(ie=!0);ie||j.push($t()),ue||j.push(Yr());let Ae=i.add(j);return ie&&(Ae.tilePosOffset=Ae.pos.clone()),Ae.tilePos=U,u&&(oe(Ae),this.trigger("spatial_map_changed"),this.trigger("navigation_map_invalid")),Ae},numColumns(){return a},numRows(){return o},levelWidth(){return a*this.tileWidth()},levelHeight(){return o*this.tileHeight()},tile2Pos(...x){return B(...x).scale(this.tileWidth(),this.tileHeight())},pos2Tile(...x){let N=B(...x);return B(Math.floor(N.x/this.tileWidth()),Math.floor(N.y/this.tileHeight()))},getSpatialMap(){return u||Y(),u},onSpatialMapChanged(x){return this.on("spatial_map_changed",x)},onNavigationMapInvalid(x){return this.on("navigation_map_invalid",x)},getAt(x){u||Y();let N=A(x);return u[N]||[]},update(){u&&he()},invalidateNavigationMap(){l=null,g=null,f=null},onNavigationMapChanged(x){return this.on("navigation_map_changed",x)},getTilePath(x,N,U={}){if(l||_(),g||$(),f||Fe(),x.x<0||x.x>=a||x.y<0||x.y>=o||N.x<0||N.x>=a||N.y<0||N.y>=o)return null;let j=A(x),ie=A(N);if(l[ie]===1/0)return null;if(j===ie)return[];if(f[j]!=-1&&f[j]!==f[ie])return null;let ue=new io((ut,$r)=>ut.cost<$r.cost);ue.insert({cost:0,node:j});let Ae=new Map;Ae.set(j,j);let Pe=new Map;for(Pe.set(j,0);ue.length!==0;){let ut=ue.remove()?.node;if(ut===ie)break;let $r=z(ut,U.allowDiagonals);for(let It of $r){let en=(Pe.get(ut)||0)+ee(ut,It)+ce(It,ie);(!Pe.has(It)||en<Pe.get(It))&&(Pe.set(It,en),ue.insert({cost:en,node:It}),Ae.set(It,ut))}}let Zr=[],nr=ie,Co=T(nr);for(Zr.push(Co);nr!==j;){nr=Ae.get(nr);let ut=T(nr);Zr.push(ut)}return Zr.reverse()},getPath(x,N,U={}){let j=this.tileWidth(),ie=this.tileHeight(),ue=this.getTilePath(this.pos2Tile(x),this.pos2Tile(N),U);return ue?[x,...ue.slice(1,-1).map(Ae=>Ae.scale(j,ie).add(j/2,ie/2)),N]:null}};return i.use(qe),i.onNavigationMapInvalid(()=>{i.invalidateNavigationMap(),i.trigger("navigation_map_changed")}),t.forEach((x,N)=>{let U=x.split("");a=Math.max(U.length,a),U.forEach((j,ie)=>{i.spawn(j,B(ie,N))})}),i}s(hi,"addLevel");function ci(t={}){let r=null,i=null,o=null,a=null;return{id:"agent",require:["pos","tile"],agentSpeed:t.speed??100,allowDiagonals:t.allowDiagonals??!0,getDistanceToTarget(){return r?this.pos.dist(r):0},getNextLocation(){return i&&o?i[o]:null},getPath(){return i?i.slice():null},getTarget(){return r},isNavigationFinished(){return i?o===null:!0},isTargetReachable(){return i!==null},isTargetReached(){return r?this.pos.eq(r):!0},setTarget(u){r=u,i=this.getLevel().getPath(this.pos,r,{allowDiagonals:this.allowDiagonals}),o=i?0:null,i?(a||(a=this.getLevel().onNavigationMapChanged(()=>{i&&o!==null&&(i=this.getLevel().getPath(this.pos,r,{allowDiagonals:this.allowDiagonals}),o=i?0:null,i?this.trigger("navigation-next",this,i[o]):this.trigger("navigation-ended",this))}),this.onDestroy(()=>a.cancel())),this.trigger("navigation-started",this),this.trigger("navigation-next",this,i[o])):this.trigger("navigation-ended",this)},update(){if(i&&o!==null){if(this.pos.sdist(i[o])<2)if(o===i.length-1){this.pos=r.clone(),o=null,this.trigger("navigation-ended",this),this.trigger("target-reached",this);return}else o++,this.trigger("navigation-next",this,i[o]);this.moveTo(i[o],this.agentSpeed)}},onNavigationStarted(u){return this.on("navigation-started",u)},onNavigationNext(u){return this.on("navigation-next",u)},onNavigationEnded(u){return this.on("navigation-ended",u)},onTargetReached(u){return this.on("target-reached",u)},inspect(){return JSON.stringify({target:JSON.stringify(r),path:JSON.stringify(i)})}}}s(ci,"agent");function di(t){let r=M.canvas().captureStream(t),i=k.ctx.createMediaStreamDestination();k.masterNode.connect(i);let o=new MediaRecorder(r),a=[];return o.ondataavailable=u=>{u.data.size>0&&a.push(u.data)},o.onerror=()=>{k.masterNode.disconnect(i),r.getTracks().forEach(u=>u.stop())},o.start(),{resume(){o.resume()},pause(){o.pause()},stop(){return o.stop(),k.masterNode.disconnect(i),r.getTracks().forEach(u=>u.stop()),new Promise(u=>{o.onstop=()=>{u(new Blob(a,{type:"video/mp4"}))}})},download(u="kaboom.mp4"){this.stop().then(l=>sn(u,l))}}}s(di,"record");function pi(){return document.activeElement===M.canvas()}s(pi,"isFocused");function fi(t){t.destroy()}s(fi,"destroy");let rr=R.root.add.bind(R.root),Mo=R.root.readd.bind(R.root),Po=R.root.removeAll.bind(R.root),gi=R.root.get.bind(R.root);function zr(t=2,r=1){let i=0;return{id:"boom",require:["scale"],update(){let o=Math.sin(i*t)*r;o<0&&this.destroy(),this.scale=B(o),i+=We()}}}s(zr,"boom");let To=_e(null,Jo),Ro=_e(null,Xo);function mi(t,r={}){let i=rr([$t(t),Hr()]),o=(r.speed||1)*5,a=r.scale||1;i.add([pr(Ro),er(0),dr("center"),zr(o,a),...r.comps??[]]);let u=i.add([pr(To),er(0),dr("center"),qr(),...r.comps??[]]);return u.wait(.4/o,()=>u.use(zr(o,a))),u.onDestroy(()=>i.destroy()),i}s(mi,"addKaboom");function Qr(){R.root.update()}s(Qr,"updateFrame");class gr{source;target;displacement;resolved=!1;constructor(r,i,o,a=!1){this.source=r,this.target=i,this.displacement=o,this.resolved=a}reverse(){return new gr(this.target,this.source,this.displacement.scale(-1),this.resolved)}hasOverlap(){return!this.displacement.isZero()}isLeft(){return this.displacement.x>0}isRight(){return this.displacement.x<0}isTop(){return this.displacement.y>0}isBottom(){return this.displacement.y<0}preventResolution(){this.resolved=!0}}s(gr,"Collision");function wi(){let t={},r=e.hashGridSize||ts,i=new Ve,o=[];function a(u){if(o.push(i.clone()),u.pos&&i.translate(u.pos),u.scale&&i.scale(u.scale),u.angle&&i.rotate(u.angle),u.transform=i.clone(),u.c("area")&&!u.paused){let l=u,g=l.worldArea().bbox(),f=Math.floor(g.pos.x/r),A=Math.floor(g.pos.y/r),T=Math.ceil((g.pos.x+g.width)/r),Y=Math.ceil((g.pos.y+g.height)/r),oe=new Set;for(let re=f;re<=T;re++)for(let he=A;he<=Y;he++)if(!t[re])t[re]={},t[re][he]=[l];else if(!t[re][he])t[re][he]=[l];else{let _=t[re][he];e:for(let $ of _){if(!$.exists()||oe.has($.id))continue;for(let ee of l.collisionIgnore)if($.is(ee))continue e;for(let ee of $.collisionIgnore)if(l.is(ee))continue e;let Fe=eo(l.worldArea(),$.worldArea());if(Fe){let ee=new gr(l,$,Fe);l.trigger("collideUpdate",$,ee);let ce=ee.reverse();ce.resolved=ee.resolved,$.trigger("collideUpdate",l,ce)}oe.add($.id)}_.push(l)}}u.children.forEach(a),i=o.pop()}s(a,"checkObj"),a(R.root)}s(wi,"checkFrame");function Ai(){let t=R.cam,r=S.fromAngle(sr(0,360)).scale(t.shake);t.shake=et(t.shake,0,5*We()),t.transform=new Ve().translate(tr()).scale(t.scale).rotate(t.angle).translate((t.pos??tr()).scale(-1).add(r)),R.root.draw(),F()}s(Ai,"drawFrame");function vi(){let t=Ne();R.events.numListeners("loading")>0?R.events.trigger("loading",t):at(()=>{let r=Te()/2,i=24,o=B(Te()/2,Be()/2).sub(B(r/2,i/2));pe({pos:B(0),width:Te(),height:Be(),color:de(0,0,0)}),pe({pos:o,width:r,height:i,fill:!1,outline:{width:4}}),pe({pos:o,width:r*t,height:i})})}s(vi,"drawLoadScreen");function Jr(t,r){at(()=>{let i=B(8);K(),v(t);let o=yt({text:r,font:br,size:16,pos:i,color:de(255,255,255),fixed:!0}),a=o.width+i.x*2,u=o.height+i.x*2;t.x+a>=Te()&&v(B(-a,0)),t.y+u>=Be()&&v(B(0,-u)),pe({width:a,height:u,color:de(0,0,0),radius:4,opacity:.8,fixed:!0}),bt(o),ge()})}s(Jr,"drawInspectText");function yi(){if(me.inspect){let t=null;for(let r of R.root.get("*",{recursive:!0}))if(r.c("area")&&r.isHovering()){t=r;break}if(R.root.drawInspect(),t){let r=[],i=t.inspect();for(let o in i)i[o]?r.push(`${o}: ${i[o]}`):r.push(`${o}`);Jr(Vn(Qt()),r.join(`
`))}Jr(B(8),`FPS: ${me.fps()}`)}me.paused&&at(()=>{K(),v(Te(),0),v(-8,8);let t=32;pe({width:t,height:t,anchor:"topright",color:de(0,0,0),opacity:.8,radius:4,fixed:!0});for(let r=1;r<=2;r++)pe({width:4,height:t*.6,anchor:"center",pos:B(-t/3*r,t*.5),color:de(255,255,255),radius:2,fixed:!0});ge()}),me.timeScale!==1&&at(()=>{K(),v(Te(),Be()),v(-8,-8);let t=8,r=yt({text:me.timeScale.toFixed(1),font:br,size:16,color:de(255,255,255),pos:B(-t),anchor:"botright",fixed:!0});pe({width:r.width+t*2+t*4,height:r.height+t*2,anchor:"botright",color:de(0,0,0),opacity:.8,radius:4,fixed:!0});for(let i=0;i<2;i++){let o=me.timeScale<1;Br({p1:B(-r.width-t*(o?2:3.5),-t),p2:B(-r.width-t*(o?2:3.5),-t-r.height),p3:B(-r.width-t*(o?3.5:2),-t-r.height/2),pos:B(-i*t*1+(o?-t*.5:0),0),color:de(255,255,255),fixed:!0})}bt(r),ge()}),me.curRecording&&at(()=>{K(),v(0,Be()),v(24,-24),Ft({radius:12,color:de(255,0,0),opacity:nn(0,1,M.time()*4),fixed:!0}),ge()}),me.showLog&&R.logs.length>0&&at(()=>{K(),v(0,Be()),v(8,-8);let t=8,r=yt({text:R.logs.join(`
`),font:br,pos:B(t,-t),anchor:"botleft",size:16,width:Te()*.6,lineSpacing:t/2,fixed:!0,styles:{time:{color:de(127,127,127)},info:{color:de(255,255,255)},error:{color:de(255,0,127)}}});pe({width:r.width+t*2,height:r.height+t*2,anchor:"botleft",color:de(0,0,0),radius:4,opacity:.8,fixed:!0}),bt(r),ge()})}s(yi,"drawDebug"),e.debug!==!1&&Gr(),e.burp&&Wr();function bi(t){R.events.on("loading",t)}s(bi,"onLoading");function Vi(t){M.onResize(t)}s(Vi,"onResize");function Ei(t){R.events.on("error",t)}s(Ei,"onError");function mr(t){M.run(()=>{at(()=>{let r=Te(),i=Be(),o={size:36,width:r-32*2,letterSpacing:4,lineSpacing:4,font:br,fixed:!0};pe({width:r,height:i,color:de(0,0,255),fixed:!0});let a=yt({...o,text:t.name,pos:B(32),color:de(255,128,0),fixed:!0});bt(a),Or({...o,text:t.message,pos:B(32,32+a.height+16),fixed:!0}),ge(),R.events.trigger("error",t)})})}s(mr,"handleErr");function xi(t){ae.push(t)}s(xi,"onCleanup");function Si(){R.events.onOnce("frameEnd",()=>{M.quit();for(let r in _t)window.removeEventListener(r,_t[r]);d.clear(d.COLOR_BUFFER_BIT|d.DEPTH_BUFFER_BIT|d.STENCIL_BUFFER_BIT);let t=d.getParameter(d.MAX_TEXTURE_IMAGE_UNITS);for(let r=0;r<t;r++)d.activeTexture(d.TEXTURE0+r),d.bindTexture(d.TEXTURE_2D,null),d.bindTexture(d.TEXTURE_CUBE_MAP,null);d.bindBuffer(d.ARRAY_BUFFER,null),d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,null),d.bindRenderbuffer(d.RENDERBUFFER,null),d.bindFramebuffer(d.FRAMEBUFFER,null),ae.forEach(r=>r()),d.deleteBuffer(b.vbuf),d.deleteBuffer(b.ibuf)})}s(Si,"quit");function wr(t,r,i,o,a=ir.linear){let u=0,l=[],g=Lr(()=>{u+=We();let f=Math.min(u/i,1);o(et(t,r,a(f))),f===1&&(g.cancel(),o(r),l.forEach(A=>A()))});return{get paused(){return g.paused},set paused(f){g.paused=f},onEnd(f){l.push(f)},then(f){return this.onEnd(f),this},cancel(){g.cancel()},finish(){g.cancel(),o(r),l.forEach(f=>f())}}}s(wr,"tween");let Ar=!0;M.run(()=>{L.loaded||Ne()===1&&!Ar&&(L.loaded=!0,R.events.trigger("load")),!L.loaded&&e.loadingScreen!==!1||Ar?(X(),vi(),G()):(me.paused||Qr(),wi(),X(),Ai(),e.debug!==!1&&yi(),G()),Ar&&(Ar=!1),R.events.trigger("frameEnd")});function Xr(){let t=O,r=d.drawingBufferWidth/t,i=d.drawingBufferHeight/t;if(M.isFullscreen()){let o=window.innerWidth,a=window.innerHeight,u=o/a,l=r/i;if(u>l){let g=window.innerHeight*l;b.viewport={x:(o-g)/2,y:0,width:g,height:a}}else{let g=window.innerWidth/l;b.viewport={x:0,y:(a-g)/2,width:o,height:g}}return}if(e.letterbox){if(!e.width||!e.height)throw new Error("Letterboxing requires width and height defined.");let o=r/i,a=e.width/e.height;if(o>a){let u=i*a,l=(r-u)/2;b.viewport={x:l,y:0,width:u,height:i}}else{let u=r/a,l=(i-u)/2;b.viewport={x:0,y:l,width:r,height:u}}return}if(e.stretch&&(!e.width||!e.height))throw new Error("Stretching requires width and height defined.");b.viewport={x:0,y:0,width:r,height:i}}s(Xr,"updateViewport"),M.onResize(()=>{if(M.isFullscreen())return;let t=e.width&&e.height;t&&!e.stretch&&!e.letterbox||(c.width=c.offsetWidth*O,c.height=c.offsetHeight*O,Xr(),t||(b.frameBuffer.free(),b.frameBuffer=new ke(d.drawingBufferWidth,d.drawingBufferHeight),b.width=d.drawingBufferWidth/O,b.height=d.drawingBufferHeight/O))}),Xr();let Wt={VERSION:Zo,loadRoot:Qe,loadProgress:Ne,loadSprite:_e,loadSpriteAtlas:pt,loadSound:Mt,loadBitmapFont:it,loadFont:Nt,loadShader:St,loadShaderURL:we,loadAseprite:xt,loadPedit:Xe,loadBean:Pt,loadJSON:ct,load:Oe,getSprite:Ee,getSound:ft,getFont:gt,getBitmapFont:mt,getShader:je,getAsset:Tt,Asset:I,SpriteData:le,SoundData:C,width:Te,height:Be,center:tr,dt:We,time:M.time,screenshot:M.screenshot,record:di,isFocused:pi,setCursor:M.setCursor,getCursor:M.getCursor,setCursorLocked:M.setCursorLocked,isCursorLocked:M.isCursorLocked,setFullscreen:M.setFullscreen,isFullscreen:M.isFullscreen,isTouchscreen:M.isTouchscreen,onLoad:fr,onLoading:bi,onResize:Vi,onGamepadConnect:M.onGamepadConnect,onGamepadDisconnect:M.onGamepadDisconnect,onError:Ei,onCleanup:xi,camPos:En,camScale:xn,camRot:Sn,shake:Mn,toScreen:ur,toWorld:Nr,setGravity:Dn,getGravity:Un,setBackground:On,getBackground:Nn,getGamepads:M.getGamepads,add:rr,make:hr,destroy:fi,destroyAll:Po,get:gi,readd:Mo,pos:$t,scale:er,rotate:Ln,color:_n,opacity:Gn,anchor:dr,area:Kn,sprite:pr,text:Yn,rect:zn,circle:Jn,uvquad:Qn,outline:Xn,body:Zn,doubleJump:$n,shader:ei,timer:qr,fixed:ti,stay:Hr,health:ri,lifespan:ni,z:Wn,move:Hn,offscreen:jn,follow:qn,state:ii,fadeIn:oi,tile:Yr,agent:ci,on:lt,onUpdate:Lr,onDraw:bo,onAdd:cr,onDestroy:_r,onClick:Cn,onCollide:Pn,onCollideUpdate:Tn,onCollideEnd:Rn,onHover:Bn,onHoverUpdate:Fn,onHoverEnd:kn,onKeyDown:M.onKeyDown,onKeyPress:M.onKeyPress,onKeyPressRepeat:M.onKeyPressRepeat,onKeyRelease:M.onKeyRelease,onMouseDown:M.onMouseDown,onMousePress:M.onMousePress,onMouseRelease:M.onMouseRelease,onMouseMove:M.onMouseMove,onCharInput:M.onCharInput,onTouchStart:M.onTouchStart,onTouchMove:M.onTouchMove,onTouchEnd:M.onTouchEnd,onScroll:M.onScroll,onGamepadButtonDown:M.onGamepadButtonDown,onGamepadButtonPress:M.onGamepadButtonPress,onGamepadButtonRelease:M.onGamepadButtonRelease,onGamepadStick:M.onGamepadStick,mousePos:Qt,mouseDeltaPos:M.mouseDeltaPos,isKeyDown:M.isKeyDown,isKeyPressed:M.isKeyPressed,isKeyPressedRepeat:M.isKeyPressedRepeat,isKeyReleased:M.isKeyReleased,isMouseDown:M.isMouseDown,isMousePressed:M.isMousePressed,isMouseReleased:M.isMouseReleased,isMouseMoved:M.isMouseMoved,isGamepadButtonPressed:M.isGamepadButtonPressed,isGamepadButtonDown:M.isGamepadButtonDown,isGamepadButtonReleased:M.isGamepadButtonReleased,charInputted:M.charInputted,loop:In,wait:Zt,play:Ke,volume:Ct,burp:At,audioCtx:k.ctx,Timer:ao,Line:ht,Rect:xe,Circle:Sr,Polygon:Ut,Vec2:S,Color:te,Mat4:Ve,Quad:ye,RNG:ln,rand:sr,randi:un,randSeed:Ki,vec2:B,rgb:de,hsl2rgb:Wo,quad:ve,choose:zi,chance:Yi,lerp:et,tween:wr,easings:ir,map:xr,mapc:ji,wave:nn,deg2rad:$e,rad2deg:jt,testLineLine:qt,testRectRect:Qi,testRectLine:Xi,testRectPoint:ar,testCirclePolygon:$i,testLinePoint:Zi,testLineCircle:hn,drawSprite:lr,drawText:Or,formatText:yt,drawRect:pe,drawLine:st,drawLines:Lt,drawTriangle:Br,drawCircle:Ft,drawEllipse:Fr,drawUVQuad:Me,drawPolygon:vt,drawFormattedText:bt,drawMasked:wn,drawSubtracted:An,pushTransform:K,popTransform:ge,pushTranslate:v,pushScale:P,pushRotate:H,pushMatrix:h,usePostEffect:Ce,debug:me,scene:si,go:ai,onSceneLeave:li,addLevel:hi,getData:ui,setData:jr,download:Pr,downloadJSON:no,downloadText:gn,downloadBlob:sn,plug:Kr,ASCII_CHARS:ki,canvas:M.canvas(),addKaboom:mi,LEFT:S.LEFT,RIGHT:S.RIGHT,UP:S.UP,DOWN:S.DOWN,RED:te.RED,GREEN:te.GREEN,BLUE:te.BLUE,YELLOW:te.YELLOW,MAGENTA:te.MAGENTA,CYAN:te.CYAN,WHITE:te.WHITE,BLACK:te.BLACK,quit:Si,Event:Ye,EventHandler:Ht,EventController:Vt};if(e.plugins&&e.plugins.forEach(Kr),e.global!==!1)for(let t in Wt)window[t]=Wt[t];return M.canvas().focus(),Wt},"default");var yo=No(mo());var Ao=e=>{let n=Math.floor(e/60),c=e%60;return`${wo(n)}:${wo(c)}`},wo=e=>e.toString().padStart(2,"0");(function(){var e={},n="";try{n=location.hash.toString()}catch{}var c=Q(n),E=le("initParams");if(E)for(var y in E)typeof c[y]>"u"&&(c[y]=E[y]);b("initParams",c);var W=!1,Z;try{if(W=window.parent!=null&&window!=window.parent,W){window.addEventListener("message",function(C){if(C.source===window.parent){try{var k=JSON.parse(C.data)}catch{return}!k||!k.eventType||(k.eventType=="set_custom_style"?Z.innerHTML=k.eventData:ae(k.eventType,k.eventData))}}),Z=document.createElement("style"),document.head.appendChild(Z);try{window.parent.postMessage(JSON.stringify({eventType:"iframe_ready"}),"*")}catch{}}}catch{}function O(C){try{return C=C.replace(/\+/g,"%20"),decodeURIComponent(C)}catch{return C}}function Q(C){C=C.replace(/^#/,"");var k={};if(!C.length)return k;if(C.indexOf("=")<0&&C.indexOf("?")<0)return k._path=O(C),k;var I=C.indexOf("?");if(I>=0){var J=C.substr(0,I);k._path=O(J),C=C.substr(I+1)}var L=q(C);for(var R in L)k[R]=L[R];return k}function q(C){var k={};if(!C.length)return k;var I=C.split("&"),J,L,R,Oe;for(J=0;J<I.length;J++)L=I[J].split("="),R=O(L[0]),Oe=L[1]==null?null:O(L[1]),k[R]=Oe;return k}function se(C,k){var I=C.indexOf("#");if(I<0)return C+"#"+k;var J=C.substr(I+1);return J.indexOf("=")>=0||J.indexOf("?")>=0?C+"&"+k:J.length>0?C+"?"+k:C+k}function M(C,k,I){if(k||(k=function(){}),I===void 0&&(I=""),window.TelegramWebviewProxy!==void 0)TelegramWebviewProxy.postEvent(C,JSON.stringify(I)),k();else if(window.external&&"notify"in window.external)window.external.notify(JSON.stringify({eventType:C,eventData:I})),k();else if(W)try{var J="https://web.telegram.org";J="*",window.parent.postMessage(JSON.stringify({eventType:C,eventData:I}),J),c.tgWebAppDebug&&console.log("[Telegram.WebView] postEvent via postMessage",C,I),k()}catch(L){k(L)}else c.tgWebAppDebug&&console.log("[Telegram.WebView] postEvent",C,I),k({notAvailable:!0})}function ae(C,k){d(C,function(I){I(C,k)})}function d(C,k){var I=e[C];if(!(I===void 0||!I.length))for(var J=0;J<I.length;J++)try{k(I[J])}catch{}}function ne(C,k){e[C]===void 0&&(e[C]=[]);var I=e[C].indexOf(k);I===-1&&e[C].push(k)}function He(C,k){if(e[C]!==void 0){var I=e[C].indexOf(k);I!==-1&&e[C].splice(I,1)}}function ke(C){if(!C.match(/^(web\+)?tgb?:\/\/./))return!1;var k=!!navigator.userAgent.match(/iOS|iPhone OS|iPhone|iPod|iPad/i);if(k){var I=document.getElementById("tgme_frame_cont")||document.body,J=document.createElement("iframe");I.appendChild(J);var L=!1,R=function(){L=!0};window.addEventListener("pagehide",R,!1),window.addEventListener("blur",R,!1),J!==null&&(J.src=C),setTimeout(function(){L||(window.location=C),window.removeEventListener("pagehide",R,!1),window.removeEventListener("blur",R,!1)},2e3)}else window.location=C;return!0}function b(C,k){try{return window.sessionStorage.setItem("__telegram__"+C,JSON.stringify(k)),!0}catch{}return!1}function le(C){try{return JSON.parse(window.sessionStorage.getItem("__telegram__"+C))}catch{}return null}window.Telegram||(window.Telegram={}),window.Telegram.WebView={initParams:c,isIframe:W,onEvent:ne,offEvent:He,postEvent:M,receiveEvent:ae,callEventCallbacks:d},window.Telegram.Utils={urlSafeDecode:O,urlParseQueryString:q,urlParseHashParams:Q,urlAppendHashParams:se,sessionStorageSet:b,sessionStorageGet:le},window.TelegramGameProxy_receiveEvent=ae,window.TelegramGameProxy={receiveEvent:ae}})();(function(){var e=window.Telegram.Utils,n=window.Telegram.WebView,c=n.initParams,E=n.isIframe,y={},W="",Z={},O={},Q="light",q="6.0",se="unknown";if(c.tgWebAppData&&c.tgWebAppData.length){W=c.tgWebAppData,Z=e.urlParseQueryString(W);for(var M in Z){var ae=Z[M];try{(ae.substr(0,1)=="{"&&ae.substr(-1)=="}"||ae.substr(0,1)=="["&&ae.substr(-1)=="]")&&(Z[M]=JSON.parse(ae))}catch{}}}if(c.tgWebAppThemeParams&&c.tgWebAppThemeParams.length){var d=c.tgWebAppThemeParams;try{var ne=JSON.parse(d);ne&&Oe(ne)}catch{}}var ne=e.sessionStorageGet("themeParams");ne&&Oe(ne),c.tgWebAppVersion&&(q=c.tgWebAppVersion),c.tgWebAppPlatform&&(se=c.tgWebAppPlatform);function He(w,m){m.theme_params&&(Oe(m.theme_params),window.Telegram.WebApp.MainButton.setParams({}),_e(),I("themeChanged"))}var ke=window.innerHeight;function b(w,m){m.height&&(window.removeEventListener("resize",le),tt(m))}function le(w){ke!=window.innerHeight&&(ke=window.innerHeight,I("viewportChanged",{isStateStable:!0}))}function C(w){if(!(w.metaKey||w.ctrlKey)){for(var m=w.target;m.tagName!="A"&&m.parentNode;)m=m.parentNode;m.tagName=="A"&&m.target!="_blank"&&(m.protocol=="http:"||m.protocol=="https:")&&m.hostname=="t.me"&&(y.openTgLink(m.href),w.preventDefault())}}function k(w){return w.toString().replace(/^\s+|\s+$/g,"")}function I(w){var m=Array.prototype.slice.call(arguments);w=m.shift(),n.callEventCallbacks("webview:"+w,function(V){V.apply(y,m)})}function J(w,m){n.onEvent("webview:"+w,m)}function L(w,m){n.offEvent("webview:"+w,m)}function R(w,m){var V=document.documentElement;V&&V.style&&V.style.setProperty&&V.style.setProperty("--tg-"+w,m)}function Oe(w){w.bg_color=="#1c1c1d"&&w.bg_color==w.secondary_bg_color&&(w.secondary_bg_color="#2c2c2e");var m;for(var V in w)(m=Xe(w[V]))&&(O[V]=m,V=="bg_color"&&(Q=xt(m)?"dark":"light",R("color-scheme",Q)),V="theme-"+V.split("_").join("-"),R(V,m));e.sessionStorageSet("themeParams",O)}function Ne(w){for(var m="",V="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789",F=V.length,X=0;X<w;X++)m+=V[Math.floor(Math.random()*F)];return m}var Qe=!1,Le=!1,Je=!0;function tt(w){typeof w<"u"&&(Je=!!w.is_expanded,Qe=w.height,w.is_state_stable&&(Le=w.height),I("viewportChanged",{isStateStable:!!w.is_state_stable}));var m,V;Qe!==!1?m=Qe-Ee+"px":m=Ee?"calc(100vh - "+Ee+"px)":"100vh",Le!==!1?V=Le-Ee+"px":V=Ee?"calc(100vh - "+Ee+"px)":"100vh",R("viewport-height",m),R("viewport-stable-height",V)}var rt=!1;function Ze(w){if(!we("6.2")){console.warn("[Telegram.WebApp] Closing confirmation is not supported in version "+q);return}rt=!!w,n.postEvent("web_app_setup_closing_behavior",!1,{need_confirmation:rt})}var ct="bg_color";function nt(){return O[ct]||null}function Nt(w){if(!we("6.1")){console.warn("[Telegram.WebApp] Header color is not supported in version "+q);return}var m;if(w=="bg_color"||w=="secondary_bg_color"?m=w:(m=Xe(w),O.bg_color&&O.bg_color==m?m="bg_color":O.secondary_bg_color&&O.secondary_bg_color==m?m="secondary_bg_color":m=!1),m!="bg_color"&&m!="secondary_bg_color")throw console.error("[Telegram.WebApp] Header color key should be one of Telegram.WebApp.themeParams.bg_color, Telegram.WebApp.themeParams.secondary_bg_color, 'bg_color', 'secondary_bg_color'",w),Error("WebAppHeaderColorKeyInvalid");ct=m,n.postEvent("web_app_set_header_color",!1,{color_key:m})}var it="bg_color";function dt(){return it=="secondary_bg_color"?O.secondary_bg_color:it=="bg_color"?O.bg_color:it}function pt(w){if(!we("6.1")){console.warn("[Telegram.WebApp] Background color is not supported in version "+q);return}var m;if(w=="bg_color"||w=="secondary_bg_color")m=w;else if(m=Xe(w),!m)throw console.error("[Telegram.WebApp] Background color format is invalid",w),Error("WebAppBackgroundColorInvalid");it=m,_e()}var ot=null;function _e(){var w=dt();ot!=w&&(ot=w,n.postEvent("web_app_set_background_color",!1,{color:w}))}function Xe(w){w+="";var m;if(m=/^\s*#([0-9a-f]{6})\s*$/i.exec(w))return"#"+m[1].toLowerCase();if(m=/^\s*#([0-9a-f])([0-9a-f])([0-9a-f])\s*$/i.exec(w))return("#"+m[1]+m[1]+m[2]+m[2]+m[3]+m[3]).toLowerCase();if(m=/^\s*rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d+\.{0,1}\d*))?\)\s*$/.exec(w)){var V=parseInt(m[1]),F=parseInt(m[2]),X=parseInt(m[3]);return V=(V<16?"0":"")+V.toString(16),F=(F<16?"0":"")+F.toString(16),X=(X<16?"0":"")+X.toString(16),"#"+V+F+X}return!1}function xt(w){w=w.replace(/[\s#]/g,""),w.length==3&&(w=w[0]+w[0]+w[1]+w[1]+w[2]+w[2]);var m=parseInt(w.substr(0,2),16),V=parseInt(w.substr(2,2),16),F=parseInt(w.substr(4,2),16),X=Math.sqrt(.299*(m*m)+.587*(V*V)+.114*(F*F));return X<120}function St(w,m){typeof w!="string"&&(w=""),typeof m!="string"&&(m=""),w=w.replace(/^\s+|\s+$/g,"").split("."),m=m.replace(/^\s+|\s+$/g,"").split(".");var V=Math.max(w.length,m.length),F,X,Ce;for(F=0;F<V;F++)if(X=parseInt(w[F])||0,Ce=parseInt(m[F])||0,X!=Ce)return X>Ce?1:-1;return 0}function we(w){return St(q,w)>=0}function Mt(w){if(window.Blob)try{return new Blob([w]).size}catch{}for(var m=w.length,V=w.length-1;V>=0;V--){var F=w.charCodeAt(V);F>127&&F<=2047?m++:F>2047&&F<=65535&&(m+=2),F>=56320&&F<=57343&&V--}return m}var Pt=function(){var w=!1,m={};Object.defineProperty(m,"isVisible",{set:function(v){h({is_visible:v})},get:function(){return w},enumerable:!0});var V=null;n.onEvent("back_button_pressed",F);function F(){I("backButtonClicked")}function X(){return{is_visible:w}}function Ce(v){return typeof v>"u"&&(v=X()),JSON.stringify(v)}function G(){return we("6.1")?!0:(console.warn("[Telegram.WebApp] BackButton is not supported in version "+q),!1)}function De(){var v=X(),P=Ce(v);V!==P&&(V=P,n.postEvent("web_app_setup_back_button",!1,v))}function h(v){return G()&&(typeof v.is_visible<"u"&&(w=!!v.is_visible),De()),m}return m.onClick=function(v){return G()&&J("backButtonClicked",v),m},m.offClick=function(v){return G()&&L("backButtonClicked",v),m},m.show=function(){return h({is_visible:!0})},m.hide=function(){return h({is_visible:!1})},m}(),Ee=0,ft=function(){var w=!1,m=!0,V=!1,F="CONTINUE",X=!1,Ce=!1,G={};Object.defineProperty(G,"text",{set:function(D){G.setParams({text:D})},get:function(){return F},enumerable:!0}),Object.defineProperty(G,"color",{set:function(D){G.setParams({color:D})},get:function(){return X||O.button_color||"#2481cc"},enumerable:!0}),Object.defineProperty(G,"textColor",{set:function(D){G.setParams({text_color:D})},get:function(){return Ce||O.button_text_color||"#ffffff"},enumerable:!0}),Object.defineProperty(G,"isVisible",{set:function(D){G.setParams({is_visible:D})},get:function(){return w},enumerable:!0}),Object.defineProperty(G,"isProgressVisible",{get:function(){return V},enumerable:!0}),Object.defineProperty(G,"isActive",{set:function(D){G.setParams({is_active:D})},get:function(){return m},enumerable:!0});var De=null;n.onEvent("main_button_pressed",H);var h=null,v={};if(c.tgWebAppDebug){h=document.createElement("tg-main-button"),v={font:"600 14px/18px sans-serif",display:"none",width:"100%",height:"48px",borderRadius:"0",background:"no-repeat right center",position:"fixed",left:"0",right:"0",bottom:"0",margin:"0",padding:"15px 20px",textAlign:"center",boxSizing:"border-box",zIndex:"10000"};for(var P in v)h.style[P]=v[P];document.addEventListener("DOMContentLoaded",function D(pe){document.removeEventListener("DOMContentLoaded",D),document.body.appendChild(h),h.addEventListener("click",H,!1)})}function H(){m&&I("mainButtonClicked")}function K(){var D=G.color,pe=G.textColor;return w?{is_visible:!0,is_active:m,is_progress_visible:V,text:F,color:D,text_color:pe}:{is_visible:!1}}function ge(D){return typeof D>"u"&&(D=K()),JSON.stringify(D)}function Me(){var D=K(),pe=ge(D);De!==pe&&(De=pe,n.postEvent("web_app_setup_main_button",!1,D),c.tgWebAppDebug&&Bt(D))}function Bt(D){D.is_visible?(h.style.display="block",Ee=48,h.style.opacity=D.is_active?"1":"0.8",h.style.cursor=D.is_active?"pointer":"auto",h.disabled=!D.is_active,h.innerText=D.text,h.style.backgroundImage=D.is_progress_visible?"url('data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20xmlns%3Axlink%3D%22http%3A%2F%2Fwww.w3.org%2F1999%2Fxlink%22%20viewport%3D%220%200%2048%2048%22%20width%3D%2248px%22%20height%3D%2248px%22%3E%3Ccircle%20cx%3D%2250%25%22%20cy%3D%2250%25%22%20stroke%3D%22%23fff%22%20stroke-width%3D%222.25%22%20stroke-linecap%3D%22round%22%20fill%3D%22none%22%20stroke-dashoffset%3D%22106%22%20r%3D%229%22%20stroke-dasharray%3D%2256.52%22%20rotate%3D%22-90%22%3E%3Canimate%20attributeName%3D%22stroke-dashoffset%22%20attributeType%3D%22XML%22%20dur%3D%22360s%22%20from%3D%220%22%20to%3D%2212500%22%20repeatCount%3D%22indefinite%22%3E%3C%2Fanimate%3E%3CanimateTransform%20attributeName%3D%22transform%22%20attributeType%3D%22XML%22%20type%3D%22rotate%22%20dur%3D%221s%22%20from%3D%22-90%2024%2024%22%20to%3D%22630%2024%2024%22%20repeatCount%3D%22indefinite%22%3E%3C%2FanimateTransform%3E%3C%2Fcircle%3E%3C%2Fsvg%3E')":"none",h.style.backgroundColor=D.color,h.style.color=D.text_color):(h.style.display="none",Ee=0),document.documentElement&&(document.documentElement.style.boxSizing="border-box",document.documentElement.style.paddingBottom=Ee+"px"),tt()}function lr(D){if(typeof D.text<"u"){var pe=k(D.text);if(!pe.length)throw console.error("[Telegram.WebApp] Main button text is required",D.text),Error("WebAppMainButtonParamInvalid");if(pe.length>64)throw console.error("[Telegram.WebApp] Main button text is too long",pe),Error("WebAppMainButtonParamInvalid");F=pe}if(typeof D.color<"u")if(D.color===!1||D.color===null)X=!1;else{var st=Xe(D.color);if(!st)throw console.error("[Telegram.WebApp] Main button color format is invalid",D.color),Error("WebAppMainButtonParamInvalid");X=st}if(typeof D.text_color<"u")if(D.text_color===!1||D.text_color===null)Ce=!1;else{var Lt=Xe(D.text_color);if(!Lt)throw console.error("[Telegram.WebApp] Main button text color format is invalid",D.text_color),Error("WebAppMainButtonParamInvalid");Ce=Lt}if(typeof D.is_visible<"u"){if(D.is_visible&&!G.text.length)throw console.error("[Telegram.WebApp] Main button text is required"),Error("WebAppMainButtonParamInvalid");w=!!D.is_visible}return typeof D.is_active<"u"&&(m=!!D.is_active),Me(),G}return G.setText=function(D){return G.setParams({text:D})},G.onClick=function(D){return J("mainButtonClicked",D),G},G.offClick=function(D){return L("mainButtonClicked",D),G},G.show=function(){return G.setParams({is_visible:!0})},G.hide=function(){return G.setParams({is_visible:!1})},G.enable=function(){return G.setParams({is_active:!0})},G.disable=function(){return G.setParams({is_active:!1})},G.showProgress=function(D){return m=!!D,V=!0,Me(),G},G.hideProgress=function(){return G.isActive||(m=!0),V=!1,Me(),G},G.setParams=lr,G}();function gt(){I("settingsButtonClicked")}n.onEvent("settings_button_pressed",gt);var mt=function(){var w={};function m(V){if(!we("6.1"))return console.warn("[Telegram.WebApp] HapticFeedback is not supported in version "+q),w;if(V.type=="impact"){if(V.impact_style!="light"&&V.impact_style!="medium"&&V.impact_style!="heavy"&&V.impact_style!="rigid"&&V.impact_style!="soft")throw console.error("[Telegram.WebApp] Haptic impact style is invalid",V.impact_style),Error("WebAppHapticImpactStyleInvalid")}else if(V.type=="notification"){if(V.notification_type!="error"&&V.notification_type!="success"&&V.notification_type!="warning")throw console.error("[Telegram.WebApp] Haptic notification type is invalid",V.notification_type),Error("WebAppHapticNotificationTypeInvalid")}else if(V.type!="selection_change")throw console.error("[Telegram.WebApp] Haptic feedback type is invalid",V.type),Error("WebAppHapticFeedbackTypeInvalid");return n.postEvent("web_app_trigger_haptic_feedback",!1,V),w}return w.impactOccurred=function(V){return m({type:"impact",impact_style:V})},w.notificationOccurred=function(V){return m({type:"notification",notification_type:V})},w.selectionChanged=function(){return m({type:"selection_change"})},w}(),je={};function Tt(w,m){if(m.slug&&je[m.slug]){var V=je[m.slug];delete je[m.slug],V.callback&&V.callback(m.status),I("invoiceClosed",{url:V.url,status:m.status})}}var Ge=!1;function Rt(w,m){if(Ge){var V=Ge;Ge=!1;var F=null;typeof m.button_id<"u"&&(F=m.button_id),V.callback&&V.callback(F),I("popupClosed",{button_id:F})}}var Ie=!1;function wt(w,m){if(Ie){var V=Ie,F=null;typeof m.data<"u"&&(F=m.data),V.callback&&V.callback(F)&&(Ie=!1,n.postEvent("web_app_close_scan_qr_popup",!1)),I("qrTextReceived",{data:F})}}function Ct(w,m){Ie=!1}var Ke={};function At(w,m){if(m.req_id&&Ke[m.req_id]){var V=Ke[m.req_id];delete Ke[m.req_id];var F=null;typeof m.data<"u"&&(F=m.data),V.callback&&V.callback(F),I("clipboardTextReceived",{data:F})}}window.Telegram||(window.Telegram={}),Object.defineProperty(y,"initData",{get:function(){return W},enumerable:!0}),Object.defineProperty(y,"initDataUnsafe",{get:function(){return Z},enumerable:!0}),Object.defineProperty(y,"version",{get:function(){return q},enumerable:!0}),Object.defineProperty(y,"platform",{get:function(){return se},enumerable:!0}),Object.defineProperty(y,"colorScheme",{get:function(){return Q},enumerable:!0}),Object.defineProperty(y,"themeParams",{get:function(){return O},enumerable:!0}),Object.defineProperty(y,"isExpanded",{get:function(){return Je},enumerable:!0}),Object.defineProperty(y,"viewportHeight",{get:function(){return(Qe===!1?window.innerHeight:Qe)-Ee},enumerable:!0}),Object.defineProperty(y,"viewportStableHeight",{get:function(){return(Le===!1?window.innerHeight:Le)-Ee},enumerable:!0}),Object.defineProperty(y,"isClosingConfirmationEnabled",{set:function(w){Ze(w)},get:function(){return rt},enumerable:!0}),Object.defineProperty(y,"headerColor",{set:function(w){Nt(w)},get:function(){return nt()},enumerable:!0}),Object.defineProperty(y,"backgroundColor",{set:function(w){pt(w)},get:function(){return dt()},enumerable:!0}),Object.defineProperty(y,"BackButton",{value:Pt,enumerable:!0}),Object.defineProperty(y,"MainButton",{value:ft,enumerable:!0}),Object.defineProperty(y,"HapticFeedback",{value:mt,enumerable:!0}),y.setHeaderColor=function(w){y.headerColor=w},y.setBackgroundColor=function(w){y.backgroundColor=w},y.enableClosingConfirmation=function(){y.isClosingConfirmationEnabled=!0},y.disableClosingConfirmation=function(){y.isClosingConfirmationEnabled=!1},y.isVersionAtLeast=function(w){return we(w)},y.onEvent=function(w,m){J(w,m)},y.offEvent=function(w,m){L(w,m)},y.sendData=function(w){if(!w||!w.length)throw console.error("[Telegram.WebApp] Data is required",w),Error("WebAppDataInvalid");if(Mt(w)>4096)throw console.error("[Telegram.WebApp] Data is too long",w),Error("WebAppDataInvalid");n.postEvent("web_app_data_send",!1,{data:w})},y.openLink=function(F,m){var V=document.createElement("A");if(V.href=F,V.protocol!="http:"&&V.protocol!="https:")throw console.error("[Telegram.WebApp] Url protocol is not supported",F),Error("WebAppTgUrlInvalid");var F=V.href;m=m||{},we("6.1")?n.postEvent("web_app_open_link",!1,{url:F,try_instant_view:we("6.4")&&!!m.try_instant_view}):window.open(F,"_blank")},y.openTelegramLink=function(w){var m=document.createElement("A");if(m.href=w,m.protocol!="http:"&&m.protocol!="https:")throw console.error("[Telegram.WebApp] Url protocol is not supported",w),Error("WebAppTgUrlInvalid");if(m.hostname!="t.me")throw console.error("[Telegram.WebApp] Url host is not supported",w),Error("WebAppTgUrlInvalid");var V=m.pathname+m.search;E||we("6.1")?n.postEvent("web_app_open_tg_link",!1,{path_full:V}):location.href="https://t.me"+V},y.openInvoice=function(w,m){var V=document.createElement("A"),F,X;if(V.href=w,V.protocol!="http:"&&V.protocol!="https:"||V.hostname!="t.me"||!(F=V.pathname.match(/^\/(\$|invoice\/)([A-Za-z0-9\-_=]+)$/))||!(X=F[2]))throw console.error("[Telegram.WebApp] Invoice url is invalid",w),Error("WebAppInvoiceUrlInvalid");if(!we("6.1"))throw console.error("[Telegram.WebApp] Method openInvoice is not supported in version "+q),Error("WebAppMethodUnsupported");if(je[X])throw console.error("[Telegram.WebApp] Invoice is already opened"),Error("WebAppInvoiceOpened");je[X]={url:w,callback:m},n.postEvent("web_app_open_invoice",!1,{slug:X})},y.showPopup=function(w,m){if(!we("6.2"))throw console.error("[Telegram.WebApp] Method showPopup is not supported in version "+q),Error("WebAppMethodUnsupported");if(Ge)throw console.error("[Telegram.WebApp] Popup is already opened"),Error("WebAppPopupOpened");var V="",F="",X=[],Ce={},G={};if(typeof w.title<"u"){if(V=k(w.title),V.length>64)throw console.error("[Telegram.WebApp] Popup title is too long",V),Error("WebAppPopupParamInvalid");V.length>0&&(G.title=V)}if(typeof w.message<"u"&&(F=k(w.message)),!F.length)throw console.error("[Telegram.WebApp] Popup message is required",w.message),Error("WebAppPopupParamInvalid");if(F.length>256)throw console.error("[Telegram.WebApp] Popup message is too long",F),Error("WebAppPopupParamInvalid");if(G.message=F,typeof w.buttons<"u"){if(!Array.isArray(w.buttons))throw console.error("[Telegram.WebApp] Popup buttons should be an array",w.buttons),Error("WebAppPopupParamInvalid");for(var De=0;De<w.buttons.length;De++){var h=w.buttons[De],v={},P="";if(typeof h.id<"u"&&(P=h.id.toString(),P.length>64))throw console.error("[Telegram.WebApp] Popup button id is too long",P),Error("WebAppPopupParamInvalid");v.id=P;var H=h.type;if(typeof H>"u"&&(H="default"),v.type=H,!(H=="ok"||H=="close"||H=="cancel"))if(H=="default"||H=="destructive"){var K="";if(typeof h.text<"u"&&(K=k(h.text)),!K.length)throw console.error("[Telegram.WebApp] Popup button text is required for type "+H,h.text),Error("WebAppPopupParamInvalid");if(K.length>64)throw console.error("[Telegram.WebApp] Popup button text is too long",K),Error("WebAppPopupParamInvalid");v.text=K}else throw console.error("[Telegram.WebApp] Popup button type is invalid",H),Error("WebAppPopupParamInvalid");X.push(v)}}else X.push({id:"",type:"close"});if(X.length<1)throw console.error("[Telegram.WebApp] Popup should have at least one button"),Error("WebAppPopupParamInvalid");if(X.length>3)throw console.error("[Telegram.WebApp] Popup should not have more than 3 buttons"),Error("WebAppPopupParamInvalid");G.buttons=X,Ge={callback:m},n.postEvent("web_app_open_popup",!1,G)},y.showAlert=function(w,m){y.showPopup({message:w},m?function(){m()}:null)},y.showConfirm=function(w,m){y.showPopup({message:w,buttons:[{type:"ok",id:"ok"},{type:"cancel"}]},m?function(V){m(V=="ok")}:null)},y.showScanQrPopup=function(w,m){if(!we("6.4"))throw console.error("[Telegram.WebApp] Method showScanQrPopup is not supported in version "+q),Error("WebAppMethodUnsupported");if(Ie)throw console.error("[Telegram.WebApp] Popup is already opened"),Error("WebAppScanQrPopupOpened");var V="",F={};if(typeof w.text<"u"){if(V=k(w.text),V.length>64)throw console.error("[Telegram.WebApp] Scan QR popup text is too long",V),Error("WebAppScanQrPopupParamInvalid");V.length>0&&(F.text=V)}Ie={callback:m},n.postEvent("web_app_open_scan_qr_popup",!1,F)},y.closeScanQrPopup=function(){if(!we("6.4"))throw console.error("[Telegram.WebApp] Method closeScanQrPopup is not supported in version "+q),Error("WebAppMethodUnsupported");Ie=!1,n.postEvent("web_app_close_scan_qr_popup",!1)},y.readTextFromClipboard=function(w){if(!we("6.4"))throw console.error("[Telegram.WebApp] Method readTextFromClipboard is not supported in version "+q),Error("WebAppMethodUnsupported");var m=Ne(16),V={req_id:m};Ke[m]={callback:w},n.postEvent("web_app_read_text_from_clipboard",!1,V)},y.ready=function(){n.postEvent("web_app_ready")},y.expand=function(){n.postEvent("web_app_expand")},y.close=function(){n.postEvent("web_app_close")},window.Telegram.WebApp=y,_e(),tt(),window.addEventListener("resize",le),E&&document.addEventListener("click",C),n.onEvent("theme_changed",He),n.onEvent("viewport_changed",b),n.onEvent("invoice_closed",Tt),n.onEvent("popup_closed",Rt),n.onEvent("qr_text_received",wt),n.onEvent("scan_qr_popup_closed",Ct),n.onEvent("clipboard_text_received",At),n.postEvent("web_app_request_theme"),n.postEvent("web_app_request_viewport")})();var ds=window,vo=ds.Telegram.WebApp;var mn=vo;var p=fo({global:!1,canvas:document.querySelector("#game"),background:[0,0,0]}),Re=p.isTouchscreen(),ps=[p.color(255,1,152),p.color(2,155,222)],Se=p.width(),fe=p.height(),Rr=Se/2,Cr=fe/2;p.loadSprite("game-bg","sprites/m-dew.jpg");p.loadSprite("bean","sprites/bean.png");p.loadSprite("crosshair","sprites/crosshair.png");p.loadSound("gun","sprites/sounds/shot.mp3");p.loadSound("shutgun","sprites/sounds/shutgun.mp3");p.loadSound("bg-music","sprites/sounds/bg-music.mp3");p.loadFont("f1","sprites/fonts/f1.ttf");p.scene("game",()=>{let e=0,n=30,c=Date.now(),E=p.add([p.sprite("game-bg",{width:p.width(),height:p.height()}),p.opacity(.5)]),y=p.add([p.pos(10,10),p.color(2,155,222),p.pos(10,10),p.text(`Score: ${e}`,{font:"f1",size:Math.min(Se,fe)*.05})]),W=p.add([p.opacity(0),p.anchor("center"),p.pos(Rr,Cr),p.color(255,1,152),p.text("Time is up!",{size:Math.min(Se,fe)*.06}),p.area({cursor:"pointer"})]),Z=p.add([p.color(255,1,152),p.pos(p.width()-10,Re?35:20),p.anchor("right"),p.text("00:00",{font:"f1",size:Math.min(Se,fe)*.05})]),O=()=>{let se=Math.floor(Math.random()*(p.width()-100))+100,M=Math.floor(Math.random()*(p.height()-100))+100;if(p.get("btntarget").length<=1){let d=p.add(["btntarget",{btnid:"test",created:new Date},p.pos(se,M),p.area({cursor:"pointer"}),p.circle(fe*.05),p.fadeIn(.5),p.opacity(1),ps[Math.floor(Math.random()*2)]]);p.wait(5,()=>d.destroy())}};O(),p.onClick("btntarget",se=>{c=Date.now();let M=new Date(se.created).getTime(),ae=Date.now(),d=Math.floor((ae-M)/1e3);console.log(`Time elapsed since button creation: ${(0,yo.default)(d)}`),p.play("shutgun",{volume:.5}),se.destroy(),e+=1,y.text=`Score: ${e}`,n>0&&O()});let Q=p.loop(5,()=>{n>0&&O()}),q=p.loop(1,()=>{n>0?(n--,Z.text=Ao(n)):(W.opacity=1,E.opacity=.2,q.cancel(),Q.cancel(),p.wait(1,()=>p.go("game-over",{score:e})))})});p.scene("main",()=>{let e=Math.min(Se,fe)*.05;p.add([p.sprite("game-bg",{width:p.width(),height:p.height()}),p.opacity(.2)]),p.add([p.text("BFS Aim Trainer",{align:"center",font:"f1",size:Math.min(Se,fe)*.05+(Re?10:5)}),p.color(2,155,222),p.pos(Rr,Cr-fe*.08-(Re?10:1)),p.anchor("center")]);let n=p.add([p.rect(p.width()/2,fe*.08-10,{radius:18}),p.anchor("center"),p.pos(Rr,Cr),p.color(255,1,152),p.area({cursor:"pointer"})]);p.add([p.pos(n.pos),p.text("Start",{font:"f1",size:e-(Re?10:5)}),p.color(255,255,255),p.anchor("center")]),n.onClick(()=>{p.play("bg-music",{loop:!0,volume:.5,seek:2}),p.go("game")})});p.scene("game-over",e=>{p.add([p.sprite("game-bg",{width:p.width(),height:p.height()}),p.opacity(.2)]);let n=p.add([p.rect(p.width()*.9,p.height()*.7,{radius:18}),p.pos(Rr,Cr),p.anchor("center"),p.color(28,28,29),p.opacity(1),p.fadeIn(.5)]);p.add([p.text("Score Board",{font:"f1",size:Math.min(Se,fe)*.05}),p.pos(n.pos.x,n.pos.y/3+(Re?50:30)),p.anchor("center"),p.color(2,155,222)]);let c=p.add([p.rect(p.width()/2,fe*.08-(Re?30:10),{radius:18}),p.anchor("center"),p.pos(n.pos.x,n.height+(Re?5:50)),p.color(255,1,152),p.area({cursor:"pointer"})]);c.onClick(()=>p.go("game")),p.add([p.pos(c.pos),p.text("Try Again",{font:"f1",size:Math.min(Se,fe)*(Re?.05:.03)}),p.color(255,255,255),p.anchor("center")]),p.add([p.text("Score",{font:"f1",size:Math.min(Se,fe)*.04}),p.pos(p.width()-p.width()*.9,p.height()-p.height()*.7),p.anchor("left"),p.color(255,1,152),p.area()]),p.add([p.text(`${e?.score??0}`,{font:"f1",size:Math.min(Se,fe)*.04}),p.pos(p.width()*.9-10*2,p.height()-p.height()*.7),p.anchor("right"),p.color(2,155,222),p.area()]),p.add([p.text("MS per target",{font:"f1",size:Math.min(Se,fe)*.04}),p.pos(p.width()-p.width()*.9,p.height()-p.height()*.7+(Re?80:40)),p.anchor("left"),p.color(255,1,152),p.area()]),p.add([p.text("0ms",{font:"f1",size:Math.min(Se,fe)*.04}),p.pos(p.width()*.9-10*2,p.height()-p.height()*.7+(Re?80:40)),p.anchor("right"),p.color(2,155,222),p.area()]),p.add([p.text("Blue",{font:"f1",size:Math.min(Se,fe)*.04}),p.pos(p.width()-p.width()*.9,p.height()-p.height()*.7+40*(Re?4:2)),p.anchor("left"),p.color(255,1,152),p.area()]),p.add([p.text("0",{font:"f1",size:Math.min(Se,fe)*.04}),p.pos(p.width()*.9-10*2,p.height()-p.height()*.7+40*(Re?4:2)),p.anchor("right"),p.color(2,155,222),p.area()]),p.add([p.text("Pink",{font:"f1",size:Math.min(Se,fe)*.04}),p.pos(p.width()-p.width()*.9,p.height()-p.height()*.7+40*(Re?6:3)),p.anchor("left"),p.color(255,1,152),p.area()]),p.add([p.text("0",{font:"f1",size:Math.min(Se,fe)*.04}),p.pos(p.width()*.9-10*2,p.height()-p.height()*.7+40*(Re?6:3)),p.anchor("right"),p.color(2,155,222),p.area()]),p.add([p.text("Bonus",{font:"f1",size:Math.min(Se,fe)*.04}),p.pos(p.width()-p.width()*.9,p.height()-p.height()*.7+40*(Re?8:4)),p.anchor("left"),p.color(255,1,152),p.area()]),p.add([p.text("0",{font:"f1",size:Math.min(Se,fe)*.04}),p.pos(p.width()*.9-10*2,p.height()-p.height()*.7+40*(Re?8:4)),p.anchor("right"),p.color(2,155,222),p.area()])});p.add([]);var fs=()=>{mn.ready(),mn.expand(),p.go("main")};requestAnimationFrame(fs);})();
