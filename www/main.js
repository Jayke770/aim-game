(()=>{var Ts=Object.create;var Si=Object.defineProperty;var Bs=Object.getOwnPropertyDescriptor;var Fs=Object.getOwnPropertyNames;var Ps=Object.getPrototypeOf,Cs=Object.prototype.hasOwnProperty;var Ds=(e,n)=>()=>(n||e((n={exports:{}}).exports,n),n.exports);var Is=(e,n,d,v)=>{if(n&&typeof n=="object"||typeof n=="function")for(let R of Fs(n))!Cs.call(e,R)&&R!==d&&Si(e,R,{get:()=>n[R],enumerable:!(v=Bs(n,R))||v.enumerable});return e};var ks=(e,n,d)=>(d=e!=null?Ts(Ps(e)):{},Is(n||!e||!e.__esModule?Si(d,"default",{value:e,enumerable:!0}):d,e));var ps=Ds((Do,fs)=>{var Rt=1e3,Mt=Rt*60,Tt=Mt*60,it=Tt*24,io=it*7,so=it*365.25;fs.exports=function(e,n){n=n||{};var d=typeof e;if(d==="string"&&e.length>0)return oo(e);if(d==="number"&&isFinite(e))return n.long?ho(e):ao(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))};function oo(e){if(e=String(e),!(e.length>100)){var n=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(n){var d=parseFloat(n[1]),v=(n[2]||"ms").toLowerCase();switch(v){case"years":case"year":case"yrs":case"yr":case"y":return d*so;case"weeks":case"week":case"w":return d*io;case"days":case"day":case"d":return d*it;case"hours":case"hour":case"hrs":case"hr":case"h":return d*Tt;case"minutes":case"minute":case"mins":case"min":case"m":return d*Mt;case"seconds":case"second":case"secs":case"sec":case"s":return d*Rt;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return d;default:return}}}}function ao(e){var n=Math.abs(e);return n>=it?Math.round(e/it)+"d":n>=Tt?Math.round(e/Tt)+"h":n>=Mt?Math.round(e/Mt)+"m":n>=Rt?Math.round(e/Rt)+"s":e+"ms"}function ho(e){var n=Math.abs(e);return n>=it?Rr(e,n,it,"day"):n>=Tt?Rr(e,n,Tt,"hour"):n>=Mt?Rr(e,n,Mt,"minute"):n>=Rt?Rr(e,n,Rt,"second"):e+" ms"}function Rr(e,n,d,v){var R=n>=d*1.5;return Math.round(e/d)+" "+v+(R?"s":"")}});var on=Object.defineProperty,Us=(e,n,d)=>n in e?on(e,n,{enumerable:!0,configurable:!0,writable:!0,value:d}):e[n]=d,o=(e,n)=>on(e,"name",{value:n,configurable:!0}),Ns=(e,n)=>{for(var d in n)on(e,d,{get:n[d],enumerable:!0})},Be=(e,n,d)=>(Us(e,typeof n!="symbol"?n+"":n,d),d),Ls=(()=>{for(var e=new Uint8Array(128),n=0;n<64;n++)e[n<26?n+65:n<52?n+71:n<62?n-4:n*4-205]=n;return d=>{for(var v=d.length,R=new Uint8Array((v-(d[v-1]=="=")-(d[v-2]=="="))*3/4|0),I=0,Q=0;I<v;){var k=e[d.charCodeAt(I++)],Y=e[d.charCodeAt(I++)],j=e[d.charCodeAt(I++)],$=e[d.charCodeAt(I++)];R[Q++]=k<<2|Y>>4,R[Q++]=Y<<4|j>>2,R[Q++]=j<<6|$}return R}})();function De(e){return e*Math.PI/180}o(De,"deg2rad");function St(e){return e*180/Math.PI}o(St,"rad2deg");function Qe(e,n,d){return n>d?Qe(e,d,n):Math.min(Math.max(e,n),d)}o(Qe,"clamp");function Ie(e,n,d){if(typeof e=="number"&&typeof n=="number")return e+(n-e)*d;if(e instanceof y&&n instanceof y||e instanceof O&&n instanceof O)return e.lerp(n,d);throw new Error(`Bad value for lerp(): ${e}, ${n}. Only number, Vec2 and Color is supported.`)}o(Ie,"lerp");function Er(e,n,d,v,R){return v+(e-n)/(d-n)*(R-v)}o(Er,"map");function Hi(e,n,d,v,R){return Qe(Er(e,n,d,v,R),v,R)}o(Hi,"mapc");var xe=class{x=0;y=0;constructor(e=0,n=e){this.x=e,this.y=n}static fromAngle(e){let n=De(e);return new xe(Math.cos(n),Math.sin(n))}clone(){return new xe(this.x,this.y)}add(...e){let n=S(...e);return new xe(this.x+n.x,this.y+n.y)}sub(...e){let n=S(...e);return new xe(this.x-n.x,this.y-n.y)}scale(...e){let n=S(...e);return new xe(this.x*n.x,this.y*n.y)}dist(...e){let n=S(...e);return this.sub(n).len()}sdist(...e){let n=S(...e);return this.sub(n).slen()}len(){return Math.sqrt(this.dot(this))}slen(){return this.dot(this)}unit(){let e=this.len();return e===0?new xe(0):this.scale(1/e)}normal(){return new xe(this.y,-this.x)}reflect(e){return this.sub(e.scale(2*this.dot(e)))}project(e){return e.scale(e.dot(this)/e.len())}reject(e){return this.sub(this.project(e))}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}angle(...e){let n=S(...e);return St(Math.atan2(this.y-n.y,this.x-n.x))}angleBetween(...e){let n=S(...e);return St(Math.atan2(this.cross(n),this.dot(n)))}lerp(e,n){return new xe(Ie(this.x,e.x,n),Ie(this.y,e.y,n))}slerp(e,n){let d=this.dot(e),v=this.cross(e),R=Math.atan2(v,d);return this.scale(Math.sin((1-n)*R)).add(e.scale(Math.sin(n*R))).scale(1/v)}isZero(){return this.x===0&&this.y===0}toFixed(e){return new xe(Number(this.x.toFixed(e)),Number(this.y.toFixed(e)))}transform(e){return e.multVec2(this)}eq(e){return this.x===e.x&&this.y===e.y}bbox(){return new fe(this,0,0)}toString(){return`vec2(${this.x.toFixed(2)}, ${this.y.toFixed(2)})`}},y=xe;o(y,"Vec2"),Be(y,"LEFT",new xe(-1,0)),Be(y,"RIGHT",new xe(1,0)),Be(y,"UP",new xe(0,-1)),Be(y,"DOWN",new xe(0,1));function S(...e){if(e.length===1){if(e[0]instanceof y)return new y(e[0].x,e[0].y);if(Array.isArray(e[0])&&e[0].length===2)return new y(...e[0])}return new y(...e)}o(S,"vec2");var le=class{r=255;g=255;b=255;constructor(e,n,d){this.r=Qe(e,0,255),this.g=Qe(n,0,255),this.b=Qe(d,0,255)}static fromArray(e){return new le(e[0],e[1],e[2])}static fromHex(e){if(typeof e=="number")return new le(e>>16&255,e>>8&255,e>>0&255);if(typeof e=="string"){let n=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return new le(parseInt(n[1],16),parseInt(n[2],16),parseInt(n[3],16))}else throw new Error("Invalid hex color format")}static fromHSL(e,n,d){if(n==0)return new le(255*d,255*d,255*d);let v=o((j,$,x)=>(x<0&&(x+=1),x>1&&(x-=1),x<1/6?j+($-j)*6*x:x<1/2?$:x<2/3?j+($-j)*(2/3-x)*6:j),"hue2rgb"),R=d<.5?d*(1+n):d+n-d*n,I=2*d-R,Q=v(I,R,e+1/3),k=v(I,R,e),Y=v(I,R,e-1/3);return new le(Math.round(Q*255),Math.round(k*255),Math.round(Y*255))}clone(){return new le(this.r,this.g,this.b)}lighten(e){return new le(this.r+e,this.g+e,this.b+e)}darken(e){return this.lighten(-e)}invert(){return new le(255-this.r,255-this.g,255-this.b)}mult(e){return new le(this.r*e.r/255,this.g*e.g/255,this.b*e.b/255)}lerp(e,n){return new le(Ie(this.r,e.r,n),Ie(this.g,e.g,n),Ie(this.b,e.b,n))}eq(e){return this.r===e.r&&this.g===e.g&&this.b===e.b}toString(){return`rgb(${this.r}, ${this.g}, ${this.b})`}toHex(){return"#"+((1<<24)+(this.r<<16)+(this.g<<8)+this.b).toString(16).slice(1)}},O=le;o(O,"Color"),Be(O,"RED",new le(255,0,0)),Be(O,"GREEN",new le(0,255,0)),Be(O,"BLUE",new le(0,0,255)),Be(O,"YELLOW",new le(255,255,0)),Be(O,"MAGENTA",new le(255,0,255)),Be(O,"CYAN",new le(0,255,255)),Be(O,"WHITE",new le(255,255,255)),Be(O,"BLACK",new le(0,0,0));function _(...e){if(e.length===0)return new O(255,255,255);if(e.length===1){if(e[0]instanceof O)return e[0].clone();if(typeof e[0]=="string")return O.fromHex(e[0]);if(Array.isArray(e[0])&&e[0].length===3)return O.fromArray(e[0])}return new O(...e)}o(_,"rgb");var Os=o((e,n,d)=>O.fromHSL(e,n,d),"hsl2rgb"),he=class{x=0;y=0;w=1;h=1;constructor(e,n,d,v){this.x=e,this.y=n,this.w=d,this.h=v}scale(e){return new he(this.x+this.w*e.x,this.y+this.h*e.y,this.w*e.w,this.h*e.h)}pos(){return new y(this.x,this.y)}clone(){return new he(this.x,this.y,this.w,this.h)}eq(e){return this.x===e.x&&this.y===e.y&&this.w===e.w&&this.h===e.h}toString(){return`quad(${this.x}, ${this.y}, ${this.w}, ${this.h})`}};o(he,"Quad");function se(e,n,d,v){return new he(e,n,d,v)}o(se,"quad");var ue=class{m=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];constructor(e){e&&(this.m=e)}static translate(e){return new ue([1,0,0,0,0,1,0,0,0,0,1,0,e.x,e.y,0,1])}static scale(e){return new ue([e.x,0,0,0,0,e.y,0,0,0,0,1,0,0,0,0,1])}static rotateX(e){e=De(-e);let n=Math.cos(e),d=Math.sin(e);return new ue([1,0,0,0,0,n,-d,0,0,d,n,0,0,0,0,1])}static rotateY(e){e=De(-e);let n=Math.cos(e),d=Math.sin(e);return new ue([n,0,d,0,0,1,0,0,-d,0,n,0,0,0,0,1])}static rotateZ(e){e=De(-e);let n=Math.cos(e),d=Math.sin(e);return new ue([n,-d,0,0,d,n,0,0,0,0,1,0,0,0,0,1])}translate(e){return this.m[12]+=this.m[0]*e.x+this.m[4]*e.y,this.m[13]+=this.m[1]*e.x+this.m[5]*e.y,this.m[14]+=this.m[2]*e.x+this.m[6]*e.y,this.m[15]+=this.m[3]*e.x+this.m[7]*e.y,this}scale(e){return this.m[0]*=e.x,this.m[4]*=e.y,this.m[1]*=e.x,this.m[5]*=e.y,this.m[2]*=e.x,this.m[6]*=e.y,this.m[3]*=e.x,this.m[7]*=e.y,this}rotate(e){e=De(-e);let n=Math.cos(e),d=Math.sin(e),v=this.m[0],R=this.m[1],I=this.m[4],Q=this.m[5];return this.m[0]=v*n+R*d,this.m[1]=-v*d+R*n,this.m[4]=I*n+Q*d,this.m[5]=-I*d+Q*n,this}mult(e){let n=[];for(let d=0;d<4;d++)for(let v=0;v<4;v++)n[d*4+v]=this.m[0*4+v]*e.m[d*4+0]+this.m[1*4+v]*e.m[d*4+1]+this.m[2*4+v]*e.m[d*4+2]+this.m[3*4+v]*e.m[d*4+3];return new ue(n)}multVec2(e){return new y(e.x*this.m[0]+e.y*this.m[4]+this.m[12],e.x*this.m[1]+e.y*this.m[5]+this.m[13])}getTranslation(){return new y(this.m[12],this.m[13])}getScale(){if(this.m[0]!=0||this.m[1]!=0){let e=this.m[0]*this.m[5]-this.m[1]*this.m[4],n=Math.sqrt(this.m[0]*this.m[0]+this.m[1]*this.m[1]);return new y(n,e/n)}else if(this.m[4]!=0||this.m[5]!=0){let e=this.m[0]*this.m[5]-this.m[1]*this.m[4],n=Math.sqrt(this.m[4]*this.m[4]+this.m[5]*this.m[5]);return new y(e/n,n)}else return new y(0,0)}getRotation(){if(this.m[0]!=0||this.m[1]!=0){let e=Math.sqrt(this.m[0]*this.m[0]+this.m[1]*this.m[1]);return St(this.m[1]>0?Math.acos(this.m[0]/e):-Math.acos(this.m[0]/e))}else if(this.m[4]!=0||this.m[5]!=0){let e=Math.sqrt(this.m[4]*this.m[4]+this.m[5]*this.m[5]);return St(Math.PI/2-(this.m[5]>0?Math.acos(-this.m[4]/e):-Math.acos(this.m[4]/e)))}else return 0}getSkew(){if(this.m[0]!=0||this.m[1]!=0){let e=Math.sqrt(this.m[0]*this.m[0]+this.m[1]*this.m[1]);return new y(Math.atan(this.m[0]*this.m[4]+this.m[1]*this.m[5])/(e*e),0)}else if(this.m[4]!=0||this.m[5]!=0){let e=Math.sqrt(this.m[4]*this.m[4]+this.m[5]*this.m[5]);return new y(0,Math.atan(this.m[0]*this.m[4]+this.m[1]*this.m[5])/(e*e))}else return new y(0,0)}invert(){let e=[],n=this.m[10]*this.m[15]-this.m[14]*this.m[11],d=this.m[9]*this.m[15]-this.m[13]*this.m[11],v=this.m[9]*this.m[14]-this.m[13]*this.m[10],R=this.m[8]*this.m[15]-this.m[12]*this.m[11],I=this.m[8]*this.m[14]-this.m[12]*this.m[10],Q=this.m[8]*this.m[13]-this.m[12]*this.m[9],k=this.m[6]*this.m[15]-this.m[14]*this.m[7],Y=this.m[5]*this.m[15]-this.m[13]*this.m[7],j=this.m[5]*this.m[14]-this.m[13]*this.m[6],$=this.m[4]*this.m[15]-this.m[12]*this.m[7],x=this.m[4]*this.m[14]-this.m[12]*this.m[6],me=this.m[5]*this.m[15]-this.m[13]*this.m[7],u=this.m[4]*this.m[13]-this.m[12]*this.m[5],X=this.m[6]*this.m[11]-this.m[10]*this.m[7],Ge=this.m[5]*this.m[11]-this.m[9]*this.m[7],Pe=this.m[5]*this.m[10]-this.m[9]*this.m[6],w=this.m[4]*this.m[11]-this.m[8]*this.m[7],ne=this.m[4]*this.m[10]-this.m[8]*this.m[6],we=this.m[4]*this.m[9]-this.m[8]*this.m[5];e[0]=this.m[5]*n-this.m[6]*d+this.m[7]*v,e[4]=-(this.m[4]*n-this.m[6]*R+this.m[7]*I),e[8]=this.m[4]*d-this.m[5]*R+this.m[7]*Q,e[12]=-(this.m[4]*v-this.m[5]*I+this.m[6]*Q),e[1]=-(this.m[1]*n-this.m[2]*d+this.m[3]*v),e[5]=this.m[0]*n-this.m[2]*R+this.m[3]*I,e[9]=-(this.m[0]*d-this.m[1]*R+this.m[3]*Q),e[13]=this.m[0]*v-this.m[1]*I+this.m[2]*Q,e[2]=this.m[1]*k-this.m[2]*Y+this.m[3]*j,e[6]=-(this.m[0]*k-this.m[2]*$+this.m[3]*x),e[10]=this.m[0]*me-this.m[1]*$+this.m[3]*u,e[14]=-(this.m[0]*j-this.m[1]*x+this.m[2]*u),e[3]=-(this.m[1]*X-this.m[2]*Ge+this.m[3]*Pe),e[7]=this.m[0]*X-this.m[2]*w+this.m[3]*ne,e[11]=-(this.m[0]*Ge-this.m[1]*w+this.m[3]*we),e[15]=this.m[0]*Pe-this.m[1]*ne+this.m[2]*we;let oe=this.m[0]*e[0]+this.m[1]*e[4]+this.m[2]*e[8]+this.m[3]*e[12];for(let ee=0;ee<4;ee++)for(let Ee=0;Ee<4;Ee++)e[ee*4+Ee]*=1/oe;return new ue(e)}clone(){return new ue([...this.m])}toString(){return this.m.toString()}};o(ue,"Mat4");function rn(e,n,d,v=Math.sin){return e+(v(d)+1)/2*(n-e)}o(rn,"wave");var Gs=1103515245,qs=12345,Ri=2147483648,an=class{seed;constructor(e){this.seed=e}gen(){return this.seed=(Gs*this.seed+qs)%Ri,this.seed/Ri}genNumber(e,n){return e+this.gen()*(n-e)}genVec2(e,n){return new y(this.genNumber(e.x,n.x),this.genNumber(e.y,n.y))}genColor(e,n){return new O(this.genNumber(e.r,n.r),this.genNumber(e.g,n.g),this.genNumber(e.b,n.b))}genAny(...e){if(e.length===0)return this.gen();if(e.length===1){if(typeof e[0]=="number")return this.genNumber(0,e[0]);if(e[0]instanceof y)return this.genVec2(S(0,0),e[0]);if(e[0]instanceof O)return this.genColor(_(0,0,0),e[0])}else if(e.length===2){if(typeof e[0]=="number"&&typeof e[1]=="number")return this.genNumber(e[0],e[1]);if(e[0]instanceof y&&e[1]instanceof y)return this.genVec2(e[0],e[1]);if(e[0]instanceof O&&e[1]instanceof O)return this.genColor(e[0],e[1])}}};o(an,"RNG");var nn=new an(Date.now());function ji(e){return e!=null&&(nn.seed=e),nn.seed}o(ji,"randSeed");function rr(...e){return nn.genAny(...e)}o(rr,"rand");function hn(...e){return Math.floor(rr(...e))}o(hn,"randi");function zi(e){return rr()<=e}o(zi,"chance");function Qi(e){return e[hn(e.length)]}o(Qi,"choose");function Ji(e,n){return e.pos.x+e.width>n.pos.x&&e.pos.x<n.pos.x+n.width&&e.pos.y+e.height>n.pos.y&&e.pos.y<n.pos.y+n.height}o(Ji,"testRectRect");function Xi(e,n){if(e.p1.x===e.p2.x&&e.p1.y===e.p2.y||n.p1.x===n.p2.x&&n.p1.y===n.p2.y)return null;let d=(n.p2.y-n.p1.y)*(e.p2.x-e.p1.x)-(n.p2.x-n.p1.x)*(e.p2.y-e.p1.y);if(d===0)return null;let v=((n.p2.x-n.p1.x)*(e.p1.y-n.p1.y)-(n.p2.y-n.p1.y)*(e.p1.x-n.p1.x))/d,R=((e.p2.x-e.p1.x)*(e.p1.y-n.p1.y)-(e.p2.y-e.p1.y)*(e.p1.x-n.p1.x))/d;return v<0||v>1||R<0||R>1?null:v}o(Xi,"testLineLineT");function xt(e,n){let d=Xi(e,n);return d?S(e.p1.x+d*(e.p2.x-e.p1.x),e.p1.y+d*(e.p2.y-e.p1.y)):null}o(xt,"testLineLine");function Zi(e,n){if(nr(e,n.p1)||nr(e,n.p2))return!0;let d=e.points();return!!xt(n,new Oe(d[0],d[1]))||!!xt(n,new Oe(d[1],d[2]))||!!xt(n,new Oe(d[2],d[3]))||!!xt(n,new Oe(d[3],d[0]))}o(Zi,"testRectLine");function nr(e,n){return n.x>e.pos.x&&n.x<e.pos.x+e.width&&n.y>e.pos.y&&n.y<e.pos.y+e.height}o(nr,"testRectPoint");function Wi(e,n){let d=n.sub(e.p1),v=e.p2.sub(e.p1);if(Math.abs(d.cross(v))>Number.EPSILON)return!1;let R=d.dot(v)/v.dot(v);return R>=0&&R<=1}o(Wi,"testLinePoint");function ln(e,n){let d=e.p2.sub(e.p1),v=d.dot(d),R=e.p1.sub(n.center),I=2*d.dot(R),Q=R.dot(R)-n.radius*n.radius,k=I*I-4*v*Q;if(v<=Number.EPSILON||k<0)return!1;if(k==0){let Y=-I/(2*v);if(Y>=0&&Y<=1)return!0}else{let Y=(-I+Math.sqrt(k))/(2*v),j=(-I-Math.sqrt(k))/(2*v);if(Y>=0&&Y<=1||j>=0&&j<=1)return!0}return un(n,e.p1)}o(ln,"testLineCircle");function un(e,n){return e.center.sdist(n)<e.radius*e.radius}o(un,"testCirclePoint");function _i(e,n){let d=n.pts[n.pts.length-1];for(let v of n.pts){if(ln(new Oe(d,v),e))return!0;d=v}return un(e,n.pts[0])?!0:dn(n,e.center)}o(_i,"testCirclePolygon");function dn(e,n){let d=!1,v=e.pts;for(let R=0,I=v.length-1;R<v.length;I=R++)v[R].y>n.y!=v[I].y>n.y&&n.x<(v[I].x-v[R].x)*(n.y-v[R].y)/(v[I].y-v[R].y)+v[R].x&&(d=!d);return d}o(dn,"testPolygonPoint");var Oe=class{p1;p2;constructor(e,n){this.p1=e.clone(),this.p2=n.clone()}transform(e){return new Oe(e.multVec2(this.p1),e.multVec2(this.p2))}bbox(){return fe.fromPoints(this.p1,this.p2)}area(){return this.p1.dist(this.p2)}clone(){return new Oe(this.p1,this.p2)}};o(Oe,"Line");var fe=class{pos;width;height;constructor(e,n,d){this.pos=e.clone(),this.width=n,this.height=d}static fromPoints(e,n){return new fe(e.clone(),n.x-e.x,n.y-e.y)}center(){return new y(this.pos.x+this.width/2,this.pos.y+this.height/2)}points(){return[this.pos,this.pos.add(this.width,0),this.pos.add(this.width,this.height),this.pos.add(0,this.height)]}transform(e){return new nt(this.points().map(n=>e.multVec2(n)))}bbox(){return this.clone()}area(){return this.width*this.height}clone(){return new fe(this.pos.clone(),this.width,this.height)}distToPoint(e){return Math.sqrt(this.sdistToPoint(e))}sdistToPoint(e){let n=this.pos,d=this.pos.add(this.width,this.height),v=Math.max(n.x-e.x,0,e.x-d.x),R=Math.max(n.y-e.y,0,e.y-d.y);return v*v+R*R}};o(fe,"Rect");var xr=class{center;radius;constructor(e,n){this.center=e.clone(),this.radius=n}transform(e){return new br(this.center,this.radius,this.radius).transform(e)}bbox(){return fe.fromPoints(this.center.sub(S(this.radius)),this.center.add(S(this.radius)))}area(){return this.radius*this.radius*Math.PI}clone(){return new xr(this.center,this.radius)}};o(xr,"Circle");var br=class{center;radiusX;radiusY;constructor(e,n,d){this.center=e.clone(),this.radiusX=n,this.radiusY=d}transform(e){return new br(e.multVec2(this.center),e.m[0]*this.radiusX,e.m[5]*this.radiusY)}bbox(){return fe.fromPoints(this.center.sub(S(this.radiusX,this.radiusY)),this.center.add(S(this.radiusX,this.radiusY)))}area(){return this.radiusX*this.radiusY*Math.PI}clone(){return new br(this.center,this.radiusX,this.radiusY)}};o(br,"Ellipse");var nt=class{pts;constructor(e){if(e.length<3)throw new Error("Polygons should have at least 3 vertices");this.pts=e}transform(e){return new nt(this.pts.map(n=>e.multVec2(n)))}bbox(){let e=S(Number.MAX_VALUE),n=S(-Number.MAX_VALUE);for(let d of this.pts)e.x=Math.min(e.x,d.x),n.x=Math.max(n.x,d.x),e.y=Math.min(e.y,d.y),n.y=Math.max(n.y,d.y);return fe.fromPoints(e,n)}area(){let e=0,n=this.pts.length;for(let d=0;d<n;d++){let v=this.pts[d],R=this.pts[(d+1)%n];e+=v.x*R.y*.5,e-=R.x*v.y*.5}return Math.abs(e)}clone(){return new nt(this.pts.map(e=>e.clone()))}};o(nt,"Polygon");function $i(e,n){let d=Number.MAX_VALUE,v=S(0);for(let R of[e,n])for(let I=0;I<R.pts.length;I++){let Q=R.pts[I],k=R.pts[(I+1)%R.pts.length].sub(Q).normal().unit(),Y=Number.MAX_VALUE,j=-Number.MAX_VALUE;for(let u=0;u<e.pts.length;u++){let X=e.pts[u].dot(k);Y=Math.min(Y,X),j=Math.max(j,X)}let $=Number.MAX_VALUE,x=-Number.MAX_VALUE;for(let u=0;u<n.pts.length;u++){let X=n.pts[u].dot(k);$=Math.min($,X),x=Math.max(x,X)}let me=Math.min(j,x)-Math.max(Y,$);if(me<0)return null;if(me<Math.abs(d)){let u=x-Y,X=$-j;d=Math.abs(u)<Math.abs(X)?u:X,v=k.scale(d)}}return v}o($i,"sat");var cn=class extends Map{lastID;constructor(...e){super(...e),this.lastID=0}push(e){let n=this.lastID;return this.set(n,e),this.lastID++,n}pushd(e){let n=this.push(e);return()=>this.delete(n)}};o(cn,"IDList");var ze=class{paused=!1;cancel;constructor(e){this.cancel=e}static join(e){let n=new ze(()=>e.forEach(d=>d.cancel()));return Object.defineProperty(n,"paused",{get:()=>e[0].paused,set:d=>e.forEach(v=>v.paused=d)}),n.paused=!1,n}};o(ze,"EventController");var Te=class{handlers=new cn;add(e){let n=this.handlers.pushd((...v)=>{d.paused||e(...v)}),d=new ze(n);return d}addOnce(e){let n=this.add((...d)=>{n.cancel(),e(...d)});return n}next(){return new Promise(e=>this.addOnce(e))}trigger(...e){this.handlers.forEach(n=>n(...e))}numListeners(){return this.handlers.size}};o(Te,"Event");var bt=class{handlers={};on(e,n){return this.handlers[e]||(this.handlers[e]=new Te),this.handlers[e].add(n)}onOnce(e,n){let d=this.on(e,(...v)=>{d.cancel(),n(...v)});return d}next(e){return new Promise(n=>{this.onOnce(e,(...d)=>n(d[0]))})}trigger(e,...n){this.handlers[e]&&this.handlers[e].trigger(...n)}remove(e){delete this.handlers[e]}clear(){this.handlers={}}numListeners(e){return this.handlers[e]?.numListeners()??0}};o(bt,"EventHandler");function fn(e,n){let d=typeof e,v=typeof n;if(d!==v)return!1;if(d==="object"&&v==="object"&&e!==null&&n!==null){let R=Object.keys(e),I=Object.keys(n);if(R.length!==I.length)return!1;for(let Q of R){let k=e[Q],Y=n[Q];if(!(typeof k=="function"&&typeof Y=="function")&&!fn(k,Y))return!1}return!0}return e===n}o(fn,"deepEq");function es(e){let n=window.atob(e),d=n.length,v=new Uint8Array(d);for(let R=0;R<d;R++)v[R]=n.charCodeAt(R);return v.buffer}o(es,"base64ToArrayBuffer");function ts(e){return es(e.split(",")[1])}o(ts,"dataURLToArrayBuffer");function Sr(e,n){let d=document.createElement("a");d.href=n,d.download=e,d.click()}o(Sr,"download");function pn(e,n){Sr(e,"data:text/plain;charset=utf-8,"+n)}o(pn,"downloadText");function rs(e,n){pn(e,JSON.stringify(n))}o(rs,"downloadJSON");function sn(e,n){let d=URL.createObjectURL(n);Sr(e,d),URL.revokeObjectURL(d)}o(sn,"downloadBlob");var Mi=o(e=>e.match(/^data:\w+\/\w+;base64,.+/),"isDataURL"),Ys=o(e=>e.split(".").pop(),"getExt"),Ks=(()=>{let e=0;return()=>e++})(),ns=class{_items;_compareFn;constructor(e=(n,d)=>n<d){this._compareFn=e,this._items=[]}insert(e){this._items.push(e),this.moveUp(this._items.length-1)}remove(){if(this._items.length===0)return null;let e=this._items[0],n=this._items.pop();return this._items.length!==0&&(this._items[0]=n,this.moveDown(0)),e}clear(){this._items.splice(0,this._items.length)}moveUp(e){for(;e>0;){let n=Math.floor((e-1)/2);if(!this._compareFn(this._items[e],this._items[n])&&this._items[e]>=this._items[n])break;this.swap(e,n),e=n}}moveDown(e){for(;e<Math.floor(this._items.length/2);){let n=2*e+1;if(n<this._items.length-1&&!this._compareFn(this._items[n],this._items[n+1])&&++n,this._compareFn(this._items[e],this._items[n]))break;this.swap(e,n),e=n}}swap(e,n){[this._items[e],this._items[n]]=[this._items[n],this._items[e]]}get length(){return this._items.length}};o(ns,"BinaryHeap");var Ti={"Joy-Con L+R (STANDARD GAMEPAD Vendor: 057e Product: 200e)":{buttons:{0:"south",1:"east",2:"west",3:"north",4:"lshoulder",5:"rshoulder",6:"ltrigger",7:"rtrigger",8:"select",9:"start",10:"lstick",11:"rstick",12:"dpad-up",13:"dpad-down",14:"dpad-left",15:"dpad-right",16:"home",17:"capture"},sticks:{left:{x:0,y:1},right:{x:2,y:3}}},"Joy-Con (L) (STANDARD GAMEPAD Vendor: 057e Product: 2006)":{buttons:{0:"south",1:"east",2:"west",3:"north",4:"lshoulder",5:"rshoulder",9:"select",10:"lstick",16:"start"},sticks:{left:{x:0,y:1}}},"Joy-Con (R) (STANDARD GAMEPAD Vendor: 057e Product: 2007)":{buttons:{0:"south",1:"east",2:"west",3:"north",4:"lshoulder",5:"rshoulder",9:"start",10:"lstick",16:"select"},sticks:{left:{x:0,y:1}}},"Pro Controller (STANDARD GAMEPAD Vendor: 057e Product: 2009)":{buttons:{0:"south",1:"east",2:"west",3:"north",4:"lshoulder",5:"rshoulder",6:"ltrigger",7:"rtrigger",8:"select",9:"start",10:"lstick",11:"rstick",12:"dpad-up",13:"dpad-down",14:"dpad-left",15:"dpad-right",16:"home",17:"capture"},sticks:{left:{x:0,y:1},right:{x:2,y:3}}},default:{buttons:{0:"south",1:"east",2:"west",3:"north",4:"lshoulder",5:"rshoulder",6:"ltrigger",7:"rtrigger",8:"select",9:"start",10:"lstick",11:"rstick",12:"dpad-up",13:"dpad-down",14:"dpad-left",15:"dpad-right",16:"home"},sticks:{left:{x:0,y:1},right:{x:2,y:3}}}},tr=class{pressed=new Set([]);pressedRepeat=new Set([]);released=new Set([]);down=new Set([]);update(){this.pressed.clear(),this.released.clear(),this.pressedRepeat.clear()}press(e){this.pressed.add(e),this.pressedRepeat.add(e),this.down.add(e)}pressRepeat(e){this.pressedRepeat.add(e)}release(e){this.down.delete(e),this.pressed.delete(e),this.released.add(e)}};o(tr,"ButtonState");var is=class{buttonState=new tr;stickState=new Map};o(is,"GamepadState");var ss=class{dts=[];timer=0;fps=0;tick(e){this.dts.push(e),this.timer+=e,this.timer>=1&&(this.timer=0,this.fps=Math.round(1/(this.dts.reduce((n,d)=>n+d)/this.dts.length)),this.dts=[])}};o(ss,"FPSCounter");var Hs=o(e=>{if(!e.canvas)throw new Error("Please provide a canvas");let n={canvas:e.canvas,loopID:null,stopped:!1,dt:0,time:0,realTime:0,fpsCounter:new ss,timeScale:1,skipTime:!1,numFrames:0,paused:!1,mousePos:new y(0),mouseDeltaPos:new y(0),keyState:new tr,mouseState:new tr,mergedGamepadState:new is,gamepadStates:new Map,gamepads:[],charInputted:[],isMouseMoved:!1,lastWidth:e.canvas.offsetWidth,lastHeight:e.canvas.offsetHeight,events:new bt};function d(){return n.canvas}o(d,"canvas");function v(){return n.dt*n.timeScale}o(v,"dt");function R(){return n.time}o(R,"time");function I(){return n.fpsCounter.fps}o(I,"fps");function Q(){return n.numFrames}o(Q,"numFrames");function k(){return n.canvas.toDataURL()}o(k,"screenshot");function Y(f){n.canvas.style.cursor=f}o(Y,"setCursor");function j(){return n.canvas.style.cursor}o(j,"getCursor");function $(f){if(f)try{let A=n.canvas.requestPointerLock();A.catch&&A.catch(b=>console.error(b))}catch(A){console.error(A)}else document.exitPointerLock()}o($,"setCursorLocked");function x(){return!!document.pointerLockElement}o(x,"isCursorLocked");function me(f){f.requestFullscreen?f.requestFullscreen():f.webkitRequestFullscreen&&f.webkitRequestFullscreen()}o(me,"enterFullscreen");function u(){document.exitFullscreen?document.exitFullscreen():document.webkitExitFullScreen&&document.webkitExitFullScreen()}o(u,"exitFullscreen");function X(){return document.fullscreenElement||document.webkitFullscreenElement}o(X,"getFullscreenElement");function Ge(f=!0){f?me(n.canvas):u()}o(Ge,"setFullscreen");function Pe(){return!!X()}o(Pe,"isFullscreen");function w(){n.stopped=!0;for(let f in de)n.canvas.removeEventListener(f,de[f]);for(let f in Ce)document.removeEventListener(f,Ce[f]);for(let f in ce)window.removeEventListener(f,ce[f]);Kt.disconnect()}o(w,"quit");function ne(f){n.loopID!==null&&cancelAnimationFrame(n.loopID);let A=0,b=o(K=>{if(n.stopped)return;if(n.paused||document.visibilityState!=="visible"){n.loopID=requestAnimationFrame(b);return}let G=K/1e3,ae=G-n.realTime,be=e.maxFPS?1/e.maxFPS:0;n.realTime=G,A+=ae,A>be&&(n.skipTime||(n.dt=A,n.time+=v(),n.fpsCounter.tick(n.dt)),A=0,n.skipTime=!1,n.numFrames++,pt(),f(),Yt()),n.loopID=requestAnimationFrame(b)},"frame");b(0)}o(ne,"run");function we(){return"ontouchstart"in window||navigator.maxTouchPoints>0}o(we,"isTouchscreen");function oe(){return n.mousePos.clone()}o(oe,"mousePos");function ee(){return n.mouseDeltaPos.clone()}o(ee,"mouseDeltaPos");function Ee(f="left"){return n.mouseState.pressed.has(f)}o(Ee,"isMousePressed");function U(f="left"){return n.mouseState.down.has(f)}o(U,"isMouseDown");function M(f="left"){return n.mouseState.released.has(f)}o(M,"isMouseReleased");function st(){return n.isMouseMoved}o(st,"isMouseMoved");function Fe(f){return f===void 0?n.keyState.pressed.size>0:n.keyState.pressed.has(f)}o(Fe,"isKeyPressed");function Bt(f){return f===void 0?n.keyState.pressedRepeat.size>0:n.keyState.pressedRepeat.has(f)}o(Bt,"isKeyPressedRepeat");function Je(f){return f===void 0?n.keyState.down.size>0:n.keyState.down.has(f)}o(Je,"isKeyDown");function qe(f){return f===void 0?n.keyState.released.size>0:n.keyState.released.has(f)}o(qe,"isKeyReleased");function Ft(f){return f===void 0?n.mergedGamepadState.buttonState.pressed.size>0:n.mergedGamepadState.buttonState.pressed.has(f)}o(Ft,"isGamepadButtonPressed");function Pt(f){return f===void 0?n.mergedGamepadState.buttonState.down.size>0:n.mergedGamepadState.buttonState.down.has(f)}o(Pt,"isGamepadButtonDown");function Ye(f){return f===void 0?n.mergedGamepadState.buttonState.released.size>0:n.mergedGamepadState.buttonState.released.has(f)}o(Ye,"isGamepadButtonReleased");function Ct(f){return n.events.on("resize",f)}o(Ct,"onResize");let Xe=o((f,A)=>{if(typeof f=="function")return n.events.on("keyDown",f);if(typeof f=="string"&&typeof A=="function")return n.events.on("keyDown",b=>b===f&&A(f))},"onKeyDown"),ir=o((f,A)=>{if(typeof f=="function")return n.events.on("keyPress",f);if(typeof f=="string"&&typeof A=="function")return n.events.on("keyPress",b=>b===f&&A(f))},"onKeyPress"),sr=o((f,A)=>{if(typeof f=="function")return n.events.on("keyPressRepeat",f);if(typeof f=="string"&&typeof A=="function")return n.events.on("keyPressRepeat",b=>b===f&&A(f))},"onKeyPressRepeat"),Dt=o((f,A)=>{if(typeof f=="function")return n.events.on("keyRelease",f);if(typeof f=="string"&&typeof A=="function")return n.events.on("keyRelease",b=>b===f&&A(f))},"onKeyRelease");function ot(f,A){return typeof f=="function"?n.events.on("mouseDown",b=>f(b)):n.events.on("mouseDown",b=>b===f&&A(b))}o(ot,"onMouseDown");function at(f,A){return typeof f=="function"?n.events.on("mousePress",b=>f(b)):n.events.on("mousePress",b=>b===f&&A(b))}o(at,"onMousePress");function ke(f,A){return typeof f=="function"?n.events.on("mouseRelease",b=>f(b)):n.events.on("mouseRelease",b=>b===f&&A(b))}o(ke,"onMouseRelease");function It(f){return n.events.on("mouseMove",()=>f(oe(),ee()))}o(It,"onMouseMove");function kt(f){return n.events.on("charInput",f)}o(kt,"onCharInput");function Ut(f){return n.events.on("touchStart",f)}o(Ut,"onTouchStart");function Nt(f){return n.events.on("touchMove",f)}o(Nt,"onTouchMove");function Lt(f){return n.events.on("touchEnd",f)}o(Lt,"onTouchEnd");function Ot(f){return n.events.on("scroll",f)}o(Ot,"onScroll");function ht(f,A){if(typeof f=="function")return n.events.on("gamepadButtonDown",f);if(typeof f=="string"&&typeof A=="function")return n.events.on("gamepadButtonDown",b=>b===f&&A(f))}o(ht,"onGamepadButtonDown");function lt(f,A){if(typeof f=="function")return n.events.on("gamepadButtonPress",f);if(typeof f=="string"&&typeof A=="function")return n.events.on("gamepadButtonPress",b=>b===f&&A(f))}o(lt,"onGamepadButtonPress");function ut(f,A){if(typeof f=="function")return n.events.on("gamepadButtonRelease",f);if(typeof f=="string"&&typeof A=="function")return n.events.on("gamepadButtonRelease",b=>b===f&&A(f))}o(ut,"onGamepadButtonRelease");function dt(f,A){return n.events.on("gamepadStick",(b,K)=>b===f&&A(K))}o(dt,"onGamepadStick");function ct(f){n.events.on("gamepadConnect",f)}o(ct,"onGamepadConnect");function Gt(f){n.events.on("gamepadDisconnect",f)}o(Gt,"onGamepadDisconnect");function Ze(f){return n.mergedGamepadState.stickState.get(f)||new y(0)}o(Ze,"getGamepadStick");function qt(){return[...n.charInputted]}o(qt,"charInputted");function ft(){return[...n.gamepads]}o(ft,"getGamepads");function pt(){n.events.trigger("input"),n.keyState.down.forEach(f=>n.events.trigger("keyDown",f)),n.mouseState.down.forEach(f=>n.events.trigger("mouseDown",f)),_e()}o(pt,"processInput");function Yt(){n.keyState.update(),n.mouseState.update(),n.mergedGamepadState.buttonState.update(),n.mergedGamepadState.stickState.forEach((f,A)=>{n.mergedGamepadState.stickState.set(A,new y(0))}),n.charInputted=[],n.isMouseMoved=!1,n.gamepadStates.forEach(f=>{f.buttonState.update(),f.stickState.forEach((A,b)=>{f.stickState.set(b,new y(0))})})}o(Yt,"resetInput");function We(f){let A={index:f.index,isPressed:b=>n.gamepadStates.get(f.index).buttonState.pressed.has(b),isDown:b=>n.gamepadStates.get(f.index).buttonState.down.has(b),isReleased:b=>n.gamepadStates.get(f.index).buttonState.released.has(b),getStick:b=>n.gamepadStates.get(f.index).stickState.get(b)};return n.gamepads.push(A),n.gamepadStates.set(f.index,{buttonState:new tr,stickState:new Map([["left",new y(0)],["right",new y(0)]])}),A}o(We,"registerGamepad");function gt(f){n.gamepads=n.gamepads.filter(A=>A.index!==f.index),n.gamepadStates.delete(f.index)}o(gt,"removeGamepad");function _e(){for(let f of navigator.getGamepads())f&&!n.gamepadStates.has(f.index)&&We(f);for(let f of n.gamepads){let A=navigator.getGamepads()[f.index],b=(e.gamepads??{})[A.id]??Ti[A.id]??Ti.default,K=n.gamepadStates.get(f.index);for(let G=0;G<A.buttons.length;G++)A.buttons[G].pressed?(K.buttonState.down.has(b.buttons[G])||(n.mergedGamepadState.buttonState.press(b.buttons[G]),K.buttonState.press(b.buttons[G]),n.events.trigger("gamepadButtonPress",b.buttons[G])),n.events.trigger("gamepadButtonDown",b.buttons[G])):K.buttonState.down.has(b.buttons[G])&&(n.mergedGamepadState.buttonState.release(b.buttons[G]),K.buttonState.release(b.buttons[G]),n.events.trigger("gamepadButtonRelease",b.buttons[G]));for(let G in b.sticks){let ae=b.sticks[G],be=new y(A.axes[ae.x],A.axes[ae.y]);K.stickState.set(G,be),n.mergedGamepadState.stickState.set(G,be),n.events.trigger("gamepadStick",G,be)}}}o(_e,"processGamepad");let de={},Ce={},ce={};de.mousemove=f=>{let A=new y(f.offsetX,f.offsetY),b=new y(f.movementX,f.movementY);n.events.onOnce("input",()=>{n.isMouseMoved=!0,n.mousePos=A,n.mouseDeltaPos=b,n.events.trigger("mouseMove")})};let mt=["left","middle","right","back","forward"];de.mousedown=f=>{n.events.onOnce("input",()=>{let A=mt[f.button];A&&(n.mouseState.press(A),n.events.trigger("mousePress",A))})},de.mouseup=f=>{n.events.onOnce("input",()=>{let A=mt[f.button];A&&(n.mouseState.release(A),n.events.trigger("mouseRelease",A))})};let or=new Set([" ","ArrowLeft","ArrowRight","ArrowUp","ArrowDown","Tab"]),wt={ArrowLeft:"left",ArrowRight:"right",ArrowUp:"up",ArrowDown:"down"," ":"space"};de.keydown=f=>{or.has(f.key)&&f.preventDefault(),n.events.onOnce("input",()=>{let A=wt[f.key]||f.key.toLowerCase();A.length===1?(n.events.trigger("charInput",A),n.charInputted.push(A)):A==="space"&&(n.events.trigger("charInput"," "),n.charInputted.push(" ")),f.repeat?(n.keyState.pressRepeat(A),n.events.trigger("keyPressRepeat",A)):(n.keyState.press(A),n.events.trigger("keyPressRepeat",A),n.events.trigger("keyPress",A))})},de.keyup=f=>{n.events.onOnce("input",()=>{let A=wt[f.key]||f.key.toLowerCase();n.keyState.release(A),n.events.trigger("keyRelease",A)})},de.touchstart=f=>{f.preventDefault(),n.events.onOnce("input",()=>{let A=[...f.changedTouches],b=n.canvas.getBoundingClientRect();e.touchToMouse!==!1&&(n.mousePos=new y(A[0].clientX-b.x,A[0].clientY-b.y),n.mouseState.press("left"),n.events.trigger("mousePress","left")),A.forEach(K=>{n.events.trigger("touchStart",new y(K.clientX-b.x,K.clientY-b.y),K)})})},de.touchmove=f=>{f.preventDefault(),n.events.onOnce("input",()=>{let A=[...f.changedTouches],b=n.canvas.getBoundingClientRect();e.touchToMouse!==!1&&(n.mousePos=new y(A[0].clientX-b.x,A[0].clientY-b.y),n.events.trigger("mouseMove")),A.forEach(K=>{n.events.trigger("touchMove",new y(K.clientX-b.x,K.clientY-b.y),K)})})},de.touchend=f=>{n.events.onOnce("input",()=>{let A=[...f.changedTouches],b=n.canvas.getBoundingClientRect();e.touchToMouse!==!1&&(n.mousePos=new y(A[0].clientX-b.x,A[0].clientY-b.y),n.mouseState.release("left"),n.events.trigger("mouseRelease","left")),A.forEach(K=>{n.events.trigger("touchEnd",new y(K.clientX-b.x,K.clientY-b.y),K)})})},de.touchcancel=f=>{n.events.onOnce("input",()=>{let A=[...f.changedTouches],b=n.canvas.getBoundingClientRect();e.touchToMouse!==!1&&(n.mousePos=new y(A[0].clientX-b.x,A[0].clientY-b.y),n.mouseState.release("left"),n.events.trigger("mouseRelease","left")),A.forEach(K=>{n.events.trigger("touchEnd",new y(K.clientX-b.x,K.clientY-b.y),K)})})},de.wheel=f=>{f.preventDefault(),n.events.onOnce("input",()=>{n.events.trigger("scroll",new y(f.deltaX,f.deltaY))})},de.contextmenu=f=>f.preventDefault(),Ce.visibilitychange=()=>{document.visibilityState==="visible"&&(n.skipTime=!0)},ce.gamepadconnected=f=>{let A=We(f.gamepad);n.events.onOnce("input",()=>{n.events.trigger("gamepadConnect",A)})},ce.gamepaddisconnected=f=>{let A=ft().filter(b=>b.index===f.gamepad.index)[0];gt(f.gamepad),n.events.onOnce("input",()=>{n.events.trigger("gamepadDisconnect",A)})};for(let f in de)n.canvas.addEventListener(f,de[f]);for(let f in Ce)document.addEventListener(f,Ce[f]);for(let f in ce)window.addEventListener(f,ce[f]);let Kt=new ResizeObserver(f=>{for(let A of f)if(A.target===n.canvas){if(n.lastWidth===n.canvas.offsetWidth&&n.lastHeight===n.canvas.offsetHeight)return;n.lastWidth=n.canvas.offsetWidth,n.lastHeight=n.canvas.offsetHeight,n.events.onOnce("input",()=>{n.events.trigger("resize")})}});return Kt.observe(n.canvas),{dt:v,time:R,run:ne,canvas:d,fps:I,numFrames:Q,quit:w,setFullscreen:Ge,isFullscreen:Pe,setCursor:Y,screenshot:k,getGamepads:ft,getCursor:j,setCursorLocked:$,isCursorLocked:x,isTouchscreen:we,mousePos:oe,mouseDeltaPos:ee,isKeyDown:Je,isKeyPressed:Fe,isKeyPressedRepeat:Bt,isKeyReleased:qe,isMouseDown:U,isMousePressed:Ee,isMouseReleased:M,isMouseMoved:st,isGamepadButtonPressed:Ft,isGamepadButtonDown:Pt,isGamepadButtonReleased:Ye,getGamepadStick:Ze,charInputted:qt,onResize:Ct,onKeyDown:Xe,onKeyPress:ir,onKeyPressRepeat:sr,onKeyRelease:Dt,onMouseDown:ot,onMousePress:at,onMouseRelease:ke,onMouseMove:It,onCharInput:kt,onTouchStart:Ut,onTouchMove:Nt,onTouchEnd:Lt,onScroll:Ot,onGamepadButtonDown:ht,onGamepadButtonPress:lt,onGamepadButtonRelease:ut,onGamepadStick:dt,onGamepadConnect:ct,onGamepadDisconnect:Gt,events:n.events,get paused(){return n.paused},set paused(f){n.paused=f}}},"default"),wr=2.5949095,Bi=1.70158+1,Fi=2*Math.PI/3,Pi=2*Math.PI/4.5,vr={linear:e=>e,easeInSine:e=>1-Math.cos(e*Math.PI/2),easeOutSine:e=>Math.sin(e*Math.PI/2),easeInOutSine:e=>-(Math.cos(Math.PI*e)-1)/2,easeInQuad:e=>e*e,easeOutQuad:e=>1-(1-e)*(1-e),easeInOutQuad:e=>e<.5?2*e*e:1-Math.pow(-2*e+2,2)/2,easeInCubic:e=>e*e*e,easeOutCubic:e=>1-Math.pow(1-e,3),easeInOutCubic:e=>e<.5?4*e*e*e:1-Math.pow(-2*e+2,3)/2,easeInQuart:e=>e*e*e*e,easeOutQuart:e=>1-Math.pow(1-e,4),easeInOutQuart:e=>e<.5?8*e*e*e*e:1-Math.pow(-2*e+2,4)/2,easeInQuint:e=>e*e*e*e*e,easeOutQuint:e=>1-Math.pow(1-e,5),easeInOutQuint:e=>e<.5?16*e*e*e*e*e:1-Math.pow(-2*e+2,5)/2,easeInExpo:e=>e===0?0:Math.pow(2,10*e-10),easeOutExpo:e=>e===1?1:1-Math.pow(2,-10*e),easeInOutExpo:e=>e===0?0:e===1?1:e<.5?Math.pow(2,20*e-10)/2:(2-Math.pow(2,-20*e+10))/2,easeInCirc:e=>1-Math.sqrt(1-Math.pow(e,2)),easeOutCirc:e=>Math.sqrt(1-Math.pow(e-1,2)),easeInOutCirc:e=>e<.5?(1-Math.sqrt(1-Math.pow(2*e,2)))/2:(Math.sqrt(1-Math.pow(-2*e+2,2))+1)/2,easeInBack:e=>Bi*e*e*e-1.70158*e*e,easeOutBack:e=>1+Bi*Math.pow(e-1,3)+1.70158*Math.pow(e-1,2),easeInOutBack:e=>e<.5?Math.pow(2*e,2)*((wr+1)*2*e-wr)/2:(Math.pow(2*e-2,2)*((wr+1)*(e*2-2)+wr)+2)/2,easeInElastic:e=>e===0?0:e===1?1:-Math.pow(2,10*e-10)*Math.sin((e*10-10.75)*Fi),easeOutElastic:e=>e===0?0:e===1?1:Math.pow(2,-10*e)*Math.sin((e*10-.75)*Fi)+1,easeInOutElastic:e=>e===0?0:e===1?1:e<.5?-(Math.pow(2,20*e-10)*Math.sin((20*e-11.125)*Pi))/2:Math.pow(2,-20*e+10)*Math.sin((20*e-11.125)*Pi)/2+1,easeInBounce:e=>1-vr.easeOutBounce(1-e),easeOutBounce:e=>e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375,easeInOutBounce:e=>e<.5?(1-vr.easeOutBounce(1-2*e))/2:(1+vr.easeOutBounce(2*e-1))/2},er=vr,os=class{time;action;finished=!1;paused=!1;constructor(e,n){this.time=e,this.action=n}tick(e){return this.finished||this.paused?!1:(this.time-=e,this.time<=0?(this.action(),this.finished=!0,this.time=0,!0):!1)}reset(e){this.time=e,this.finished=!1}};o(os,"Timer");var js="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAD0AAAA1CAYAAADyMeOEAAAAAXNSR0IArs4c6QAAAoVJREFUaIHdm7txwkAQhheGAqACiCHzOKQDQrqgILpwSAeEDBnEUAF0gCMxZ7G72qce/mec2Lpf9+3unaS78wgSNZ8uX5729+d1FNWXUuGmXlBOUUEIMckEpeQJgBu6C+BSFngztBR2vd+ovY+7g+p6LbgaWgJrAeUkDYIUXgXdBBwNi6kpABJwMTQH3AZsXRR8GHTfgEth8E3gjdAUcNewpbTgY85sCMCUuOokozE0YM0YRzM9NGAAXd8+omAF5h4lnmBRvpSnZHyLoLEbaN+aKB9KWv/KWw0tAbbANnlG+UvB2dm77NxxdwgBpjrF/d7rW9cbmpvio2A5z8iAYpVU8pGZlo6/2+MSco2lHfd3rv9jAP038e1xef9o2mjvYb2OqpqKE81028/jeietlSEVO5FRWsxWsJit1G3aFpW8iWe5RwpiCZAk25QvV6nz6fIlynRGuTd5WqpJ4guAlDfVKBK87hXljflgv1ON6fV+4+5gVlA17SfeG0heKqQd4l4jI/wrmaA9N9R4ar+wpHJDZyrrfcH0nB66PqAzPi76pn+faSyJk/vzOorYhGurQrzj/P68jtBMawHaHBIR9xoD5O34dy0qQOSYHvqExq2TpT2nf76+w7y251OYF0CRaU+J920TwLUa6inx6OxE6g80lu2ux7Y2eJLF/rCXE6zEPdnenk9o+4ih9AEdnW2q81HXl5LuU6OTl2fXUhqganbXAGq3g6jJOWV/OnoesO6YqqEB/GdNsjf7uHtwj2DzmRNpp7iOZfm6D9oAxB6Yi1gC4oIYeo4MIPdopEQRB+cAko5J1tW386HpB2Kz1eop4Epdwls/kgZ1sh8gZsEjdcWkr//D8Qu3Z3l5Nl1NtAAAAABJRU5ErkJggg==",zs={};Ns(zs,{default:()=>as});var as=Ls("SUQzBAAAAAAAI1RTU0UAAAAPAAADTGF2ZjU4Ljc2LjEwMAAAAAAAAAAAAAAA//tQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAASW5mbwAAAA8AAAASAAAeMwAUFBQUFCIiIiIiIjAwMDAwPj4+Pj4+TExMTExZWVlZWVlnZ2dnZ3V1dXV1dYODg4ODkZGRkZGRn5+fn5+frKysrKy6urq6urrIyMjIyNbW1tbW1uTk5OTk8vLy8vLy//////8AAAAATGF2YzU4LjEzAAAAAAAAAAAAAAAAJAQKAAAAAAAAHjOZTf9/AAAAAAAAAAAAAAAAAAAAAP/7kGQAAANUMEoFPeACNQV40KEYABEY41g5vAAA9RjpZxRwAImU+W8eshaFpAQgALAAYALATx/nYDYCMJ0HITQYYA7AH4c7MoGsnCMU5pnW+OQnBcDrQ9Xx7w37/D+PimYavV8elKUpT5fqx5VjV6vZ38eJR48eRKa9KUp7v396UgPHkQwMAAAAAA//8MAOp39CECAAhlIEEIIECBAgTT1oj///tEQYT0wgEIYxgDC09aIiE7u7u7uIiIz+LtoIQGE/+XAGYLjpTAIOGYYy0ZACgDgSNFxC7YYiINocwERjAEDhIy0mRoGwAE7lOTBsGhj1qrXNCU9GrgwSPr80jj0dIpT9DRUNHKJbRxiWSiifVHuD2b0EbjLkOUzSXztP3uE1JpHzV6NPq+f3P5T0/f/lNH7lWTavQ5Xz1yLVe653///qf93B7f/vMdaKJAAJAMAIwIMAHMpzDkoYwD8CR717zVb8/p54P3MikXGCEWhQOEAOAdP6v8b8oNL/EzdnROC8Zo+z+71O8VVAGIKFEglKbidkoLam0mAFiwo0ZoVExf/7kmQLgAQyZFxvPWAENcVKXeK0ABAk2WFMaSNIzBMptBYfArbkZgpWjEQpcmjxQoG2qREWQcvpzuuIm29THt3ElhDNlrXV///XTGbm7Kbx0ymcRX///x7GVvquf5vk/dPs0Wi5Td1vggDxqbNII4bAPTU3Ix5h9FJTe7zv1LHG/uPsPrvth0ejchVzVT3giirs6sQAACgQAAIAdaXbRAYra/2t0//3HwqLKIlBOJhOg4BzAOkt+MOL6H8nlNvKyi3rOnqP//zf6AATwBAKIcHKixxwjl1TjDVIrvTqdmKQOFQBUBDwZ1EhHlDEGEVyGQWBAHrcJgRSXYbkvHK/8/6rbYjs4Qj0C8mRy2hwRv/82opGT55fROgRoBTjanaiQiMRHUu1/P3V9yGFffaVv78U1/6l/kpo0cz73vuSv/9GeaqDVRA5bWdHRKQKIEAAAAoIktKeEmdQFKN5sguv/ZSC0oxCAR7CzcJgEsd8cA0M/x0tzv15E7//5L5KCqoIAAmBFIKM1UxYtMMFjLKESTE8lhaelUyCBYeA2IN4rK1iDt//+5JkEgAkZzlVq29D8DJDWo0YLLARwPFZrL0PyLsUazTAlpI+hKSx01VSOfbjXg0iW9/jVPDleLJ15QQA4Okdc5ByMDFIeuCCE5CvevwBGH8YibiX9FtaIIgUikF42wrZw6ZJ6WlHrA+Ki5++NNMeYH1lEkwwJAIJB4ugVFguXFc20Vd/FLlvq1GSiSwAFABABABA47k6BFeNvxEQZO9v3L1IE4iEVElfrXmEmlyWIyGslFA55gH/sW7////o9AAFIBIIAAIUMzYTTNkgsAmYObfwQyzplrOmYvq0BKCKNN+nUTbvD7cJzvHxrEWG5QqvP8U1vFx6CwE8NoRc2ADBeEb/HoXh60N7ST8nw9QiiGoYvf/r6GtC9+vLwXHjaSkIp3iupC5+Nii81Zhu85pNYbFvrf+UFThDOYYY26off+W6b//73GTiN9xDfl0AAwBAiMBO8qsDBPOZtuT/dTbjVVbY/KSGH6ppHwKv/6X+s8gUCN/lODzv////GQAGAMQAADlXAUCBJiY0wFQZusYQOaQzaTwDBTcx0IvVp8m7uxKp//uSZBMCBHRI1eNPLHAyxNqWGeoYUIEnWYyxD8DUFSn0l6iojcd+oEOkzV6uWqyHNzjqmv+7V5xGUfY9yEmbziTzjRscm9OqFQp1PKFrqu3PX/7YuGtDU6bt0OUTpv38rdc+37dVDQLKUchaJ853E9edNDGqWwsYz1VoiSStEJtZvw6+sNqFWqaIXJjQCGAAGWAYVwmag/x3BRJw1wYF7IzVqDcNzn85d//FzK7IgwbQwccLoB4AsF8Nj/1ESRUAAVJwAFh0YOFEhmSJEHKQRDyhszgLUpHIgFrb5cySFg5jv10ImlYuvaaGBItfXqnNPmic+XNkmb5fW49vdhq97nQMQyGIlM2v8oQSrxKSxE4F1WqrduqvuJCRof1R7Gsre9KszUVF1/t3PzH2tnp+iSUG3rDwGNcDzxCGA8atuQF0paZAAkAhAQAEAC240yJV+nJgUrqq8axAYtVpYjZyFGb13/17jwiClQDaCdytZpyHHf1R/EG/+lUAgAAAChhmJvioVGGBCFgqdpsGAkUUrbTstwTCJgLQpFIsELW7t/68Iv/7kmQUgAQ9NFO9aeAAPAU6RKwUABClY2e5hoARGpDvPydCAsY8WO10fSvUOnfT98+n/l/6/+hxslhQ1DEOaevNKGocvIYba8WJpaP/15pX0NQ1DUNn/////k6lPp/N61rBi8RJFfERV3IgrqDsJA64sjCoKxDDQ9xEcWDpMBDwVFDIAEIAAzryxsjGi4q/oWpixKjhklAF4pUrDPjFhFVupDFZ/t/t0YPAygUBhADPR/KLCKJ8h2Oxhpxz/zNRAAFl0MAZLAYEAiVbEiz36LSgZ5QoQVat69KNy8FyM5Z80ACHAzgnISEkxUSJIDyBSwi5KF4mjBl4xJdbrG9ComLrL8YATiodhQKCkj6ROdyg1y5XmZlvMVmpJzYppJDwLi/Lp9vT3TfmimOGpuezi2U/9FNav0zX9Oja2r//8+hvuihuQAAMAVmqFgAgCcuboAEAAAUcqy8ca0BHBmwbFkED0CNA1YYDPkhcQrRJxcY3BzfxxltAz9vX62Xl3plAzWmRO+FkZyH///1qAAEjQBAACUpgU5o2AIBmFBGMamrGg0b/+5JkC4ADxyLWb2ngAEEkGofsoACP7U1JLaxTkOqFaKhspGgnW3SGC56ZgUJGCRnLOmIJAkuNBgvwU4Ocf8CJK9UsafH9/Frj///365XSoME+DZMw5UNjrMbVoeIj9EL91IuQ5KHyl5V2LCpdIdESgafOHxVGkAlkHuakmix/gN8+BP/sKguLAAoAtUjtvaoeEADwr3OK11E4KBlojgeQNQBJ4MvCAd/4t/xMMzeLhQGQ1//6tQu5BaBOGCT6U4aafvXZ//4iAPAAAAbLkgIlQmMSLA2H1CVNAlWwyVvKIQIxOSK1NWxs4MBUATlKrAkIMPAjCAdS6MVFzuURWa/+/qQWEGsA6EEpiBEJb9Q21lAHoBoD0B6aAPhyt+bG3muoXIN3RLadXxUfr/ohjGFF/p97eqNI5noKAqYLNPpUTDSI9/TmA6B+YAAADgA0Y4lxTW1SQfOQuDDDI0KTTuIrF5qoJrUFhUFAsg+AT2hbkaRZYGIjBKVDIa5VgNN/9P/rCDsBJbYJRKpCA1ArAkigIeYY61AjE+jubyiZFZ3+L789//uSZBCABHVj2entNmw1JXokLycYEFTFVa0wz4DYjKs08J2Q+r4n3lgbWaaMwMLEjFW88F39brqPF83cv1mCSJeY3Q2uiQxhBJxCBeR1D2LQRsYQcZUTzdNll8+OwZBsIwSgl45ymaHX603Mz7JmZuvt71GDTN66zev/+cLn/b5imV8pAHkg61FIJchBSG+zycgAZgADD6F1iQQRXRWmWS6bDIIgyBCZEcdl/KgXGmVKFv/vl8ry/5bLypf//U5jhYDhL9X/pAA0AKBIAAKgGtGXGGWJgEoF2JNsHlKfSKLRhGBAgIuWZKIJCFpF1VBhkB+EfzEyMUJdWuMrEZoPZ5BfF3/Nu62riIdjoO4AAKD2sTrDmpZZaYysf/810TitAVvn9xtFucieiaEy54YqiIO6RqkGAm5wVO0bFB0sDTdNxYGekKktR4KAAfAwUIgI8Ci6aXgtwbhPWAC+CKExAFydNtYGXNZoQjUsXv/9vKjgmdwieb+h7kHvPoc//0FaCACAATKFC4Y9ammklidbaiJNPBhGWTNhFSgdtalK12lpl//7kmQRAFN2NFI7TBvwNKNaTRsFGBWdfV2tPNcYvBHpgPKJsc8IUcTCxY3HSvUVNTWe/Z3YWlrJ0yrNRUiT19aprA7E+mPP+ZmC3/CsheOJXhc/9VJb3UZnphUBcqZUZQth1i3XqtPYu2Sy1s8DV9ZYACAAASAAHgFkQcOqgB5utFHFh3kSi4USs0yk4iOClREmjvdG+upaiLcRA6/9QGbOfxF/8sEAQAVG0G07YFMihKR4EXJCkRdX9isueLqUMRAQdhDZmv3KeR0nPqRVrZmSIXDt+BBSR7qqbKQcB98W9qiMb55preHIStxFWPE4lAyI+BKz2iSxonpvMR5DgKxTH6vGGXAbYCaAnJUW4W07EesQqbfqdbo4qNnPxSpn1H8eahszc/y9//dn1V7D/OYpn1szQKAPXTMlO/rO//u7JriJXbld7aP33v6RXYg/COIDzTWkTspg6Ay1YaDSwKxrP/LfIikHjmO871POf/kEAseAgoPEi9/0ZziNwfxVKy9qAEGEEAAq1EcOamDEGHAA0iao8k31rz2MiLNEik6VQ37/+5JkEAgEYU5WU0M3MDjDe0o9IjiOzSVM7aCzEM2GqXD8pFB0zxMcHCQNHtZD+R+pMWZxOJ/otEZTvVN/MeU12xTVcL+f2YaiNJTVoPd6SvzEnKel5GXOzEaazgdChnP2jOAwpfyRpVlQwoJBwpN1L1DL////6TVWcoepf7CVWrpEWiym5lR5U0BSMlxQC4qByOyQIAEuJfIriWixDqRgMfVZWuvRowjR9BzP5lZlT/+YG50CsSBG////////liXDQVMxEaBkbzKAAACnDIAstY7iK7gGSF7SIDexaTtPOHABk9YcmJEACmo50pgWal22etroBpYoVqtU6OPqvlf0c4QCAfLk9P/FJs4KCQMf6ECZyA6BwqqyJ0rMYj56k1/UlTIx1V3Rt5NF71D4qlptDC8VMgQVHFDlQnDFi06qQgKQAAIK4TxxJGFGYJuZNGXRdpq7IW/DYpPIQRFJLAc+qn1E0XYdOkQVJT+z8Lvff//8vbKAWTIBBUUdM6cOhlDry7x4dAkJXIBhbO3HSMMMGBQ9K9/JNfu09PjTO64wYEcR//uSZBeABP5g11NPRVwzQ4r8PMJVj7j9UU2wUwDPjeq0Z5w675D9+uDdL2QsuIry2lZtwn/pJYyRRjANEOQxNWw8mU7Tq+vueV7JrX/Pg7VIkEuZT5dwd85MVoq5lpStNICkBAcFR88//58KO8Zjt2PIGxWl1cVfXeNGH18SReNT//hYliWtQuNluxyxONbm4U+lpkAgpyE7yAIYUjIaqHmARJ0GQTtmH60xdwFp/u253XBCxD0f/lBcguCALn//Y5nqEv//1h4BAAwgAA5gcHmpIplgeW9fAOM6RFZUywrsGAiRmKkanQnCFBjYoPDS7bjwtPTkVI8D/P8VVLcTUz65n7PW2s3tNYHgEul4tBaIz0A9RgJAyAMI4/i0fpQKjhX9S+qIa0vmc4CZit/0/3UTDGeKNpkk0nu2rUE2ag8WErhE/kgAiQCJKQEYBA5Wn6CxHoIUh6dQ46nLIuwFk4S/LaDQxXu7Yf/pf//lwJB0S/Ff/4C///EiBEiAAAIAMnpngiIABAdMpKigkXaUwhLEGvpiofmXW57h2XAZO3CMRv/7kmQUAEOHQlHraRTQMkQp6GWFZBTVU1lNPTPYyIyocYeUoNgLBWAs1jPkTv/tXBaeZ/tbD/nAGP8/xT0SNEi5zof0KIVEzVe9r5lZOol7kyaXMYS4J/ZS3djp//UaeVyR0mUMlTgfz8XqMzIEgAQQ6UNQ1DSE0/C16OvyaocF4ijAGFci0FSYqCUSaWs6t9F6/699DKvMgMoK1//kSbvxtyBN27I7mdXgNMAW75sRU1UwUHYG5axI2tFIFpkgx7nnK+1JmRKjqeAd5Ph0QAL4QAnirmiPlg0yBDlrb/d3ngtA65rb999+8vdDCfnJuJAYIl285zklpVbrKpk1PEzrOY9NZUgyz6OiOsKt5qG/g2ibxSZ+/eTI/NB8n4ev//n2nIw85GAdwuJL7kYnnAbpcf1RBKH6b2U4RWP8dmWH5snsAFYwADBgAopKdzFJq4Jlmotloh/m4QpTSvJRE3nYZHephoqBhVf+P7vQ9BPlwZCP+3//+hdy5uUwS3LDEgQx4cdIgvDEBR1YqymCsSbKzRy2aQmSv+AAcAgAkvzPfuX/+5JkFQAj6VFX00Zr5DllOhhgpn4MmSs+zSRRiO8U5tWklYgSLKfs+Xheb/+6WaAQCKTztNeJ382MUltZNnjSJoFrCqB6C4mFcwJpJD4Oc8dLDXMTh9k1/rmTopfzqv9AvHWfOuZJlEvHSVMjyjpkVucKSzxJVQBgAAIo8DGqRdYCXPckFYg+dH9A/qUyljrtpxH9RJX/Z3Vv6uFkPg4M2jf3CL09QrwOrMt69n//8UFEAAMHWdhg1CcjyVBwiArOYlDL5NPY6x8ZLFBCGi6SVTKX5nqdSEFjebnv2zHdt0dj6xvORsSFzwqRNTJSZIrrlpXcURNL9WW7krBgr5jPMaGcvJ5v0N1s19CV7+7fvQfjySX2QECWUgKgeJCIif4WRBZ/6archpDkzE7oWctK3zEHP9Smeai8oeHkM6AK7pGjtOgeFv40ugqNd+Iv///uAZAMgAAAUeSWhLPpdwk3iXpBw43hOVIp1gliUOSaeZcZeZhLAH9TtD56wUpBduzLF5v5qViTH6o+I0+8Z1asaLgKVAohlpB72DgAQBQxEd3g//uSZCiAA6k0UdMPQfA+xcnBYON8E3WDVU0w1ZjPDSmo8IniHAFDNnkXF3B94gicH5d8MFw+IHZwufxOf/8gsHw+XrD4Jn8T4RAyQiABNBQg/3giEWuZ42mVFB3kkXNjhqBg1CghEUbN3/7/KBhyqNueef/MIDBClP3YRnKLiIlEFzf//0g+4zKpRIKTpqQgUtnHGFw6RSLN421iGcYapqFxny/capK9r9v+2BSy/RU1yZxa2eGaWK07ijfcxeiO3iuHJvjbXzts+Ny+XyFnsne1h0qG4mAaN6xRGaLVxKPlrri0Bg9oXGyxcw8JRBPkUzC8v451vVd9liSX85JMrmkVNwxOCwUg298////7ks//L409/hwMRIozKiIckXtjzDaAMTBcAACAwLGargPSEgEJZN/EFjfF/VKgaMYKMbwtf/T0UCGGfjfOAZ2frCigYdwh/+sGlQBxhCAAAUHkDPqOdmmUdAVYl3IhrEfR8qZFjLYEPOyzVGvm6lNUJCk2PNazwFxaijk+ZEaiTehoJGuDh6zN/EVP8BCLD/88BoY7Xv/7kmQlgBNmMtNTL0FwOGZJ/WHiKAyhJU+soE3A3JnmAa2oaCIru/+RrEHMTphxQ0X/LzoVy4gKhYl6ZUlklW7CLRVoYmgABwCRMAAMA/poCiEEYLsBVodWcVZ18+CcAfH165U4Xgh7/X1/BAQF6GN/BwQ/+D9S9P6wII//CoANYFYCBAKlGQDKhVjjylKARw2mPAtp8JjcQHggQswVsOEKsF6AIBWvmpIFdSZvRVv/LHWEy0+txMxu+VK9gEqG5pWf6GNGU4UBVkfd+bsj/6lZE0fkOpAqAOvyUO9oo+IiEtcLKOGzhhSGa4MYINHWoQsFr8zzmow0tRILkqz5/+vFxl/oZX/+qGW//xiLjR3xcGn//0QLkTQJh1UA8MAQAEXC/YxODKTDUEhrASs1512GRp+dRFFdTWIRaOXrve1eNjTNpreqQYrC9NBlQc1f8YO2po8bnH6qffuRvU7taiNF3baokE0YpmjRCHRclWBb9NCHKHpERwHRG3pqgXklq4sBpLjGvmekg8Y7SjM1FZopIM8IhB6dtMr8aKsdovh4FW//+5JkQ4CjTDdSU0gtIDiE+YBrKgwNbSVJTCBPwN8N5ZW8NKDnhRB8AXCm//KAsBUCwKU//oJQnET+UP3/zpYRocAAABJkVzzIuoLGEaDoxfsNva12EUdxhJMGFQioSg8GxKsLm8kWEmExJuNidarkk+OTXc0i2OZEq2v+tZr/MDZRS0I7LfRpHdlsiF6m/mEjk+XlK10UqtKYUwNgMx24hUtCJLfpM3ExUeKDYjClgZAzAjQ0qlNQBTsGpk9zSRkCiKkRGp572VXsPYChGvxhAuYkDYZK//jSRgto2mTf6+PJqgAAgIAAAACYZE6aZOHhYkYlcbpeYQq1RgLO4U8TIlL1sGw+iKZi5Kzc/bKT0yXrIUMES89RCWy8oWlxqIQlKANLFpT/KjUrK+UCYbZqGnjVj29aO5dzofWAskRX5eJWPi4kf/aRVjy3Wlyg2AnMYIDSTLwZUTASIzflPWUwwlUnIFMnGiyABeaXJcN91PmQJCLzmvUJkFOHCrX/+6O///IHnT4tT9YYBoNMQ09GfKIErwdwChNz1Qy5+5S/wWeY//uSZF+C03UyT2tMO0A3RRkhY20KzQjDMszhA8DjlGOBp5y4ZCS3ica52GIGiryv7FAaSDVZSXKFTiir+GvGiuK4rjgwPVTddso+W/42a4ueJJHDYtfj6YoKknnjzRgKA0fBIRZOSsprJqnoNN73ps/Z9DVgbKNbMGmRzrYBMAZCPUANkAZQ0syAC2ubK1NF90+WoesBpnhY8qwVDkNb/5Uof6//418TgElCSgAIgyAAQBHEmiaQFPIRmfAMELffpo0IflyEuAAQnSnKvwTlVlnIgOAAGS3P3IydjXPSh/CaVRqpSNCjQqDvPM+fLcuN+WgqNix6CoHomUWTT86JjziRSZ3yjnq+dIldKPU11KUuf6wAASMAAJxE+MlyktgE9UGSxjEx6RR0v1s9bWZ+EJSrGtjqUIhklG3J8eLRn/2U/nv7f///+7/6gBQgEAMUijVMwweWWMyYM/PLXuc7DptIQmBARMRCxXjEIcTNDQgSSeHpUNXO7dRSOllJPvnY7yzaO1hmUjsKvHe99fOxrabMX7mGTi5tsNkZVZLndzxse//7kmR7ABM2O0pbKTvQN4NI+WGFPA2ZESs1pYAAvA0jVrJwAHfbr/c6//vW790dzX36QNBRlDv/6QQAU3V64yUgBEAYc/lI8e5bm+Z9+j+4aaj4tFrb//iker/4a12b/V//q//9v+7vAEAAAAMqZTGd5gL4f54o6ZebKNrR/zWVYUEVYVVv8BuAV2OUT+DUQgkJ8J1Ey4ZbFCiAwgwzMSdHV4jQR+OoPWEASaPkyYq+PsQFFJCsEEJtOiUjI/+GRhtC2DnizTMXATJig9Ey/kAJMrkHGYJ8gpLjmJOYoskpav+ShRJInyGGZVJMihDi6pIxRZJJel/8iZPkYiREnyKE0akTL5QNSqT5iiySS9Ja2SV//5ME0ak//+4KgAAABgQBAADAMDgYCAEgCteQ0fZH6+ICXA357+MPfhR/+ywRf/U///LVTEFNRTMuMTAwVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVX/+5JknQAFoWhGLm5gBClBmT3GiAAAAAGkHAAAIAAANIOAAARVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV"),Qs="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAOcAAACDCAYAAAB2kQxsAAAAAXNSR0IArs4c6QAABdRJREFUeJzt3d3N3TYMgGG16ADdoAhyl7UyV9bqXRB0g2zQXgRGDcOWSIoUaX3vAwQBknMk/4gWLcnHrQEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACDEb9kb8FH99eeXf6Wf/efn35ynDyj1pEsb6G6NUxOYZ7sdB/QtPdnWRnn29gbKMYDUspPs0SgPb22cHANo/JG9AZF6wWBp3JLgeir36bvff3x9LOvzp2/dbSFA97bk5I4a9VMD7TXOUcP0uJ+d6emu5d6V1QvMs5nj8FZPx37X/b2TFpzShtnafeP0DipJMFnLnN3/w1OQ7tZgP+pA4VVKcHo0TG36KNULKGt5XsHZmi1APS5WM2Vqg0i7vbsG6YcIznN9vRTxXHavgdxtv6Tc3vc1pAHqdaG6ipwKYprpf1sFp6aH0gRTrxxLubPB2avHu+c/l3mICvqnsr//+Cq+qGrK1Xw/wzbBaRkNvSv3yew9cq+cu89L6nu6F/cMzCgzF1ftANlbe+Otp1IkDVxyVfbo6Z481f3507dhvXfbrk3HpdtjKTNqKuio8678c7mzF6ns6arfMyrVNoA75wMfNU2hKSeCx3Fq7dc+SPfDc39H9Vqn2CT//4bsYeT1PecOJyGSJdh6PZOlbElPZz2PHtlD1cUeS4LT4z5IOihwfNaD5ERm9qxH/dZ7Vmt9M999CtCZbdLUP/p3r2zFQ0paG8lr4Eb6+ZWBcSeq/qhyK6bXUfXOSgtO7/tOb9eT1NveqKttpYbiyXu/euV51JV16/T6e86zyF5TUp731V5Sp+Z7M71h9QvFNWWuvr0Sy4LzLfNvrel6zRX1e+hN2VzrnNlfaYD0xhCs++851lDh3vNV95xe6YvHgb8bwbNcuc+f09wbaUj2dzYgjz93//5kh94t0quCM8OKK6glKKuM0EYHfhUZWd8WwenZa0rLsp6s2YY66o0k9WUvS4NManBaGuo1eDIHgUZ1ePdkntsfFaCz5VZJdStsxyt7ziMNXHEAK5yk1mqmhrMPf1fcp57Vqe3SqZTMEduZhqAZyaywFne0DVHngHTZ11bznE88l/1lBZ9meP8851plWkBCO7drmQvWnL/sY/fKtFaqN3iy6iofsQxNktJnTMgfPXJUz3w3VaP5vOQ7Iyszvy2DczSi+aYFET2jINUEqFcAS4+rV480WlwRWXe07dLa0YGvfl9kmbTvPZJ1TXGvn4t4yuRp+2aMgk27wkm63DIztU3vOVfueC8wK4zKWtK0M+nvJXmOdlt65MgFFCva06qsKz044SvjIiN5TjLaaHxhtNyyouXBGZ1WSn66Ivt+M7pRZAWoZsDq+t2emeM1am/WtHxFG9runrO1/n1CxLK7CilxJM/H4bwuTJJBvWtgvm0gcNu01uvpd8la1soLE7xkpYDea4Ot6W3GOSzRc3o/qHw2M9qmXWA+uw+jbd0hyO9Yz0+vJ9QGcO/8ZV2YUqYVPN8dImXp3aJ/w1XTGGYfKZN+P7IXiXqO1uINLzFOm/Pz+BV4C03PNEqpZl//ELXP1ro8nhLyKLPHMyAiXyvh4cMFZ2uyAJXc62gzgJl1nhrSLMEzcLx+5qQnIhgqv6qhTHC2Zmus1tUuowCVDkRU6j0jgiJqhLPSSq2q7wMtMSBkdbcQWjNCq2nMlRrTnajAPP/t+c5Sj3K8VNueQ+pGzaa2MyOb2sZseW2dpL6ZnjMzfeQFt/Fe3XP2WIfGvRY6a569jCJ9TaIlcCS9KQE5p1TP2VrMbwLNDlZEvpE5AkGxh9f2nLO/QOetytIwAnMf6SfS2ns+jaZ6B4i2sWvSvF0HWOAj/aRGNFAaPXbw2rS2Rzr0T/ChshKNM3qd4135BCaqK9VAKy+lAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/4DBC0k0jFtF9wAAAAASUVORK5CYII=",Js="data:image/png;base64,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",Xs="3000.0.14",Ci=" !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~",Ar="topleft",Di=64,Zs="monospace",Vr="monospace",Ws=36,Ii=64,ki=256,Ui=2048,Ni=2048,Li=2048,Oi=2048,Gi=.1,_s=64,qi="nearest",$s=1,hs=[{name:"a_pos",size:2},{name:"a_uv",size:2},{name:"a_color",size:4}],yr=hs.reduce((e,n)=>e+n.size,0),ls=2048,Yi=ls*4*yr,Ki=ls*6,eo=`
attribute vec2 a_pos;
attribute vec2 a_uv;
attribute vec4 a_color;

varying vec2 v_pos;
varying vec2 v_uv;
varying vec4 v_color;

vec4 def_vert() {
	return vec4(a_pos, 0.0, 1.0);
}

{{user}}

void main() {
	vec4 pos = vert(a_pos, a_uv, a_color);
	v_pos = a_pos;
	v_uv = a_uv;
	v_color = a_color;
	gl_Position = pos;
}
`,to=`
precision mediump float;

varying vec2 v_pos;
varying vec2 v_uv;
varying vec4 v_color;

uniform sampler2D u_tex;

vec4 def_frag() {
	return v_color * texture2D(u_tex, v_uv);
}

{{user}}

void main() {
	gl_FragColor = frag(v_pos, v_uv, v_color, u_tex);
	if (gl_FragColor.a == 0.0) {
		discard;
	}
}
`,en=`
vec4 vert(vec2 pos, vec2 uv, vec4 color) {
	return def_vert();
}
`,tn=`
vec4 frag(vec2 pos, vec2 uv, vec4 color, sampler2D tex) {
	return def_frag();
}
`,ro=new Set(["id","require"]),no=new Set(["add","update","draw","destroy","inspect","drawInspect"]);function rt(e){switch(e){case"topleft":return new y(-1,-1);case"top":return new y(0,-1);case"topright":return new y(1,-1);case"left":return new y(-1,0);case"center":return new y(0,0);case"right":return new y(1,0);case"botleft":return new y(-1,1);case"bot":return new y(0,1);case"botright":return new y(1,1);default:return e}}o(rt,"anchorPt");function us(e){switch(e){case"left":return 0;case"center":return .5;case"right":return 1;default:return 0}}o(us,"alignPt");function ds(e){return e.createBuffer(1,1,44100)}o(ds,"createEmptyAudioBuffer");var cs=o((e={})=>{let n=e.root??document.body;n===document.body&&(document.body.style.width="100%",document.body.style.height="100%",document.body.style.margin="0px",document.documentElement.style.width="100%",document.documentElement.style.height="100%");let d=e.canvas??(()=>{let t=document.createElement("canvas");return n.appendChild(t),t})(),v=e.scale??1,R=e.width&&e.height&&!e.stretch&&!e.letterbox;R?(d.width=e.width*v,d.height=e.height*v):(d.width=d.parentElement.offsetWidth,d.height=d.parentElement.offsetHeight);let I=d.width,Q=d.height,k=e.pixelDensity||window.devicePixelRatio;d.width*=k,d.height*=k;let Y=["outline: none","cursor: default"];R?(Y.push(`width: ${I}px`),Y.push(`height: ${Q}px`)):(Y.push("width: 100%"),Y.push("height: 100%")),e.crisp&&(Y.push("image-rendering: pixelated"),Y.push("image-rendering: crisp-edges")),d.style.cssText=Y.join(";"),d.tabIndex=0;let j=document.createElement("canvas");j.width=ki,j.height=ki;let $=j.getContext("2d",{willReadFrequently:!0}),x=Hs({canvas:d,touchToMouse:e.touchToMouse,gamepads:e.gamepads,pixelDensity:e.pixelDensity,maxFPS:e.maxFPS}),me=[],u=x.canvas().getContext("webgl",{antialias:!0,depth:!0,stencil:!0,alpha:!0,preserveDrawingBuffer:!0});class X{src=null;glTex;width;height;constructor(r,i,s={}){this.glTex=u.createTexture(),me.push(()=>this.free()),this.bind(),r&&i&&u.texImage2D(u.TEXTURE_2D,0,u.RGBA,r,i,0,u.RGBA,u.UNSIGNED_BYTE,null),this.width=r,this.height=i;let a=(()=>{switch(s.filter??e.texFilter){case"linear":return u.LINEAR;case"nearest":return u.NEAREST;default:return u.NEAREST}})(),l=(()=>{switch(s.wrap){case"repeat":return u.REPEAT;case"clampToEdge":return u.CLAMP_TO_EDGE;default:return u.CLAMP_TO_EDGE}})();u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,a),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,a),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,l),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,l),this.unbind()}static fromImage(r,i={}){let s=new X(0,0,i);return s.bind(),u.texImage2D(u.TEXTURE_2D,0,u.RGBA,u.RGBA,u.UNSIGNED_BYTE,r),s.width=r.width,s.height=r.height,s.unbind(),s.src=r,s}update(r,i=0,s=0){this.bind(),u.texSubImage2D(u.TEXTURE_2D,0,i,s,u.RGBA,u.UNSIGNED_BYTE,r),this.unbind()}bind(){u.bindTexture(u.TEXTURE_2D,this.glTex)}unbind(){u.bindTexture(u.TEXTURE_2D,null)}free(){u.deleteTexture(this.glTex)}}o(X,"Texture");class Ge{tex;canvas;ctx;x=0;y=0;curHeight=0;constructor(r,i){this.canvas=document.createElement("canvas"),this.canvas.width=r,this.canvas.height=i,this.tex=X.fromImage(this.canvas),this.ctx=this.canvas.getContext("2d")}add(r){if(r.width>this.canvas.width||r.height>this.canvas.height)throw new Error(`Texture size (${r.width} x ${r.height}) exceeds limit (${this.canvas.width} x ${this.canvas.height})`);this.x+r.width>this.canvas.width&&(this.x=0,this.y+=this.curHeight,this.curHeight=0),this.y+r.height>this.canvas.height&&(this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.tex=X.fromImage(this.canvas),this.x=0,this.y=0,this.curHeight=0);let i=new y(this.x,this.y);return this.x+=r.width,r.height>this.curHeight&&(this.curHeight=r.height),r instanceof ImageData?this.ctx.putImageData(r,i.x,i.y):this.ctx.drawImage(r,i.x,i.y),this.tex.update(this.canvas),[this.tex,new he(i.x/this.canvas.width,i.y/this.canvas.height,r.width/this.canvas.width,r.height/this.canvas.height)]}}o(Ge,"TexPacker");class Pe{tex;glFrameBuffer;glRenderBuffer;constructor(r,i,s={}){this.tex=new X(r,i,s),this.glFrameBuffer=u.createFramebuffer(),this.glRenderBuffer=u.createRenderbuffer(),me.push(()=>this.free()),this.bind(),u.renderbufferStorage(u.RENDERBUFFER,u.DEPTH_STENCIL,r,i),u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.TEXTURE_2D,this.tex.glTex,0),u.framebufferRenderbuffer(u.FRAMEBUFFER,u.DEPTH_STENCIL_ATTACHMENT,u.RENDERBUFFER,this.glRenderBuffer),this.unbind()}get width(){return this.tex.width}get height(){return this.tex.height}bind(){u.bindFramebuffer(u.FRAMEBUFFER,this.glFrameBuffer),u.bindRenderbuffer(u.RENDERBUFFER,this.glRenderBuffer)}unbind(){u.bindFramebuffer(u.FRAMEBUFFER,null),u.bindRenderbuffer(u.RENDERBUFFER,null)}free(){u.deleteFramebuffer(this.glFrameBuffer),u.deleteRenderbuffer(this.glRenderBuffer),this.tex.free()}}o(Pe,"FrameBuffer");let w=(()=>{let t=_e(en,tn),r=X.fromImage(new ImageData(new Uint8ClampedArray([255,255,255,255]),1,1)),i=e.width&&e.height?new Pe(e.width*k,e.height*k):new Pe(u.drawingBufferWidth,u.drawingBufferHeight),s=null,a=1;e.background&&(s=O.fromArray(e.background),a=e.background[3]??1,u.clearColor(s.r/255,s.g/255,s.b/255,a)),u.enable(u.BLEND),u.enable(u.SCISSOR_TEST),u.blendFuncSeparate(u.SRC_ALPHA,u.ONE_MINUS_SRC_ALPHA,u.ONE,u.ONE_MINUS_SRC_ALPHA);let l=u.createBuffer();u.bindBuffer(u.ARRAY_BUFFER,l),u.bufferData(u.ARRAY_BUFFER,Yi*4,u.DYNAMIC_DRAW),hs.reduce((p,m,E)=>(u.vertexAttribPointer(E,m.size,u.FLOAT,!1,yr*4,p),u.enableVertexAttribArray(E),p+m.size*4),0),u.bindBuffer(u.ARRAY_BUFFER,null);let h=u.createBuffer();u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,h),u.bufferData(u.ELEMENT_ARRAY_BUFFER,Ki*4,u.DYNAMIC_DRAW),u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,null);let g=X.fromImage(new ImageData(new Uint8ClampedArray([128,128,128,255,190,190,190,255,190,190,190,255,128,128,128,255]),2,2),{wrap:"repeat",filter:"nearest"});return{drawCalls:0,lastDrawCalls:0,defShader:t,curShader:t,frameBuffer:i,postShader:null,postShaderUniform:null,defTex:r,curTex:r,curUniform:{},vbuf:l,ibuf:h,vqueue:[],iqueue:[],transform:new ue,transformStack:[],bgTex:g,bgColor:s,bgAlpha:a,width:e.width??u.drawingBufferWidth/k/v,height:e.height??u.drawingBufferHeight/k/v,viewport:{x:0,y:0,width:u.drawingBufferWidth,height:u.drawingBufferHeight}}})();class ne{tex;frames=[new he(0,0,1,1)];anims={};slice9=null;constructor(r,i,s={},a=null){this.tex=r,i&&(this.frames=i),this.anims=s,this.slice9=a}static from(r,i={}){return typeof r=="string"?ne.fromURL(r,i):Promise.resolve(ne.fromImage(r,i))}static fromImage(r,i={}){let[s,a]=U.packer.add(r),l=i.frames?i.frames.map(h=>new he(a.x+h.x*a.w,a.y+h.y*a.h,h.w*a.w,h.h*a.h)):Dt(i.sliceX||1,i.sliceY||1,a.x,a.y,a.w,a.h);return new ne(s,l,i.anims,i.slice9)}static fromURL(r,i={}){return Ye(r).then(s=>ne.fromImage(s,i))}}o(ne,"SpriteData");class we{buf;constructor(r){this.buf=r}static fromArrayBuffer(r){return new Promise((i,s)=>oe.ctx.decodeAudioData(r,i,s)).then(i=>new we(i))}static fromURL(r){return Mi(r)?we.fromArrayBuffer(ts(r)):Pt(r).then(i=>we.fromArrayBuffer(i))}}o(we,"SoundData");let oe=(()=>{let t=new(window.AudioContext||window.webkitAudioContext),r=t.createGain();r.connect(t.destination);let i=new we(ds(t));return t.decodeAudioData(as.buffer.slice(0)).then(s=>{i.buf=s}).catch(s=>{console.error("Failed to load burp: ",s)}),{ctx:t,masterNode:r,burpSnd:i}})();class ee{loaded=!1;data=null;error=null;onLoadEvents=new Te;onErrorEvents=new Te;onFinishEvents=new Te;constructor(r){r.then(i=>{this.data=i,this.onLoadEvents.trigger(i)}).catch(i=>{if(this.error=i,this.onErrorEvents.numListeners()>0)this.onErrorEvents.trigger(i);else throw i}).finally(()=>{this.onFinishEvents.trigger(),this.loaded=!0})}static loaded(r){let i=new ee(Promise.resolve(r));return i.data=r,i.loaded=!0,i}onLoad(r){return this.loaded&&this.data?r(this.data):this.onLoadEvents.add(r),this}onError(r){return this.loaded&&this.error?r(this.error):this.onErrorEvents.add(r),this}onFinish(r){return this.loaded?r():this.onFinishEvents.add(r),this}then(r){return this.onLoad(r)}catch(r){return this.onError(r)}finally(r){return this.onFinish(r)}}o(ee,"Asset");class Ee{assets=new Map;lastUID=0;add(r,i){let s=r??this.lastUID+++"",a=new ee(i);return this.assets.set(s,a),a}addLoaded(r,i){let s=r??this.lastUID+++"",a=ee.loaded(i);return this.assets.set(s,a),a}get(r){return this.assets.get(r)}progress(){if(this.assets.size===0)return 1;let r=0;return this.assets.forEach(i=>{i.loaded&&r++}),r/this.assets.size}}o(Ee,"AssetBucket");let U={urlPrefix:"",sprites:new Ee,fonts:new Ee,bitmapFonts:new Ee,sounds:new Ee,shaders:new Ee,custom:new Ee,packer:new Ge(Li,Oi),loaded:!1},M={events:new bt,objEvents:new bt,root:hr([]),gravity:0,scenes:{},logs:[],cam:{pos:null,scale:new y(1),angle:0,shake:0,transform:new ue}};function st(t){return U.custom.add(null,t)}o(st,"load");function Fe(){let t=[U.sprites,U.sounds,U.shaders,U.fonts,U.bitmapFonts,U.custom];return t.reduce((r,i)=>r+i.progress(),0)/t.length}o(Fe,"loadProgress");function Bt(t){return t!==void 0&&(U.urlPrefix=t),U.urlPrefix}o(Bt,"loadRoot");function Je(t){let r=U.urlPrefix+t;return fetch(r).then(i=>{if(!i.ok)throw new Error(`Failed to fetch ${r}`);return i})}o(Je,"fetchURL");function qe(t){return Je(t).then(r=>r.json())}o(qe,"fetchJSON");function Ft(t){return Je(t).then(r=>r.text())}o(Ft,"fetchText");function Pt(t){return Je(t).then(r=>r.arrayBuffer())}o(Pt,"fetchArrayBuffer");function Ye(t){let r=new Image;return r.crossOrigin="anonymous",r.src=Mi(t)?t:U.urlPrefix+t,new Promise((i,s)=>{r.onload=()=>i(r),r.onerror=()=>s(new Error(`Failed to load image from "${t}"`))})}o(Ye,"loadImg");function Ct(t,r){return U.custom.add(t,qe(r))}o(Ct,"loadJSON");class Xe{fontface;outline;filter;constructor(r,i={}){this.fontface=r,this.outline=i.outline??0,this.filter=i.filter??qi}}o(Xe,"FontData");function ir(t,r,i={}){let s=new FontFace(t,typeof r=="string"?`url(${r})`:r);return document.fonts.add(s),U.fonts.add(t,s.load().catch(a=>{throw new Error(`Failed to load font from "${r}": ${a}`)}).then(a=>new Xe(a,i)))}o(ir,"loadFont");function sr(t,r,i,s,a={}){return U.bitmapFonts.add(t,Ye(r).then(l=>de(X.fromImage(l,a),i,s,a.chars??Ci)))}o(sr,"loadBitmapFont");function Dt(t=1,r=1,i=0,s=0,a=1,l=1){let h=[],g=a/t,p=l/r;for(let m=0;m<r;m++)for(let E=0;E<t;E++)h.push(new he(i+E*g,s+m*p,g,p));return h}o(Dt,"slice");function ot(t,r){return st(typeof r=="string"?new Promise((i,s)=>{qe(r).then(a=>{ot(t,a).then(i).catch(s)})}):ne.from(t).then(i=>{let s={};for(let a in r){let l=r[a],h=i.frames[0],g=Li*h.w,p=Oi*h.h,m=l.frames?l.frames.map(C=>new he(h.x+(l.x+C.x)/g*h.w,h.y+(l.y+C.y)/p*h.h,C.w/g*h.w,C.h/p*h.h)):Dt(l.sliceX||1,l.sliceY||1,h.x+l.x/g*h.w,h.y+l.y/p*h.h,l.width/g*h.w,l.height/p*h.h),E=new ne(i.tex,m,l.anims);U.sprites.addLoaded(a,E),s[a]=E}return s}))}o(ot,"loadSpriteAtlas");function at(t,r={}){let i=document.createElement("canvas"),s=t[0].width,a=t[0].height;i.width=s*t.length,i.height=a;let l=i.getContext("2d");t.forEach((g,p)=>{g instanceof ImageData?l.putImageData(g,p*s,0):l.drawImage(g,p*s,0)});let h=l.getImageData(0,0,t.length*s,a);return ne.fromImage(h,{...r,sliceX:t.length,sliceY:1})}o(at,"createSpriteSheet");function ke(t,r,i={sliceX:1,sliceY:1,anims:{}}){return Array.isArray(r)?r.some(s=>typeof s=="string")?U.sprites.add(t,Promise.all(r.map(s=>typeof s=="string"?Ye(s):Promise.resolve(s))).then(s=>at(s,i))):U.sprites.addLoaded(t,at(r,i)):typeof r=="string"?U.sprites.add(t,ne.from(r,i)):U.sprites.addLoaded(t,ne.fromImage(r,i))}o(ke,"loadSprite");function It(t,r){return U.sprites.add(t,new Promise(async i=>{let s=typeof r=="string"?await qe(r):r,a=await Promise.all(s.frames.map(Ye)),l=document.createElement("canvas");l.width=s.width,l.height=s.height*s.frames.length;let h=l.getContext("2d");a.forEach((p,m)=>{h.drawImage(p,0,m*s.height)});let g=await ke(null,l,{sliceY:s.frames.length,anims:s.anims});i(g)}))}o(It,"loadPedit");function kt(t,r,i){typeof r=="string"&&!i&&(i=r.replace(new RegExp(`${Ys(r)}$`),"json"));let s=typeof i=="string"?qe(i):Promise.resolve(i);return U.sprites.add(t,s.then(a=>{let l=a.meta.size,h=a.frames.map(p=>new he(p.frame.x/l.w,p.frame.y/l.h,p.frame.w/l.w,p.frame.h/l.h)),g={};for(let p of a.meta.frameTags)p.from===p.to?g[p.name]=p.from:g[p.name]={from:p.from,to:p.to,speed:10,loop:!0,pingpong:p.direction==="pingpong"};return ne.from(r,{frames:h,anims:g})}))}o(kt,"loadAseprite");function Ut(t,r,i){return U.shaders.addLoaded(t,_e(r,i))}o(Ut,"loadShader");function Nt(t,r,i){let s=o(l=>l?Ft(l):Promise.resolve(null),"resolveUrl"),a=Promise.all([s(r),s(i)]).then(([l,h])=>_e(l,h));return U.shaders.add(t,a)}o(Nt,"loadShaderURL");function Lt(t,r,i={}){return U.sounds.add(t,typeof r=="string"?we.fromURL(r):we.fromArrayBuffer(r))}o(Lt,"loadSound");function Ot(t="bean"){return ke(t,js)}o(Ot,"loadBean");function ht(t){return U.sprites.get(t)}o(ht,"getSprite");function lt(t){return U.sounds.get(t)}o(lt,"getSound");function ut(t){return U.fonts.get(t)}o(ut,"getFont");function dt(t){return U.bitmapFonts.get(t)}o(dt,"getBitmapFont");function ct(t){return U.shaders.get(t)}o(ct,"getShader");function Gt(t){return U.custom.get(t)}o(Gt,"getAsset");function Ze(t){if(typeof t=="string"){let r=ht(t);if(r)return r;if(Fe()<1)return null;throw new Error(`Sprite not found: ${t}`)}else{if(t instanceof ne)return ee.loaded(t);if(t instanceof ee)return t;throw new Error(`Invalid sprite: ${t}`)}}o(Ze,"resolveSprite");function qt(t){if(typeof t=="string"){let r=lt(t);if(r)return r;if(Fe()<1)return null;throw new Error(`Sound not found: ${t}`)}else{if(t instanceof we)return ee.loaded(t);if(t instanceof ee)return t;throw new Error(`Invalid sound: ${t}`)}}o(qt,"resolveSound");function ft(t){if(!t)return w.defShader;if(typeof t=="string"){let r=ct(t);if(r)return r.data??r;if(Fe()<1)return null;throw new Error(`Shader not found: ${t}`)}else if(t instanceof ee)return t.data?t.data:t;return t}o(ft,"resolveShader");function pt(t){if(!t)return pt(e.font??Zs);if(typeof t=="string"){let r=dt(t),i=ut(t);if(r)return r.data??r;if(i)return i.data??i;if(document.fonts.check(`${Ii}px ${t}`))return t;if(Fe()<1)return null;throw new Error(`Font not found: ${t}`)}else if(t instanceof ee)return t.data?t.data:t;return t}o(pt,"resolveFont");function Yt(t){return t!==void 0&&(oe.masterNode.gain.value=t),oe.masterNode.gain.value}o(Yt,"volume");function We(t,r={}){let i=oe.ctx,s=r.paused??!1,a=i.createBufferSource(),l=new Te,h=i.createGain(),g=r.seek??0,p=0,m=0,E=!1;a.loop=!!r.loop,a.detune.value=r.detune??0,a.playbackRate.value=r.speed??1,a.connect(h),a.onended=()=>{q()>=a.buffer?.duration&&l.trigger()},h.connect(oe.masterNode),h.gain.value=r.volume??1;let C=o(F=>{a.buffer=F.buf,s||(p=i.currentTime,a.start(0,g),E=!0)},"start"),z=qt(t);z instanceof ee&&z.onLoad(C);let q=o(()=>{if(!a.buffer)return 0;let F=s?m-p:i.currentTime-p,N=a.buffer.duration;return a.loop?F%N:Math.min(F,N)},"getTime"),Z=o(F=>{let N=i.createBufferSource();return N.buffer=F.buffer,N.loop=F.loop,N.playbackRate.value=F.playbackRate.value,N.detune.value=F.detune.value,N.onended=F.onended,N.connect(h),N},"cloneNode");return{set paused(F){if(s!==F)if(s=F,F)E&&(a.stop(),E=!1),m=i.currentTime;else{a=Z(a);let N=m-p;a.start(0,N),E=!0,p=i.currentTime-N,m=0}},get paused(){return s},play(F=0){this.seek(F),this.paused=!1},seek(F){a.buffer?.duration&&(F>a.buffer.duration||(s?(a=Z(a),p=m-F):(a.stop(),a=Z(a),p=i.currentTime-F,a.start(0,F),E=!0,m=0)))},set speed(F){a.playbackRate.value=F},get speed(){return a.playbackRate.value},set detune(F){a.detune.value=F},get detune(){return a.detune.value},set volume(F){h.gain.value=Math.max(F,0)},get volume(){return h.gain.value},set loop(F){a.loop=F},get loop(){return a.loop},duration(){return a.buffer?.duration??0},time(){return q()%this.duration()},onEnd(F){return l.add(F)},then(F){return this.onEnd(F)}}}o(We,"play");function gt(t){return We(oe.burpSnd,t)}o(gt,"burp");function _e(t=en,r=tn){let i=eo.replace("{{user}}",t??en),s=to.replace("{{user}}",r??tn),a=u.createShader(u.VERTEX_SHADER),l=u.createShader(u.FRAGMENT_SHADER);u.shaderSource(a,i),u.shaderSource(l,s),u.compileShader(a),u.compileShader(l);let h=u.createProgram();if(me.push(()=>u.deleteProgram(h)),u.attachShader(h,a),u.attachShader(h,l),u.bindAttribLocation(h,0,"a_pos"),u.bindAttribLocation(h,1,"a_uv"),u.bindAttribLocation(h,2,"a_color"),u.linkProgram(h),!u.getProgramParameter(h,u.LINK_STATUS)){let g=o(C=>{let z=/^ERROR:\s0:(?<line>\d+):\s(?<msg>.+)/,q=C.match(z);return{line:Number(q.groups.line),msg:q.groups.msg.replace(/\n\0$/,"")}},"formatShaderError"),p=u.getShaderInfoLog(a),m=u.getShaderInfoLog(l),E="";if(p){let C=g(p);E+=`Vertex shader line ${C.line-14}: ${C.msg}`}if(m){let C=g(m);E+=`Fragment shader line ${C.line-14}: ${C.msg}`}throw new Error(E)}return u.deleteShader(a),u.deleteShader(l),{bind(){u.useProgram(h)},unbind(){u.useProgram(null)},free(){u.deleteProgram(h)},send(g){for(let p in g){let m=g[p],E=u.getUniformLocation(h,p);typeof m=="number"?u.uniform1f(E,m):m instanceof ue?u.uniformMatrix4fv(E,!1,new Float32Array(m.m)):m instanceof O?u.uniform3f(E,m.r,m.g,m.b):m instanceof y&&u.uniform2f(E,m.x,m.y)}}}}o(_e,"makeShader");function de(t,r,i,s){let a=t.width/r,l={},h=s.split("").entries();for(let[g,p]of h)l[p]=new he(g%a*r,Math.floor(g/a)*i,r,i);return{tex:t,map:l,size:i}}o(de,"makeFont");function Ce(t,r,i,s=w.defTex,a=w.defShader,l={}){let h=ft(a);if(!h||h instanceof ee)return;(s!==w.curTex||h!==w.curShader||!fn(w.curUniform,l)||w.vqueue.length+t.length*yr>Yi||w.iqueue.length+r.length>Ki)&&ce();let g=i?w.transform:M.cam.transform.mult(w.transform);for(let p of t){let m=Kt(g.multVec2(p.pos));w.vqueue.push(m.x,m.y,p.uv.x,p.uv.y,p.color.r/255,p.color.g/255,p.color.b/255,p.opacity)}for(let p of r)w.iqueue.push(p+w.vqueue.length/yr-t.length);w.curTex=s,w.curShader=h,w.curUniform=l}o(Ce,"drawRaw");function ce(){!w.curTex||!w.curShader||w.vqueue.length===0||w.iqueue.length===0||(u.bindBuffer(u.ARRAY_BUFFER,w.vbuf),u.bufferSubData(u.ARRAY_BUFFER,0,new Float32Array(w.vqueue)),u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,w.ibuf),u.bufferSubData(u.ELEMENT_ARRAY_BUFFER,0,new Uint16Array(w.iqueue)),w.curShader.bind(),w.curShader.send(w.curUniform),w.curTex.bind(),u.drawElements(u.TRIANGLES,w.iqueue.length,u.UNSIGNED_SHORT,0),w.curTex.unbind(),w.curShader.unbind(),u.bindBuffer(u.ARRAY_BUFFER,null),u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,null),w.vqueue.length=0,w.iqueue.length=0,w.drawCalls++)}o(ce,"flush");function mt(){u.clear(u.COLOR_BUFFER_BIT),w.frameBuffer.bind(),u.viewport(0,0,w.frameBuffer.width,w.frameBuffer.height),u.clear(u.COLOR_BUFFER_BIT),w.bgColor||Ue(()=>{be({width:Ae(),height:ve(),quad:new he(0,0,Ae()/Di,ve()/Di),tex:w.bgTex,fixed:!0})}),w.drawCalls=0,w.transformStack.length=0,w.transform=new ue}o(mt,"frameStart");function or(t,r){w.postShader=t,w.postShaderUniform=r??null}o(or,"usePostEffect");function wt(){ce(),w.frameBuffer.unbind(),u.viewport(0,0,u.drawingBufferWidth,u.drawingBufferHeight),ce();let t=w.width,r=w.height;w.width=u.drawingBufferWidth/k,w.height=u.drawingBufferHeight/k,Ht({flipY:!0,tex:w.frameBuffer.tex,pos:new y(w.viewport.x,w.viewport.y),width:w.viewport.width,height:w.viewport.height,shader:w.postShader,uniform:typeof w.postShaderUniform=="function"?w.postShaderUniform():w.postShaderUniform,fixed:!0}),ce(),w.width=t,w.height=r,w.lastDrawCalls=w.drawCalls}o(wt,"frameEnd");function Kt(t){return new y(t.x/Ae()*2-1,-t.y/ve()*2+1)}o(Kt,"screen2ndc");function f(t){w.transform=t.clone()}o(f,"pushMatrix");function A(...t){if(t[0]===void 0)return;let r=S(...t);r.x===0&&r.y===0||w.transform.translate(r)}o(A,"pushTranslate");function b(...t){if(t[0]===void 0)return;let r=S(...t);r.x===1&&r.y===1||w.transform.scale(r)}o(b,"pushScale");function K(t){t&&w.transform.rotate(t)}o(K,"pushRotate");function G(){w.transformStack.push(w.transform.clone())}o(G,"pushTransform");function ae(){w.transformStack.length>0&&(w.transform=w.transformStack.pop())}o(ae,"popTransform");function be(t){if(t.width===void 0||t.height===void 0)throw new Error('drawUVQuad() requires property "width" and "height".');if(t.width<=0||t.height<=0)return;let r=t.width,i=t.height,s=rt(t.anchor||Ar).scale(new y(r,i).scale(-.5)),a=t.quad||new he(0,0,1,1),l=t.color||_(255,255,255),h=t.opacity??1,g=t.tex?Gi/t.tex.width:0,p=t.tex?Gi/t.tex.height:0,m=a.x+g,E=a.y+p,C=a.w-g*2,z=a.h-p*2;G(),A(t.pos),K(t.angle),b(t.scale),A(s),Ce([{pos:new y(-r/2,i/2),uv:new y(t.flipX?m+C:m,t.flipY?E:E+z),color:l,opacity:h},{pos:new y(-r/2,-i/2),uv:new y(t.flipX?m+C:m,t.flipY?E+z:E),color:l,opacity:h},{pos:new y(r/2,-i/2),uv:new y(t.flipX?m:m+C,t.flipY?E+z:E),color:l,opacity:h},{pos:new y(r/2,i/2),uv:new y(t.flipX?m:m+C,t.flipY?E:E+z),color:l,opacity:h}],[0,1,3,1,2,3],t.fixed,t.tex,t.shader,t.uniform),ae()}o(be,"drawUVQuad");function Ht(t){if(!t.tex)throw new Error('drawTexture() requires property "tex".');let r=t.quad??new he(0,0,1,1),i=t.tex.width*r.w,s=t.tex.height*r.h,a=new y(1);if(t.tiled){let l=Math.ceil((t.width||i)/i),h=Math.ceil((t.height||s)/s),g=rt(t.anchor||Ar).add(new y(1,1)).scale(.5).scale(l*i,h*s);for(let p=0;p<l;p++)for(let m=0;m<h;m++)be(Object.assign({},t,{pos:(t.pos||new y(0)).add(new y(i*p,s*m)).sub(g),scale:a.scale(t.scale||new y(1)),tex:t.tex,quad:r,width:i,height:s,anchor:"topleft"}))}else t.width&&t.height?(a.x=t.width/i,a.y=t.height/s):t.width?(a.x=t.width/i,a.y=a.x):t.height&&(a.y=t.height/s,a.x=a.y),be(Object.assign({},t,{scale:a.scale(t.scale||new y(1)),tex:t.tex,quad:r,width:i,height:s}))}o(Ht,"drawTexture");function gn(t){if(!t.sprite)throw new Error('drawSprite() requires property "sprite"');let r=Ze(t.sprite);if(!r||!r.data)return;let i=r.data.frames[t.frame??0];if(!i)throw new Error(`Frame not found: ${t.frame??0}`);Ht(Object.assign({},t,{tex:r.data.tex,quad:i.scale(t.quad??new he(0,0,1,1))}))}o(gn,"drawSprite");function At(t,r,i,s,a,l=1){s=De(s%360),a=De(a%360),a<=s&&(a+=Math.PI*2);let h=[],g=Math.ceil((a-s)/De(8)*l),p=(a-s)/g;for(let m=s;m<a;m+=p)h.push(t.add(r*Math.cos(m),i*Math.sin(m)));return h.push(t.add(r*Math.cos(a),i*Math.sin(a))),h}o(At,"getArcPts");function Se(t){if(t.width===void 0||t.height===void 0)throw new Error('drawRect() requires property "width" and "height".');if(t.width<=0||t.height<=0)return;let r=t.width,i=t.height,s=rt(t.anchor||Ar).add(1,1).scale(new y(r,i).scale(-.5)),a=[new y(0,0),new y(r,0),new y(r,i),new y(0,i)];if(t.radius){let l=Math.min(Math.min(r,i)/2,t.radius);a=[new y(l,0),new y(r-l,0),...At(new y(r-l,l),l,l,270,360),new y(r,l),new y(r,i-l),...At(new y(r-l,i-l),l,l,0,90),new y(r-l,i),new y(l,i),...At(new y(l,i-l),l,l,90,180),new y(0,i-l),new y(0,l),...At(new y(l,l),l,l,180,270)]}Ke(Object.assign({},t,{offset:s,pts:a,...t.gradient?{colors:t.horizontal?[t.gradient[0],t.gradient[1],t.gradient[1],t.gradient[0]]:[t.gradient[0],t.gradient[0],t.gradient[1],t.gradient[1]]}:{}}))}o(Se,"drawRect");function Vt(t){let{p1:r,p2:i}=t;if(!r||!i)throw new Error('drawLine() requires properties "p1" and "p2".');let s=t.width||1,a=i.sub(r).unit().normal().scale(s*.5),l=[r.sub(a),r.add(a),i.add(a),i.sub(a)].map(h=>({pos:new y(h.x,h.y),uv:new y(0),color:t.color??O.WHITE,opacity:t.opacity??1}));Ce(l,[0,1,3,1,2,3],t.fixed,w.defTex,t.shader,t.uniform)}o(Vt,"drawLine");function Br(t){let r=t.pts;if(!r)throw new Error('drawLines() requires property "pts".');if(!(r.length<2))if(t.radius&&r.length>=3){let i=r[0].sdist(r[1]);for(let a=1;a<r.length-1;a++)i=Math.min(r[a].sdist(r[a+1]),i);let s=Math.min(t.radius,Math.sqrt(i)/2);Vt(Object.assign({},t,{p1:r[0],p2:r[1]}));for(let a=1;a<r.length-2;a++){let l=r[a],h=r[a+1];Vt(Object.assign({},t,{p1:l,p2:h}))}Vt(Object.assign({},t,{p1:r[r.length-2],p2:r[r.length-1]}))}else for(let i=0;i<r.length-1;i++)Vt(Object.assign({},t,{p1:r[i],p2:r[i+1]})),t.join!=="none"&&$e(Object.assign({},t,{pos:r[i],radius:t.width/2}))}o(Br,"drawLines");function Fr(t){if(!t.p1||!t.p2||!t.p3)throw new Error('drawPolygon() requires properties "p1", "p2" and "p3".');return Ke(Object.assign({},t,{pts:[t.p1,t.p2,t.p3]}))}o(Fr,"drawTriangle");function $e(t){if(typeof t.radius!="number")throw new Error('drawCircle() requires property "radius".');t.radius!==0&&Pr(Object.assign({},t,{radiusX:t.radius,radiusY:t.radius,angle:0}))}o($e,"drawCircle");function Pr(t){if(t.radiusX===void 0||t.radiusY===void 0)throw new Error('drawEllipse() requires properties "radiusX" and "radiusY".');if(t.radiusX===0||t.radiusY===0)return;let r=t.start??0,i=t.end??360,s=rt(t.anchor??"center").scale(new y(-t.radiusX,-t.radiusY)),a=At(s,t.radiusX,t.radiusY,r,i,t.resolution);a.unshift(s);let l=Object.assign({},t,{pts:a,radius:0,...t.gradient?{colors:[t.gradient[0],...Array(a.length-1).fill(t.gradient[1])]}:{}});if(i-r>=360&&t.outline){t.fill!==!1&&Ke(Object.assign(l,{outline:null})),Ke(Object.assign(l,{pts:a.slice(1),fill:!1}));return}Ke(l)}o(Pr,"drawEllipse");function Ke(t){if(!t.pts)throw new Error('drawPolygon() requires property "pts".');let r=t.pts.length;if(!(r<3)){if(G(),A(t.pos),b(t.scale),K(t.angle),A(t.offset),t.fill!==!1){let i=t.color??O.WHITE,s=t.pts.map((l,h)=>({pos:new y(l.x,l.y),uv:new y(0,0),color:t.colors?t.colors[h]??i:i,opacity:t.opacity??1})),a=[...Array(r-2).keys()].map(l=>[0,l+1,l+2]).flat();Ce(s,t.indices??a,t.fixed,w.defTex,t.shader,t.uniform)}t.outline&&Br({pts:[...t.pts,t.pts[0]],radius:t.radius,width:t.outline.width,color:t.outline.color,join:t.outline.join,uniform:t.uniform,fixed:t.fixed,opacity:t.opacity}),ae()}}o(Ke,"drawPolygon");function Cr(t,r,i){ce(),u.clear(u.STENCIL_BUFFER_BIT),u.enable(u.STENCIL_TEST),u.stencilFunc(u.NEVER,1,255),u.stencilOp(u.REPLACE,u.REPLACE,u.REPLACE),r(),ce(),u.stencilFunc(i,1,255),u.stencilOp(u.KEEP,u.KEEP,u.KEEP),t(),ce(),u.disable(u.STENCIL_TEST)}o(Cr,"drawStenciled");function mn(t,r){Cr(t,r,u.EQUAL)}o(mn,"drawMasked");function wn(t,r){Cr(t,r,u.NOTEQUAL)}o(wn,"drawSubtracted");function Dr(){return(w.viewport.width+w.viewport.height)/(w.width+w.height)}o(Dr,"getViewportScale");function Ue(t){ce();let r=w.width,i=w.height;w.width=w.viewport.width,w.height=w.viewport.height,t(),ce(),w.width=r,w.height=i}o(Ue,"drawUnscaled");function Ir(t,r){r.pos&&(t.pos=t.pos.add(r.pos)),r.scale&&(t.scale=t.scale.scale(S(r.scale))),r.angle&&(t.angle+=r.angle),r.color&&(t.color=t.color.mult(r.color)),r.opacity&&(t.opacity*=r.opacity)}o(Ir,"applyCharTransform");let An=/\[(?<style>\w+)\](?<text>.*?)\[\/\k<style>\]/g;function Vn(t){let r={},i=t.replace(An,"$2"),s=0;for(let a of t.matchAll(An)){let l=a.index-s;for(let h=0;h<a.groups.text.length;h++)r[h+l]=[a.groups.style];s+=a[0].length-a.groups.text.length}return{charStyleMap:r,text:i}}o(Vn,"compileStyledText");let kr={};function He(t){if(t.text===void 0)throw new Error('formatText() requires property "text".');let r=pt(t.font);if(t.text===""||r instanceof ee||!r)return{width:0,height:0,chars:[],opt:t};let{charStyleMap:i,text:s}=Vn(t.text+""),a=s.split("");if(r instanceof Xe||typeof r=="string"){let L=r instanceof Xe?r.fontface.family:r,W=r instanceof Xe?{outline:r.outline,filter:r.filter}:{outline:0,filter:qi},D=kr[L]??{font:{tex:new X(Ui,Ni,{filter:W.filter}),map:{},size:Ii},cursor:new y(0),outline:W.outline};kr[L]||(kr[L]=D),r=D.font;for(let Me of a)if(!D.font.map[Me]){let V=$;V.clearRect(0,0,j.width,j.height),V.font=`${r.size}px ${L}`,V.textBaseline="top",V.textAlign="left",V.fillStyle="#ffffff";let B=V.measureText(Me),T=Math.ceil(B.width),P=r.size;D.outline&&(V.lineJoin="round",V.lineWidth=D.outline*2,V.strokeStyle="#000000",V.strokeText(Me,D.outline,D.outline),T+=D.outline*2,P+=D.outline*3),V.fillText(Me,D.outline,D.outline);let H=V.getImageData(0,0,T,P);if(D.cursor.x+T>Ui&&(D.cursor.x=0,D.cursor.y+=P,D.cursor.y>Ni))throw new Error("Font atlas exceeds character limit");r.tex.update(H,D.cursor.x,D.cursor.y),r.map[Me]=new he(D.cursor.x,D.cursor.y,T,P),D.cursor.x+=T}}let l=t.size||r.size,h=S(t.scale??1).scale(l/r.size),g=t.lineSpacing??0,p=t.letterSpacing??0,m=0,E=0,C=0,z=[],q=[],Z=0,F=null,N=null;for(;Z<a.length;){let L=a[Z];if(L===`
`)C+=l+g,z.push({width:m-p,chars:q}),F=null,N=null,m=0,q=[];else{let W=r.map[L];if(W){let D=W.w*h.x;t.width&&m+D>t.width&&(C+=l+g,F!=null&&(Z-=q.length-F,L=a[Z],W=r.map[L],D=W.w*h.x,q=q.slice(0,F-1),m=N),F=null,N=null,z.push({width:m-p,chars:q}),m=0,q=[]),q.push({tex:r.tex,width:W.w,height:W.h,quad:new he(W.x/r.tex.width,W.y/r.tex.height,W.w/r.tex.width,W.h/r.tex.height),ch:L,pos:new y(m,C),opacity:t.opacity??1,color:t.color??O.WHITE,scale:S(h),angle:0}),L===" "&&(F=q.length,N=m),m+=D,E=Math.max(E,m),m+=p}}Z++}z.push({width:m-p,chars:q}),C+=l,t.width&&(E=t.width);let ye=[];for(let L of z){let W=(E-L.width)*us(t.align??"left");for(let D of L.chars){let Me=r.map[D.ch],V=ye.length;if(D.pos=D.pos.add(W,0).add(Me.w*h.x*.5,Me.h*h.y*.5),t.transform){let B=typeof t.transform=="function"?t.transform(V,D.ch):t.transform;B&&Ir(D,B)}if(i[V]){let B=i[V];for(let T of B){let P=t.styles[T],H=typeof P=="function"?P(V,D.ch):P;H&&Ir(D,H)}}ye.push(D)}}return{width:E,height:C,chars:ye,opt:t}}o(He,"formatText");function Ur(t){je(He(t))}o(Ur,"drawText");function je(t){G(),A(t.opt.pos),K(t.opt.angle),A(rt(t.opt.anchor??"topleft").add(1,1).scale(t.width,t.height).scale(-.5)),t.chars.forEach(r=>{be({tex:r.tex,width:r.width,height:r.height,pos:r.pos,scale:r.scale,angle:r.angle,color:r.color,opacity:r.opacity,quad:r.quad,anchor:"center",uniform:t.opt.uniform,shader:t.opt.shader,fixed:t.opt.fixed})}),ae()}o(je,"drawFormattedText");function Ae(){return w.width}o(Ae,"width");function ve(){return w.height}o(ve,"height");let vt={};function vn(t){return new y((t.x-w.viewport.x)*Ae()/w.viewport.width,(t.y-w.viewport.y)*ve()/w.viewport.height)}o(vn,"windowToContent");function yn(t){return new y(t.x*w.viewport.width/w.width,t.y*w.viewport.height/w.height)}o(yn,"contentToView");function jt(){return vn(x.mousePos())}o(jt,"mousePos"),vt.error=t=>{if(t.error)pr(t.error);else{if(t.message==="Script error.")return;pr(new Error(t.message))}},vt.unhandledrejection=t=>pr(t.reason);for(let t in vt)window.addEventListener(t,vt[t]);let re={inspect:!1,timeScale:1,showLog:!0,fps:()=>x.fps(),numFrames:()=>x.numFrames(),stepFrame:Jr,drawCalls:()=>w.drawCalls,clearLog:()=>M.logs=[],log:t=>{let r=e.logMax??$s,i=t instanceof Error?"error":"info";M.logs.unshift(`${`[time]${x.time().toFixed(2)}[/time] `}[${i}]${t?.toString?t.toString():t}[/${i}]`),M.logs.length>r&&(M.logs=M.logs.slice(0,r))},error:t=>re.log(new Error(t.toString?t.toString():t)),curRecording:null,get paused(){return x.paused},set paused(t){x.paused=t,t?oe.ctx.suspend():oe.ctx.resume()}};function Re(){return x.dt()}o(Re,"dt");function En(...t){return t.length>0&&(M.cam.pos=S(...t)),M.cam.pos?M.cam.pos.clone():Wt()}o(En,"camPos");function xn(...t){return t.length>0&&(M.cam.scale=S(...t)),M.cam.scale.clone()}o(xn,"camScale");function bn(t){return t!==void 0&&(M.cam.angle=t),M.cam.angle}o(bn,"camRot");function Sn(t=12){M.cam.shake+=t}o(Sn,"shake");function ar(t){return M.cam.transform.multVec2(t)}o(ar,"toScreen");function Nr(t){return M.cam.transform.invert().multVec2(t)}o(Nr,"toWorld");function zt(t){let r=new ue;return t.pos&&r.translate(t.pos),t.scale&&r.scale(t.scale),t.angle&&r.rotate(t.angle),t.parent?r.mult(t.parent.transform):r}o(zt,"calcTransform");function hr(t){let r=new Map,i={},s=new bt,a=null,l={id:Ks(),hidden:!1,paused:!1,transform:new ue,children:[],parent:null,add(h){let g=(()=>{if(Array.isArray(h))return hr(h);if(h.parent)throw new Error("Cannot add a game obj that already has a parent.");return h})();return g.parent=this,g.transform=zt(g),this.children.push(g),g.trigger("add",g),M.events.trigger("add",g),g},readd(h){let g=this.children.indexOf(h);return g!==-1&&(this.children.splice(g,1),this.children.push(h)),h},remove(h){let g=this.children.indexOf(h);if(g!==-1){h.parent=null,this.children.splice(g,1);let p=o(m=>{m.trigger("destroy"),M.events.trigger("destroy",m),m.children.forEach(E=>p(E))},"trigger");p(h)}},removeAll(h){if(h)this.get(h).forEach(g=>this.remove(g));else for(let g of[...this.children])this.remove(g)},update(){this.paused||(this.children.sort((h,g)=>(h.z??0)-(g.z??0)).forEach(h=>h.update()),this.trigger("update"))},draw(){this.hidden||(G(),A(this.pos),b(this.scale),K(this.angle),this.trigger("draw"),this.children.sort((h,g)=>(h.z??0)-(g.z??0)).forEach(h=>h.draw()),ae())},drawInspect(){this.hidden||(G(),A(this.pos),b(this.scale),K(this.angle),this.children.sort((h,g)=>(h.z??0)-(g.z??0)).forEach(h=>h.drawInspect()),this.trigger("drawInspect"),ae())},use(h){if(!h)return;if(typeof h=="string")return this.use({id:h});let g=[];h.id&&(this.unuse(h.id),i[h.id]=[],g=i[h.id],r.set(h.id,h));for(let m in h){if(ro.has(m))continue;let E=Object.getOwnPropertyDescriptor(h,m);if(typeof E.value=="function"&&(h[m]=h[m].bind(this)),E.set&&Object.defineProperty(h,m,{set:E.set.bind(this)}),E.get&&Object.defineProperty(h,m,{get:E.get.bind(this)}),no.has(m)){let C=m==="add"?()=>{a=o(z=>g.push(z),"onCurCompCleanup"),h[m](),a=null}:h[m];g.push(this.on(m,C).cancel)}else if(this[m]===void 0)Object.defineProperty(this,m,{get:()=>h[m],set:C=>h[m]=C,configurable:!0,enumerable:!0}),g.push(()=>delete this[m]);else throw new Error(`Duplicate component property: "${m}"`)}let p=o(()=>{if(h.require){for(let m of h.require)if(!this.c(m))throw new Error(`Component "${h.id}" requires component "${m}"`)}},"checkDeps");h.destroy&&g.push(h.destroy.bind(this)),this.exists()?(p(),h.add&&(a=o(m=>g.push(m),"onCurCompCleanup"),h.add.call(this),a=null)):h.require&&g.push(this.on("add",p).cancel)},unuse(h){i[h]&&(i[h].forEach(g=>g()),delete i[h]),r.has(h)&&r.delete(h)},c(h){return r.get(h)},get(h,g={}){let p=g.recursive?this.children.flatMap(o(function m(E){return[E,...E.children.flatMap(m)]},"recurse")):this.children;if(p=p.filter(m=>h?m.is(h):!0),g.liveUpdate){let m=o(E=>g.recursive?this.isAncestorOf(E):E.parent===this,"isChild");lr(E=>{m(E)&&E.is(h)&&p.push(E)}),Or(E=>{if(m(E)&&E.is(h)){let C=p.findIndex(z=>z.id===E.id);C!==-1&&p.splice(C,1)}})}return p},isAncestorOf(h){return h.parent?h.parent===this||this.isAncestorOf(h.parent):!1},exists(){return M.root.isAncestorOf(this)},is(h){if(h==="*")return!0;if(Array.isArray(h)){for(let g of h)if(!this.c(g))return!1;return!0}else return this.c(h)!=null},on(h,g){let p=s.on(h,g.bind(this));return a&&a(()=>p.cancel()),p},trigger(h,...g){s.trigger(h,...g),M.objEvents.trigger(h,this,...g)},destroy(){this.parent&&this.parent.remove(this)},inspect(){let h={};for(let[g,p]of r)h[g]=p.inspect?p.inspect():null;return h},onAdd(h){return this.on("add",h)},onUpdate(h){return this.on("update",h)},onDraw(h){return this.on("draw",h)},onDestroy(h){return this.on("destroy",h)},clearEvents(){s.clear()}};for(let h of t)l.use(h);return l}o(hr,"make");function Ne(t,r,i){return M.objEvents[t]||(M.objEvents[t]=new cn),M.objEvents.on(t,(s,...a)=>{s.is(r)&&i(s,...a)})}o(Ne,"on");let Lr=o((t,r)=>{if(typeof t=="function"&&r===void 0){let i=_t([{update:t}]);return{get paused(){return i.paused},set paused(s){i.paused=s},cancel:()=>i.destroy()}}else if(typeof t=="string")return Ne("update",t,r)},"onUpdate"),As=o((t,r)=>{if(typeof t=="function"&&r===void 0){let i=_t([{draw:t}]);return{get paused(){return i.hidden},set paused(s){i.hidden=s},cancel:()=>i.destroy()}}else if(typeof t=="string")return Ne("draw",t,r)},"onDraw");function lr(t,r){if(typeof t=="function"&&r===void 0)return M.events.on("add",t);if(typeof t=="string")return Ne("add",t,r)}o(lr,"onAdd");function Or(t,r){if(typeof t=="function"&&r===void 0)return M.events.on("destroy",t);if(typeof t=="string")return Ne("destroy",t,r)}o(Or,"onDestroy");function Rn(t,r,i){return Ne("collide",t,(s,a,l)=>a.is(r)&&i(s,a,l))}o(Rn,"onCollide");function Mn(t,r,i){return Ne("collideUpdate",t,(s,a,l)=>a.is(r)&&i(s,a,l))}o(Mn,"onCollideUpdate");function Tn(t,r,i){return Ne("collideEnd",t,(s,a,l)=>a.is(r)&&i(s,a,l))}o(Tn,"onCollideEnd");function Qt(t,r){pi(t,{recursive:!0}).forEach(r),lr(t,r)}o(Qt,"forAllCurrentAndFuture");function Bn(t,r){if(typeof t=="function")return x.onMousePress(t);{let i=[];return Qt(t,s=>{if(!s.area)throw new Error("onClick() requires the object to have area() component");i.push(s.onClick(()=>r(s)))}),ze.join(i)}}o(Bn,"onClick");function Fn(t,r){let i=[];return Qt(t,s=>{if(!s.area)throw new Error("onHover() requires the object to have area() component");i.push(s.onHover(()=>r(s)))}),ze.join(i)}o(Fn,"onHover");function Pn(t,r){let i=[];return Qt(t,s=>{if(!s.area)throw new Error("onHoverUpdate() requires the object to have area() component");i.push(s.onHoverUpdate(()=>r(s)))}),ze.join(i)}o(Pn,"onHoverUpdate");function Cn(t,r){let i=[];return Qt(t,s=>{if(!s.area)throw new Error("onHoverEnd() requires the object to have area() component");i.push(s.onHoverEnd(()=>r(s)))}),ze.join(i)}o(Cn,"onHoverEnd");function Jt(t,r){let i=0,s=[];r&&s.push(r);let a=Lr(()=>{i+=Re(),i>=t&&(a.cancel(),s.forEach(l=>l()))});return{paused:a.paused,cancel:a.cancel,onEnd(l){s.push(l)},then(l){return this.onEnd(l),this}}}o(Jt,"wait");function Dn(t,r){let i=null,s=o(()=>{i=Jt(t,s),r()},"newAction");return i=Jt(0,s),{get paused(){return i.paused},set paused(a){i.paused=a},cancel:()=>i.cancel()}}o(Dn,"loop");function Gr(){x.onKeyPress("f1",()=>{re.inspect=!re.inspect}),x.onKeyPress("f2",()=>{re.clearLog()}),x.onKeyPress("f8",()=>{re.paused=!re.paused}),x.onKeyPress("f7",()=>{re.timeScale=yt(Qe(re.timeScale-.2,0,2),1)}),x.onKeyPress("f9",()=>{re.timeScale=yt(Qe(re.timeScale+.2,0,2),1)}),x.onKeyPress("f10",()=>{re.stepFrame()})}o(Gr,"enterDebugMode");function qr(){x.onKeyPress("b",()=>gt())}o(qr,"enterBurpMode");function In(t){M.gravity=t}o(In,"setGravity");function kn(){return M.gravity}o(kn,"getGravity");function Un(...t){t.length===1||t.length===2?(w.bgColor=_(t[0]),t[1]&&(w.bgAlpha=t[1])):(t.length===3||t.length===4)&&(w.bgColor=_(t[0],t[1],t[2]),t[3]&&(w.bgAlpha=t[3])),u.clearColor(w.bgColor.r/255,w.bgColor.g/255,w.bgColor.b/255,w.bgAlpha)}o(Un,"setBackground");function Nn(){return w.bgColor.clone()}o(Nn,"getBackground");function Xt(...t){return{id:"pos",pos:S(...t),moveBy(...r){this.pos=this.pos.add(S(...r))},move(...r){this.moveBy(S(...r).scale(Re()))},moveTo(...r){if(typeof r[0]=="number"&&typeof r[1]=="number")return this.moveTo(S(r[0],r[1]),r[2]);let i=r[0],s=r[1];if(s===void 0){this.pos=S(i);return}let a=i.sub(this.pos);if(a.len()<=s*Re()){this.pos=S(i);return}this.move(a.unit().scale(s))},worldPos(){return this.parent?this.parent.transform.multVec2(this.pos):this.pos},screenPos(){return this.fixed?this.pos:ar(this.pos)},inspect(){return`(${Math.round(this.pos.x)}, ${Math.round(this.pos.y)})`},drawInspect(){$e({color:_(255,0,0),radius:4/Dr()})}}}o(Xt,"pos");function Zt(...t){return t.length===0?Zt(1):{id:"scale",scale:S(...t),scaleTo(...r){this.scale=S(...r)},scaleBy(...r){this.scale.scale(S(...r))},inspect(){return`(${yt(this.scale.x,2)}, ${yt(this.scale.y,2)})`}}}o(Zt,"scale");function Ln(t){return{id:"rotate",angle:t??0,rotateBy(r){this.angle+=r},rotateTo(r){this.angle=r},inspect(){return`${Math.round(this.angle)}`}}}o(Ln,"rotate");function On(...t){return{id:"color",color:_(...t),inspect(){return this.color.toString()}}}o(On,"color");function yt(t,r){return Number(t.toFixed(r))}o(yt,"toFixed");function Gn(t){return{id:"opacity",opacity:t??1,inspect(){return`${yt(this.opacity,1)}`},fadeOut(r=1,i=er.linear){return gr(this.opacity,0,r,s=>this.opacity=s,i)}}}o(Gn,"opacity");function ur(t){if(!t)throw new Error("Please define an anchor");return{id:"anchor",anchor:t,inspect(){return typeof this.anchor=="string"?this.anchor:this.anchor.toString()}}}o(ur,"anchor");function qn(t){return{id:"z",z:t,inspect(){return`${this.z}`}}}o(qn,"z");function Yn(t,r){return{id:"follow",require:["pos"],follow:{obj:t,offset:r??S(0)},add(){t.exists()&&(this.pos=this.follow.obj.pos.add(this.follow.offset))},update(){t.exists()&&(this.pos=this.follow.obj.pos.add(this.follow.offset))}}}o(Yn,"follow");function Kn(t,r){let i=typeof t=="number"?y.fromAngle(t):t.unit();return{id:"move",require:["pos"],update(){this.move(i.scale(r))}}}o(Kn,"move");let Vs=200;function Hn(t={}){let r=t.distance??Vs,i=!1;return{id:"offscreen",require:["pos"],isOffScreen(){let s=ar(this.pos),a=new fe(S(0),Ae(),ve());return!nr(a,s)&&a.sdistToPoint(s)>r*r},onExitScreen(s){return this.on("exitView",s)},onEnterScreen(s){return this.on("enterView",s)},update(){this.isOffScreen()?(i||(this.trigger("exitView"),i=!0),t.hide&&(this.hidden=!0),t.pause&&(this.paused=!0),t.destroy&&this.destroy()):(i&&(this.trigger("enterView"),i=!1),t.hide&&(this.hidden=!1),t.pause&&(this.paused=!1))}}}o(Hn,"offscreen");function jn(t={}){let r={},i=new Set;return{id:"area",collisionIgnore:t.collisionIgnore??[],add(){this.area.cursor&&this.onHover(()=>x.setCursor(this.area.cursor)),this.onCollideUpdate((s,a)=>{r[s.id]||this.trigger("collide",s,a),r[s.id]=a,i.add(s.id)})},update(){for(let s in r)i.has(Number(s))||(this.trigger("collideEnd",r[s].target),delete r[s]);i.clear()},drawInspect(){let s=this.localArea();G(),b(this.area.scale),A(this.area.offset);let a={outline:{width:4/Dr(),color:_(0,0,255)},anchor:this.anchor,fill:!1,fixed:this.fixed};s instanceof fe?Se({...a,pos:s.pos,width:s.width,height:s.height}):s instanceof nt?Ke({...a,pts:s.pts}):s instanceof xr&&$e({...a,pos:s.center,radius:s.radius}),ae()},area:{shape:t.shape??null,scale:t.scale?S(t.scale):S(1),offset:t.offset??S(0),cursor:t.cursor??null},isClicked(){return x.isMousePressed()&&this.isHovering()},isHovering(){let s=this.fixed?jt():Nr(jt());return this.hasPoint(s)},checkCollision(s){return r[s.id]??null},getCollisions(){return Object.values(r)},isColliding(s){return!!r[s.id]},isOverlapping(s){let a=r[s.id];return a&&a.hasOverlap()},onClick(s){let a=x.onMousePress("left",()=>{this.isHovering()&&s()});return this.onDestroy(()=>a.cancel()),a},onHover(s){let a=!1;return this.onUpdate(()=>{a?a=this.isHovering():this.isHovering()&&(a=!0,s())})},onHoverUpdate(s){return this.onUpdate(()=>{this.isHovering()&&s()})},onHoverEnd(s){let a=!1;return this.onUpdate(()=>{a?this.isHovering()||(a=!1,s()):a=this.isHovering()})},onCollide(s,a){if(typeof s=="function"&&a===void 0)return this.on("collide",s);if(typeof s=="string")return this.onCollide((l,h)=>{l.is(s)&&a(l,h)})},onCollideUpdate(s,a){if(typeof s=="function"&&a===void 0)return this.on("collideUpdate",s);if(typeof s=="string")return this.on("collideUpdate",(l,h)=>l.is(s)&&a(l,h))},onCollideEnd(s,a){if(typeof s=="function"&&a===void 0)return this.on("collideEnd",s);if(typeof s=="string")return this.on("collideEnd",l=>l.is(s)&&a(l))},hasPoint(s){return dn(this.worldArea(),s)},resolveCollision(s){let a=this.checkCollision(s);a&&!a.resolved&&(this.pos=this.pos.add(a.displacement),a.resolved=!0)},localArea(){return this.area.shape?this.area.shape:this.renderArea()},worldArea(){let s=this.localArea();if(!(s instanceof nt||s instanceof fe))throw new Error("Only support polygon and rect shapes for now");let a=this.transform.clone().scale(S(this.area.scale??1)).translate(this.area.offset);if(s instanceof fe){let l=rt(this.anchor||Ar).add(1,1).scale(-.5).scale(s.width,s.height);a.translate(l)}return s.transform(a)},screenArea(){let s=this.worldArea();return this.fixed?s:s.transform(M.cam.transform)}}}o(jn,"area");function et(t){return{color:t.color,opacity:t.opacity,anchor:t.anchor,outline:t.outline,fixed:t.fixed,shader:t.shader,uniform:t.uniform}}o(et,"getRenderProps");function dr(t,r={}){let i=null,s=null,a=new Te;if(!t)throw new Error("Please pass the resource name or data to sprite()");let l=o((h,g,p,m)=>{let E=S(1,1);return p&&m?(E.x=p/(h.width*g.w),E.y=m/(h.height*g.h)):p?(E.x=p/(h.width*g.w),E.y=E.x):m&&(E.y=m/(h.height*g.h),E.x=E.y),E},"calcTexScale");return{id:"sprite",width:0,height:0,frame:r.frame||0,quad:r.quad||new he(0,0,1,1),animSpeed:r.animSpeed??1,flipX:r.flipX??!1,flipY:r.flipY??!1,draw(){if(!i)return;let h=i.frames[this.frame??0];if(!h)throw new Error(`Frame not found: ${this.frame??0}`);if(i.slice9){let{left:g,right:p,top:m,bottom:E}=i.slice9,C=i.tex.width*h.w,z=i.tex.height*h.h,q=this.width-g-p,Z=this.height-m-E,F=g/C,N=p/C,ye=1-F-N,L=m/z,W=E/z,D=1-L-W,Me=[se(0,0,F,L),se(F,0,ye,L),se(F+ye,0,N,L),se(0,L,F,D),se(F,L,ye,D),se(F+ye,L,N,D),se(0,L+D,F,W),se(F,L+D,ye,W),se(F+ye,L+D,N,W),se(0,0,g,m),se(g,0,q,m),se(g+q,0,p,m),se(0,m,g,Z),se(g,m,q,Z),se(g+q,m,p,Z),se(0,m+Z,g,E),se(g,m+Z,q,E),se(g+q,m+Z,p,E)];for(let V=0;V<9;V++){let B=Me[V],T=Me[V+9];Ht(Object.assign(et(this),{pos:T.pos(),tex:i.tex,quad:h.scale(B),flipX:this.flipX,flipY:this.flipY,tiled:r.tiled,width:T.w,height:T.h}))}}else Ht(Object.assign(et(this),{tex:i.tex,quad:h,flipX:this.flipX,flipY:this.flipY,tiled:r.tiled,width:this.width,height:this.height}))},add(){let h=o(p=>{let m=p.frames[0].clone();r.quad&&(m=m.scale(r.quad));let E=l(p.tex,m,r.width,r.height);this.width=p.tex.width*m.w*E.x,this.height=p.tex.height*m.h*E.y,r.anim&&this.play(r.anim),i=p,a.trigger(i)},"setSpriteData"),g=Ze(t);g?g.onLoad(h):cr(()=>h(Ze(t).data))},update(){if(!s)return;let h=i.anims[s.name];if(typeof h=="number"){this.frame=h;return}if(h.speed===0)throw new Error("Sprite anim speed cannot be 0");s.timer+=Re()*this.animSpeed,s.timer>=1/s.speed&&(s.timer=0,h.from>h.to?(this.frame--,this.frame<h.to&&(s.loop?this.frame=h.from:(this.frame++,s.onEnd(),this.stop()))):(this.frame++,this.frame>h.to&&(s.loop?this.frame=h.from:(this.frame--,s.onEnd(),this.stop()))))},play(h,g={}){if(!i){a.add(()=>this.play(h,g));return}let p=i.anims[h];if(p===void 0)throw new Error(`Anim not found: ${h}`);s&&this.stop(),s=typeof p=="number"?{name:h,timer:0,loop:!1,pingpong:!1,speed:0,onEnd:()=>{}}:{name:h,timer:0,loop:g.loop??p.loop??!1,pingpong:g.pingpong??p.pingpong??!1,speed:g.speed??p.speed??10,onEnd:g.onEnd??(()=>{})},this.frame=typeof p=="number"?p:p.from,this.trigger("animStart",h)},stop(){if(!s)return;let h=s.name;s=null,this.trigger("animEnd",h)},numFrames(){return i?.frames.length??0},curAnim(){return s?.name},onAnimEnd(h){return this.on("animEnd",h)},onAnimStart(h){return this.on("animStart",h)},renderArea(){return new fe(S(0),this.width,this.height)},inspect(){if(typeof t=="string")return`"${t}"`}}}o(dr,"sprite");function zn(t,r={}){function i(s){let a=He(Object.assign(et(s),{text:s.text+"",size:s.textSize,font:s.font,width:r.width&&s.width,align:s.align,letterSpacing:s.letterSpacing,lineSpacing:s.lineSpacing,transform:s.textTransform,styles:s.textStyles}));return r.width||(s.width=a.width/(s.scale?.x||1)),s.height=a.height/(s.scale?.y||1),a}return o(i,"update"),{id:"text",text:t,textSize:r.size??Ws,font:r.font,width:r.width,height:0,align:r.align,lineSpacing:r.lineSpacing,letterSpacing:r.letterSpacing,textTransform:r.transform,textStyles:r.styles,add(){cr(()=>i(this))},draw(){je(i(this))},renderArea(){return new fe(S(0),this.width,this.height)}}}o(zn,"text");function Qn(t,r,i={}){return{id:"rect",width:t,height:r,radius:i.radius||0,draw(){Se(Object.assign(et(this),{width:this.width,height:this.height,radius:this.radius}))},renderArea(){return new fe(S(0),this.width,this.height)},inspect(){return`${Math.ceil(this.width)}, ${Math.ceil(this.height)}`}}}o(Qn,"rect");function Jn(t,r){return{id:"rect",width:t,height:r,draw(){be(Object.assign(et(this),{width:this.width,height:this.height}))},renderArea(){return new fe(S(0),this.width,this.height)},inspect(){return`${Math.ceil(this.width)}, ${Math.ceil(this.height)}`}}}o(Jn,"uvquad");function Xn(t){return{id:"circle",radius:t,draw(){$e(Object.assign(et(this),{radius:this.radius}))},renderArea(){return new fe(new y(this.anchor?0:-this.radius),this.radius*2,this.radius*2)},inspect(){return`${Math.ceil(this.radius)}`}}}o(Xn,"circle");function Zn(t=1,r=_(0,0,0)){return{id:"outline",outline:{width:t,color:r}}}o(Zn,"outline");function Yr(){return{id:"timer",wait(t,r){let i=[];r&&i.push(r);let s=0,a=this.onUpdate(()=>{s+=Re(),s>=t&&(i.forEach(l=>l()),a.cancel())});return{get paused(){return a.paused},set paused(l){a.paused=l},cancel:a.cancel,onEnd(l){i.push(l)},then(l){return this.onEnd(l),this}}},loop(t,r){let i=null,s=o(()=>{i=this.wait(t,s),r()},"newAction");return i=this.wait(0,s),{get paused(){return i.paused},set paused(a){i.paused=a},cancel:()=>i.cancel()}},tween(t,r,i,s,a=er.linear){let l=0,h=[],g=this.onUpdate(()=>{l+=Re();let p=Math.min(l/i,1);s(Ie(t,r,a(p))),p===1&&(g.cancel(),s(r),h.forEach(m=>m()))});return{get paused(){return g.paused},set paused(p){g.paused=p},onEnd(p){h.push(p)},then(p){return this.onEnd(p),this},cancel(){g.cancel()},finish(){g.cancel(),s(r),h.forEach(p=>p())}}}}}o(Yr,"timer");let vs=640,ys=65536;function Wn(t={}){let r=S(0),i=null,s=null,a=!1;return{id:"body",require:["pos","area"],jumpForce:t.jumpForce??vs,gravityScale:t.gravityScale??1,isStatic:t.isStatic??!1,mass:t.mass??1,add(){if(this.mass===0)throw new Error("Can't set body mass to 0");this.onCollideUpdate((l,h)=>{if(l.is("body")&&!h.resolved&&(this.trigger("beforePhysicsResolve",h),l.trigger("beforePhysicsResolve",h.reverse()),!h.resolved&&!(this.isStatic&&l.isStatic))){if(!this.isStatic&&!l.isStatic){let g=this.mass+l.mass;this.pos=this.pos.add(h.displacement.scale(l.mass/g)),l.pos=l.pos.add(h.displacement.scale(-this.mass/g)),this.transform=zt(this),l.transform=zt(l)}else{let g=!this.isStatic&&l.isStatic?h:h.reverse();g.source.pos=g.source.pos.add(g.displacement),g.source.transform=zt(g.source)}h.resolved=!0,this.trigger("physicsResolve",h),l.trigger("physicsResolve",h.reverse())}}),this.onPhysicsResolve(l=>{M.gravity&&(l.isBottom()&&this.isFalling()?(r.y=0,i=l.target,s=l.target.pos,a?a=!1:this.trigger("ground",i)):l.isTop()&&this.isJumping()&&(r.y=0,this.trigger("headbutt",l.target)))})},update(){if(!M.gravity||this.isStatic)return;if(a&&(i=null,s=null,this.trigger("fallOff"),a=!1),i)if(!this.isOverlapping(i)||!i.exists()||!i.is("body"))a=!0;else{!i.pos.eq(s)&&t.stickToPlatform!==!1&&this.moveBy(i.pos.sub(s)),s=i.pos;return}let l=r.y;r.y+=M.gravity*this.gravityScale*Re(),r.y=Math.min(r.y,t.maxVelocity??ys),l<0&&r.y>=0&&this.trigger("fall"),this.move(r)},onPhysicsResolve(l){return this.on("physicsResolve",l)},onBeforePhysicsResolve(l){return this.on("beforePhysicsResolve",l)},curPlatform(){return i},isGrounded(){return i!==null},isFalling(){return r.y>0},isJumping(){return r.y<0},jump(l){i=null,s=null,r.y=-l||-this.jumpForce},onGround(l){return this.on("ground",l)},onFall(l){return this.on("fall",l)},onFallOff(l){return this.on("fallOff",l)},onHeadbutt(l){return this.on("headbutt",l)}}}o(Wn,"body");function _n(t=2){let r=t;return{id:"doubleJump",require:["body"],numJumps:t,add(){this.onGround(()=>{r=this.numJumps})},doubleJump(i){r<=0||(r<this.numJumps&&this.trigger("doubleJump"),r--,this.jump(i))},onDoubleJump(i){return this.on("doubleJump",i)},inspect(){return`${r}`}}}o(_n,"doubleJump");function $n(t,r){return{id:"shader",shader:t,...typeof r=="function"?{uniform:r(),update(){this.uniform=r()}}:{uniform:r}}}o($n,"shader");function ei(){return{id:"fixed",fixed:!0}}o(ei,"fixed");function Kr(t){return{id:"stay",stay:!0,scenesToStay:t}}o(Kr,"stay");function ti(t){if(t==null)throw new Error("health() requires the initial amount of hp");let r=t;return{id:"health",hurt(i=1){this.setHP(t-i),this.trigger("hurt",i)},heal(i=1){this.setHP(t+i),this.trigger("heal",i)},hp(){return t},maxHP(){return r},setHP(i){t=i,t<=0&&this.trigger("death")},onHurt(i){return this.on("hurt",i)},onHeal(i){return this.on("heal",i)},onDeath(i){return this.on("death",i)},inspect(){return`${t}`}}}o(ti,"health");function ri(t,r={}){if(t==null)throw new Error("lifespan() requires time");let i=r.fade??0;return{id:"lifespan",async add(){await Jt(t),i>0&&this.opacity&&await gr(this.opacity,0,i,s=>this.opacity=s,er.linear),this.destroy()}}}o(ri,"lifespan");function ni(t,r,i){if(!t)throw new Error("state() requires an initial state");let s={};function a(p){s[p]||(s[p]={enter:new Te,end:new Te,update:new Te,draw:new Te})}o(a,"initStateEvents");function l(p,m,E){return a(m),s[m][p].add(E)}o(l,"on");function h(p,m,...E){a(m),s[m][p].trigger(...E)}o(h,"trigger");let g=!1;return{id:"state",state:t,enterState(p,...m){if(g=!0,r&&!r.includes(p))throw new Error(`State not found: ${p}`);let E=this.state;if(i){if(!i?.[E])return;let C=typeof i[E]=="string"?[i[E]]:i[E];if(!C.includes(p))throw new Error(`Cannot transition state from "${E}" to "${p}". Available transitions: ${C.map(z=>`"${z}"`).join(", ")}`)}h("end",E,...m),this.state=p,h("enter",p,...m),h("enter",`${E} -> ${p}`,...m)},onStateTransition(p,m,E){return l("enter",`${p} -> ${m}`,E)},onStateEnter(p,m){return l("enter",p,m)},onStateUpdate(p,m){return l("update",p,m)},onStateDraw(p,m){return l("draw",p,m)},onStateEnd(p,m){return l("end",p,m)},update(){g||(h("enter",t),g=!0),h("update",this.state)},draw(){h("draw",this.state)},inspect(){return this.state}}}o(ni,"state");function ii(t=1){let r=0,i=!1;return{require:["opacity"],add(){this.opacity=0},update(){i||(r+=Re(),this.opacity=Er(r,0,t,0,1),r>=t&&(this.opacity=1,i=!0))}}}o(ii,"fadeIn");function cr(t){U.loaded?t():M.events.on("load",t)}o(cr,"onLoad");function si(t,r){M.scenes[t]=r}o(si,"scene");function oi(t,...r){if(!M.scenes[t])throw new Error(`Scene not found: ${t}`);M.events.onOnce("frameEnd",()=>{M.events.trigger("sceneLeave",t),x.events.clear(),M.events.clear(),M.objEvents.clear(),[...M.root.children].forEach(i=>{(!i.stay||i.scenesToStay&&!i.scenesToStay.includes(t))&&M.root.remove(i)}),M.root.clearEvents(),M.cam={pos:null,scale:S(1),angle:0,shake:0,transform:new ue},M.scenes[t](...r),e.debug!==!1&&Gr(),e.burp&&qr()})}o(oi,"go");function ai(t){return M.events.on("sceneLeave",t)}o(ai,"onSceneLeave");function hi(t,r){try{return JSON.parse(window.localStorage[t])}catch{return r?(Hr(t,r),r):null}}o(hi,"getData");function Hr(t,r){window.localStorage[t]=JSON.stringify(r)}o(Hr,"setData");function jr(t){let r=t(Et);for(let i in r)Et[i]=r[i],e.global!==!1&&(window[i]=r[i]);return Et}o(jr,"plug");function Wt(){return S(Ae()/2,ve()/2)}o(Wt,"center");let Es;(t=>(t[t.None=0]="None",t[t.Left=1]="Left",t[t.Top=2]="Top",t[t.LeftTop=3]="LeftTop",t[t.Right=4]="Right",t[t.Horizontal=5]="Horizontal",t[t.RightTop=6]="RightTop",t[t.HorizontalTop=7]="HorizontalTop",t[t.Bottom=8]="Bottom",t[t.LeftBottom=9]="LeftBottom",t[t.Vertical=10]="Vertical",t[t.LeftVertical=11]="LeftVertical",t[t.RightBottom=12]="RightBottom",t[t.HorizontalBottom=13]="HorizontalBottom",t[t.RightVertical=14]="RightVertical",t[t.All=15]="All"))(Es||={});function zr(t={}){let r=S(0),i=t.isObstacle??!1,s=t.cost??0,a=t.edges??[],l=o(()=>{let g={left:1,top:2,right:4,bottom:8};return a.map(p=>g[p]||0).reduce((p,m)=>p|m,0)},"getEdgeMask"),h=l();return{id:"tile",tilePosOffset:t.offset??S(0),set tilePos(g){let p=this.getLevel();r=g.clone(),this.pos=S(this.tilePos.x*p.tileWidth(),this.tilePos.y*p.tileHeight()).add(this.tilePosOffset)},get tilePos(){return r},set isObstacle(g){i!==g&&(i=g,this.getLevel().invalidateNavigationMap())},get isObstacle(){return i},set cost(g){s!==g&&(s=g,this.getLevel().invalidateNavigationMap())},get cost(){return s},set edges(g){a=g,h=l(),this.getLevel().invalidateNavigationMap()},get edges(){return a},get edgeMask(){return h},getLevel(){return this.parent},moveLeft(){this.tilePos=this.tilePos.add(S(-1,0))},moveRight(){this.tilePos=this.tilePos.add(S(1,0))},moveUp(){this.tilePos=this.tilePos.add(S(0,-1))},moveDown(){this.tilePos=this.tilePos.add(S(0,1))}}}o(zr,"tile");function li(t,r){if(!r.tileWidth||!r.tileHeight)throw new Error("Must provide tileWidth and tileHeight.");let i=_t([Xt(r.pos??S(0))]),s=t.length,a=0,l=null,h=null,g=null,p=null,m=o(V=>V.x+V.y*a,"tile2Hash"),E=o(V=>S(Math.floor(V%a),Math.floor(V/a)),"hash2Tile"),C=o(()=>{l=[];for(let V of i.children)z(V)},"createSpatialMap"),z=o(V=>{let B=m(V.tilePos);l[B]?l[B].push(V):l[B]=[V]},"insertIntoSpatialMap"),q=o(V=>{let B=m(V.tilePos);if(l[B]){let T=l[B].indexOf(V);T>=0&&l[B].splice(T,1)}},"removeFromSpatialMap"),Z=o(()=>{let V=!1;for(let B of i.children){let T=i.pos2Tile(B.pos);(B.tilePos.x!=T.x||B.tilePos.y!=T.y)&&(V=!0,q(B),B.tilePos.x=T.x,B.tilePos.y=T.y,z(B))}V&&i.trigger("spatial_map_changed")},"updateSpatialMap"),F=o(()=>{let V=i.getSpatialMap(),B=i.numRows()*i.numColumns();h?h.length=B:h=new Array(B),h.fill(1,0,B);for(let T=0;T<V.length;T++){let P=V[T];if(P){let H=0;for(let J of P)if(J.isObstacle){H=1/0;break}else H+=J.cost;h[T]=H||1}}},"createCostMap"),N=o(()=>{let V=i.getSpatialMap(),B=i.numRows()*i.numColumns();g?g.length=B:g=new Array(B),g.fill(15,0,B);for(let T=0;T<V.length;T++){let P=V[T];if(P){let H=P.length,J=15;for(let ie=0;ie<H;ie++)J|=P[ie].edgeMask;g[T]=J}}},"createEdgeMap"),ye=o(()=>{let V=i.numRows()*i.numColumns(),B=o((P,H)=>{let J=[];for(J.push(P);J.length>0;){let ie=J.pop();D(ie).forEach(ge=>{p[ge]<0&&(p[ge]=H,J.push(ge))})}},"traverse");p?p.length=V:p=new Array(V),p.fill(-1,0,V);let T=0;for(let P=0;P<h.length;P++){if(p[P]>=0){T++;continue}B(P,T),T++}},"createConnectivityMap"),L=o((V,B)=>h[B],"getCost"),W=o((V,B)=>{let T=E(V),P=E(B);return T.dist(P)},"getHeuristic"),D=o((V,B)=>{let T=[],P=Math.floor(V%a),H=P>0&&g[V]&1&&h[V-1]!==1/0,J=V>=a&&g[V]&2&&h[V-a]!==1/0,ie=P<a-1&&g[V]&4&&h[V+1]!==1/0,ge=V<a*s-a-1&&g[V]&8&&h[V+a]!==1/0;return B?(H&&(J&&T.push(V-a-1),T.push(V-1),ge&&T.push(V+a-1)),J&&T.push(V-a),ie&&(J&&T.push(V-a+1),T.push(V+1),ge&&T.push(V+a+1)),ge&&T.push(V+a)):(H&&T.push(V-1),J&&T.push(V-a),ie&&T.push(V+1),ge&&T.push(V+a)),T},"getNeighbours"),Me={id:"level",tileWidth(){return r.tileWidth},tileHeight(){return r.tileHeight},spawn(V,...B){let T=S(...B),P=(()=>{if(typeof V=="string"){if(r.tiles[V]){if(typeof r.tiles[V]!="function")throw new Error("Level symbol def must be a function returning a component list");return r.tiles[V](T)}else if(r.wildcardTile)return r.wildcardTile(V,T)}else{if(Array.isArray(V))return V;throw new Error("Expected a symbol or a component list")}})();if(!P)return null;let H=!1,J=!1;for(let ge of P)ge.id==="tile"&&(J=!0),ge.id==="pos"&&(H=!0);H||P.push(Xt()),J||P.push(zr());let ie=i.add(P);return H&&(ie.tilePosOffset=ie.pos.clone()),ie.tilePos=T,l&&(z(ie),this.trigger("spatial_map_changed"),this.trigger("navigation_map_invalid")),ie},numColumns(){return a},numRows(){return s},levelWidth(){return a*this.tileWidth()},levelHeight(){return s*this.tileHeight()},tile2Pos(...V){return S(...V).scale(this.tileWidth(),this.tileHeight())},pos2Tile(...V){let B=S(...V);return S(Math.floor(B.x/this.tileWidth()),Math.floor(B.y/this.tileHeight()))},getSpatialMap(){return l||C(),l},onSpatialMapChanged(V){return this.on("spatial_map_changed",V)},onNavigationMapInvalid(V){return this.on("navigation_map_invalid",V)},getAt(V){l||C();let B=m(V);return l[B]||[]},update(){l&&Z()},invalidateNavigationMap(){h=null,g=null,p=null},onNavigationMapChanged(V){return this.on("navigation_map_changed",V)},getTilePath(V,B,T={}){if(h||F(),g||N(),p||ye(),V.x<0||V.x>=a||V.y<0||V.y>=s||B.x<0||B.x>=a||B.y<0||B.y>=s)return null;let P=m(V),H=m(B);if(h[H]===1/0)return null;if(P===H)return[];if(p[P]!=-1&&p[P]!==p[H])return null;let J=new ns((Le,_r)=>Le.cost<_r.cost);J.insert({cost:0,node:P});let ie=new Map;ie.set(P,P);let ge=new Map;for(ge.set(P,0);J.length!==0;){let Le=J.remove()?.node;if(Le===H)break;let _r=D(Le,T.allowDiagonals);for(let tt of _r){let $r=(ge.get(Le)||0)+L(Le,tt)+W(tt,H);(!ge.has(tt)||$r<ge.get(tt))&&(ge.set(tt,$r),J.insert({cost:$r,node:tt}),ie.set(tt,Le))}}let Wr=[],$t=H,Ms=E($t);for(Wr.push(Ms);$t!==P;){$t=ie.get($t);let Le=E($t);Wr.push(Le)}return Wr.reverse()},getPath(V,B,T={}){let P=this.tileWidth(),H=this.tileHeight(),J=this.getTilePath(this.pos2Tile(V),this.pos2Tile(B),T);return J?[V,...J.slice(1,-1).map(ie=>ie.scale(P,H).add(P/2,H/2)),B]:null}};return i.use(Me),i.onNavigationMapInvalid(()=>{i.invalidateNavigationMap(),i.trigger("navigation_map_changed")}),t.forEach((V,B)=>{let T=V.split("");a=Math.max(T.length,a),T.forEach((P,H)=>{i.spawn(P,S(H,B))})}),i}o(li,"addLevel");function ui(t={}){let r=null,i=null,s=null,a=null;return{id:"agent",require:["pos","tile"],agentSpeed:t.speed??100,allowDiagonals:t.allowDiagonals??!0,getDistanceToTarget(){return r?this.pos.dist(r):0},getNextLocation(){return i&&s?i[s]:null},getPath(){return i?i.slice():null},getTarget(){return r},isNavigationFinished(){return i?s===null:!0},isTargetReachable(){return i!==null},isTargetReached(){return r?this.pos.eq(r):!0},setTarget(l){r=l,i=this.getLevel().getPath(this.pos,r,{allowDiagonals:this.allowDiagonals}),s=i?0:null,i?(a||(a=this.getLevel().onNavigationMapChanged(()=>{i&&s!==null&&(i=this.getLevel().getPath(this.pos,r,{allowDiagonals:this.allowDiagonals}),s=i?0:null,i?this.trigger("navigation-next",this,i[s]):this.trigger("navigation-ended",this))}),this.onDestroy(()=>a.cancel())),this.trigger("navigation-started",this),this.trigger("navigation-next",this,i[s])):this.trigger("navigation-ended",this)},update(){if(i&&s!==null){if(this.pos.sdist(i[s])<2)if(s===i.length-1){this.pos=r.clone(),s=null,this.trigger("navigation-ended",this),this.trigger("target-reached",this);return}else s++,this.trigger("navigation-next",this,i[s]);this.moveTo(i[s],this.agentSpeed)}},onNavigationStarted(l){return this.on("navigation-started",l)},onNavigationNext(l){return this.on("navigation-next",l)},onNavigationEnded(l){return this.on("navigation-ended",l)},onTargetReached(l){return this.on("target-reached",l)},inspect(){return JSON.stringify({target:JSON.stringify(r),path:JSON.stringify(i)})}}}o(ui,"agent");function di(t){let r=x.canvas().captureStream(t),i=oe.ctx.createMediaStreamDestination();oe.masterNode.connect(i);let s=new MediaRecorder(r),a=[];return s.ondataavailable=l=>{l.data.size>0&&a.push(l.data)},s.onerror=()=>{oe.masterNode.disconnect(i),r.getTracks().forEach(l=>l.stop())},s.start(),{resume(){s.resume()},pause(){s.pause()},stop(){return s.stop(),oe.masterNode.disconnect(i),r.getTracks().forEach(l=>l.stop()),new Promise(l=>{s.onstop=()=>{l(new Blob(a,{type:"video/mp4"}))}})},download(l="kaboom.mp4"){this.stop().then(h=>sn(l,h))}}}o(di,"record");function ci(){return document.activeElement===x.canvas()}o(ci,"isFocused");function fi(t){t.destroy()}o(fi,"destroy");let _t=M.root.add.bind(M.root),xs=M.root.readd.bind(M.root),bs=M.root.removeAll.bind(M.root),pi=M.root.get.bind(M.root);function Qr(t=2,r=1){let i=0;return{id:"boom",require:["scale"],update(){let s=Math.sin(i*t)*r;s<0&&this.destroy(),this.scale=S(s),i+=Re()}}}o(Qr,"boom");let Ss=ke(null,Qs),Rs=ke(null,Js);function gi(t,r={}){let i=_t([Xt(t),Kr()]),s=(r.speed||1)*5,a=r.scale||1;i.add([dr(Rs),Zt(0),ur("center"),Qr(s,a),...r.comps??[]]);let l=i.add([dr(Ss),Zt(0),ur("center"),Yr(),...r.comps??[]]);return l.wait(.4/s,()=>l.use(Qr(s,a))),l.onDestroy(()=>i.destroy()),i}o(gi,"addKaboom");function Jr(){M.root.update()}o(Jr,"updateFrame");class fr{source;target;displacement;resolved=!1;constructor(r,i,s,a=!1){this.source=r,this.target=i,this.displacement=s,this.resolved=a}reverse(){return new fr(this.target,this.source,this.displacement.scale(-1),this.resolved)}hasOverlap(){return!this.displacement.isZero()}isLeft(){return this.displacement.x>0}isRight(){return this.displacement.x<0}isTop(){return this.displacement.y>0}isBottom(){return this.displacement.y<0}preventResolution(){this.resolved=!0}}o(fr,"Collision");function mi(){let t={},r=e.hashGridSize||_s,i=new ue,s=[];function a(l){if(s.push(i.clone()),l.pos&&i.translate(l.pos),l.scale&&i.scale(l.scale),l.angle&&i.rotate(l.angle),l.transform=i.clone(),l.c("area")&&!l.paused){let h=l,g=h.worldArea().bbox(),p=Math.floor(g.pos.x/r),m=Math.floor(g.pos.y/r),E=Math.ceil((g.pos.x+g.width)/r),C=Math.ceil((g.pos.y+g.height)/r),z=new Set;for(let q=p;q<=E;q++)for(let Z=m;Z<=C;Z++)if(!t[q])t[q]={},t[q][Z]=[h];else if(!t[q][Z])t[q][Z]=[h];else{let F=t[q][Z];e:for(let N of F){if(!N.exists()||z.has(N.id))continue;for(let L of h.collisionIgnore)if(N.is(L))continue e;for(let L of N.collisionIgnore)if(h.is(L))continue e;let ye=$i(h.worldArea(),N.worldArea());if(ye){let L=new fr(h,N,ye);h.trigger("collideUpdate",N,L);let W=L.reverse();W.resolved=L.resolved,N.trigger("collideUpdate",h,W)}z.add(N.id)}F.push(h)}}l.children.forEach(a),i=s.pop()}o(a,"checkObj"),a(M.root)}o(mi,"checkFrame");function wi(){let t=M.cam,r=y.fromAngle(rr(0,360)).scale(t.shake);t.shake=Ie(t.shake,0,5*Re()),t.transform=new ue().translate(Wt()).scale(t.scale).rotate(t.angle).translate((t.pos??Wt()).scale(-1).add(r)),M.root.draw(),ce()}o(wi,"drawFrame");function Ai(){let t=Fe();M.events.numListeners("loading")>0?M.events.trigger("loading",t):Ue(()=>{let r=Ae()/2,i=24,s=S(Ae()/2,ve()/2).sub(S(r/2,i/2));Se({pos:S(0),width:Ae(),height:ve(),color:_(0,0,0)}),Se({pos:s,width:r,height:i,fill:!1,outline:{width:4}}),Se({pos:s,width:r*t,height:i})})}o(Ai,"drawLoadScreen");function Xr(t,r){Ue(()=>{let i=S(8);G(),A(t);let s=He({text:r,font:Vr,size:16,pos:i,color:_(255,255,255),fixed:!0}),a=s.width+i.x*2,l=s.height+i.x*2;t.x+a>=Ae()&&A(S(-a,0)),t.y+l>=ve()&&A(S(0,-l)),Se({width:a,height:l,color:_(0,0,0),radius:4,opacity:.8,fixed:!0}),je(s),ae()})}o(Xr,"drawInspectText");function Vi(){if(re.inspect){let t=null;for(let r of M.root.get("*",{recursive:!0}))if(r.c("area")&&r.isHovering()){t=r;break}if(M.root.drawInspect(),t){let r=[],i=t.inspect();for(let s in i)i[s]?r.push(`${s}: ${i[s]}`):r.push(`${s}`);Xr(yn(jt()),r.join(`
`))}Xr(S(8),`FPS: ${re.fps()}`)}re.paused&&Ue(()=>{G(),A(Ae(),0),A(-8,8);let t=32;Se({width:t,height:t,anchor:"topright",color:_(0,0,0),opacity:.8,radius:4,fixed:!0});for(let r=1;r<=2;r++)Se({width:4,height:t*.6,anchor:"center",pos:S(-t/3*r,t*.5),color:_(255,255,255),radius:2,fixed:!0});ae()}),re.timeScale!==1&&Ue(()=>{G(),A(Ae(),ve()),A(-8,-8);let t=8,r=He({text:re.timeScale.toFixed(1),font:Vr,size:16,color:_(255,255,255),pos:S(-t),anchor:"botright",fixed:!0});Se({width:r.width+t*2+t*4,height:r.height+t*2,anchor:"botright",color:_(0,0,0),opacity:.8,radius:4,fixed:!0});for(let i=0;i<2;i++){let s=re.timeScale<1;Fr({p1:S(-r.width-t*(s?2:3.5),-t),p2:S(-r.width-t*(s?2:3.5),-t-r.height),p3:S(-r.width-t*(s?3.5:2),-t-r.height/2),pos:S(-i*t*1+(s?-t*.5:0),0),color:_(255,255,255),fixed:!0})}je(r),ae()}),re.curRecording&&Ue(()=>{G(),A(0,ve()),A(24,-24),$e({radius:12,color:_(255,0,0),opacity:rn(0,1,x.time()*4),fixed:!0}),ae()}),re.showLog&&M.logs.length>0&&Ue(()=>{G(),A(0,ve()),A(8,-8);let t=8,r=He({text:M.logs.join(`
`),font:Vr,pos:S(t,-t),anchor:"botleft",size:16,width:Ae()*.6,lineSpacing:t/2,fixed:!0,styles:{time:{color:_(127,127,127)},info:{color:_(255,255,255)},error:{color:_(255,0,127)}}});Se({width:r.width+t*2,height:r.height+t*2,anchor:"botleft",color:_(0,0,0),radius:4,opacity:.8,fixed:!0}),je(r),ae()})}o(Vi,"drawDebug"),e.debug!==!1&&Gr(),e.burp&&qr();function vi(t){M.events.on("loading",t)}o(vi,"onLoading");function yi(t){x.onResize(t)}o(yi,"onResize");function Ei(t){M.events.on("error",t)}o(Ei,"onError");function pr(t){x.run(()=>{Ue(()=>{let r=Ae(),i=ve(),s={size:36,width:r-32*2,letterSpacing:4,lineSpacing:4,font:Vr,fixed:!0};Se({width:r,height:i,color:_(0,0,255),fixed:!0});let a=He({...s,text:t.name,pos:S(32),color:_(255,128,0),fixed:!0});je(a),Ur({...s,text:t.message,pos:S(32,32+a.height+16),fixed:!0}),ae(),M.events.trigger("error",t)})})}o(pr,"handleErr");function xi(t){me.push(t)}o(xi,"onCleanup");function bi(){M.events.onOnce("frameEnd",()=>{x.quit();for(let r in vt)window.removeEventListener(r,vt[r]);u.clear(u.COLOR_BUFFER_BIT|u.DEPTH_BUFFER_BIT|u.STENCIL_BUFFER_BIT);let t=u.getParameter(u.MAX_TEXTURE_IMAGE_UNITS);for(let r=0;r<t;r++)u.activeTexture(u.TEXTURE0+r),u.bindTexture(u.TEXTURE_2D,null),u.bindTexture(u.TEXTURE_CUBE_MAP,null);u.bindBuffer(u.ARRAY_BUFFER,null),u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,null),u.bindRenderbuffer(u.RENDERBUFFER,null),u.bindFramebuffer(u.FRAMEBUFFER,null),me.forEach(r=>r()),u.deleteBuffer(w.vbuf),u.deleteBuffer(w.ibuf)})}o(bi,"quit");function gr(t,r,i,s,a=er.linear){let l=0,h=[],g=Lr(()=>{l+=Re();let p=Math.min(l/i,1);s(Ie(t,r,a(p))),p===1&&(g.cancel(),s(r),h.forEach(m=>m()))});return{get paused(){return g.paused},set paused(p){g.paused=p},onEnd(p){h.push(p)},then(p){return this.onEnd(p),this},cancel(){g.cancel()},finish(){g.cancel(),s(r),h.forEach(p=>p())}}}o(gr,"tween");let mr=!0;x.run(()=>{U.loaded||Fe()===1&&!mr&&(U.loaded=!0,M.events.trigger("load")),!U.loaded&&e.loadingScreen!==!1||mr?(mt(),Ai(),wt()):(re.paused||Jr(),mi(),mt(),wi(),e.debug!==!1&&Vi(),wt()),mr&&(mr=!1),M.events.trigger("frameEnd")});function Zr(){let t=k,r=u.drawingBufferWidth/t,i=u.drawingBufferHeight/t;if(x.isFullscreen()){let s=window.innerWidth,a=window.innerHeight,l=s/a,h=r/i;if(l>h){let g=window.innerHeight*h;w.viewport={x:(s-g)/2,y:0,width:g,height:a}}else{let g=window.innerWidth/h;w.viewport={x:0,y:(a-g)/2,width:s,height:g}}return}if(e.letterbox){if(!e.width||!e.height)throw new Error("Letterboxing requires width and height defined.");let s=r/i,a=e.width/e.height;if(s>a){let l=i*a,h=(r-l)/2;w.viewport={x:h,y:0,width:l,height:i}}else{let l=r/a,h=(i-l)/2;w.viewport={x:0,y:h,width:r,height:l}}return}if(e.stretch&&(!e.width||!e.height))throw new Error("Stretching requires width and height defined.");w.viewport={x:0,y:0,width:r,height:i}}o(Zr,"updateViewport"),x.onResize(()=>{if(x.isFullscreen())return;let t=e.width&&e.height;t&&!e.stretch&&!e.letterbox||(d.width=d.offsetWidth*k,d.height=d.offsetHeight*k,Zr(),t||(w.frameBuffer.free(),w.frameBuffer=new Pe(u.drawingBufferWidth,u.drawingBufferHeight),w.width=u.drawingBufferWidth/k,w.height=u.drawingBufferHeight/k))}),Zr();let Et={VERSION:Xs,loadRoot:Bt,loadProgress:Fe,loadSprite:ke,loadSpriteAtlas:ot,loadSound:Lt,loadBitmapFont:sr,loadFont:ir,loadShader:Ut,loadShaderURL:Nt,loadAseprite:kt,loadPedit:It,loadBean:Ot,loadJSON:Ct,load:st,getSprite:ht,getSound:lt,getFont:ut,getBitmapFont:dt,getShader:ct,getAsset:Gt,Asset:ee,SpriteData:ne,SoundData:we,width:Ae,height:ve,center:Wt,dt:Re,time:x.time,screenshot:x.screenshot,record:di,isFocused:ci,setCursor:x.setCursor,getCursor:x.getCursor,setCursorLocked:x.setCursorLocked,isCursorLocked:x.isCursorLocked,setFullscreen:x.setFullscreen,isFullscreen:x.isFullscreen,isTouchscreen:x.isTouchscreen,onLoad:cr,onLoading:vi,onResize:yi,onGamepadConnect:x.onGamepadConnect,onGamepadDisconnect:x.onGamepadDisconnect,onError:Ei,onCleanup:xi,camPos:En,camScale:xn,camRot:bn,shake:Sn,toScreen:ar,toWorld:Nr,setGravity:In,getGravity:kn,setBackground:Un,getBackground:Nn,getGamepads:x.getGamepads,add:_t,make:hr,destroy:fi,destroyAll:bs,get:pi,readd:xs,pos:Xt,scale:Zt,rotate:Ln,color:On,opacity:Gn,anchor:ur,area:jn,sprite:dr,text:zn,rect:Qn,circle:Xn,uvquad:Jn,outline:Zn,body:Wn,doubleJump:_n,shader:$n,timer:Yr,fixed:ei,stay:Kr,health:ti,lifespan:ri,z:qn,move:Kn,offscreen:Hn,follow:Yn,state:ni,fadeIn:ii,tile:zr,agent:ui,on:Ne,onUpdate:Lr,onDraw:As,onAdd:lr,onDestroy:Or,onClick:Bn,onCollide:Rn,onCollideUpdate:Mn,onCollideEnd:Tn,onHover:Fn,onHoverUpdate:Pn,onHoverEnd:Cn,onKeyDown:x.onKeyDown,onKeyPress:x.onKeyPress,onKeyPressRepeat:x.onKeyPressRepeat,onKeyRelease:x.onKeyRelease,onMouseDown:x.onMouseDown,onMousePress:x.onMousePress,onMouseRelease:x.onMouseRelease,onMouseMove:x.onMouseMove,onCharInput:x.onCharInput,onTouchStart:x.onTouchStart,onTouchMove:x.onTouchMove,onTouchEnd:x.onTouchEnd,onScroll:x.onScroll,onGamepadButtonDown:x.onGamepadButtonDown,onGamepadButtonPress:x.onGamepadButtonPress,onGamepadButtonRelease:x.onGamepadButtonRelease,onGamepadStick:x.onGamepadStick,mousePos:jt,mouseDeltaPos:x.mouseDeltaPos,isKeyDown:x.isKeyDown,isKeyPressed:x.isKeyPressed,isKeyPressedRepeat:x.isKeyPressedRepeat,isKeyReleased:x.isKeyReleased,isMouseDown:x.isMouseDown,isMousePressed:x.isMousePressed,isMouseReleased:x.isMouseReleased,isMouseMoved:x.isMouseMoved,isGamepadButtonPressed:x.isGamepadButtonPressed,isGamepadButtonDown:x.isGamepadButtonDown,isGamepadButtonReleased:x.isGamepadButtonReleased,charInputted:x.charInputted,loop:Dn,wait:Jt,play:We,volume:Yt,burp:gt,audioCtx:oe.ctx,Timer:os,Line:Oe,Rect:fe,Circle:xr,Polygon:nt,Vec2:y,Color:O,Mat4:ue,Quad:he,RNG:an,rand:rr,randi:hn,randSeed:ji,vec2:S,rgb:_,hsl2rgb:Os,quad:se,choose:Qi,chance:zi,lerp:Ie,tween:gr,easings:er,map:Er,mapc:Hi,wave:rn,deg2rad:De,rad2deg:St,testLineLine:xt,testRectRect:Ji,testRectLine:Zi,testRectPoint:nr,testCirclePolygon:_i,testLinePoint:Wi,testLineCircle:ln,drawSprite:gn,drawText:Ur,formatText:He,drawRect:Se,drawLine:Vt,drawLines:Br,drawTriangle:Fr,drawCircle:$e,drawEllipse:Pr,drawUVQuad:be,drawPolygon:Ke,drawFormattedText:je,drawMasked:mn,drawSubtracted:wn,pushTransform:G,popTransform:ae,pushTranslate:A,pushScale:b,pushRotate:K,pushMatrix:f,usePostEffect:or,debug:re,scene:si,go:oi,onSceneLeave:ai,addLevel:li,getData:hi,setData:Hr,download:Sr,downloadJSON:rs,downloadText:pn,downloadBlob:sn,plug:jr,ASCII_CHARS:Ci,canvas:x.canvas(),addKaboom:gi,LEFT:y.LEFT,RIGHT:y.RIGHT,UP:y.UP,DOWN:y.DOWN,RED:O.RED,GREEN:O.GREEN,BLUE:O.BLUE,YELLOW:O.YELLOW,MAGENTA:O.MAGENTA,CYAN:O.CYAN,WHITE:O.WHITE,BLACK:O.BLACK,quit:bi,Event:Te,EventHandler:bt,EventController:ze};if(e.plugins&&e.plugins.forEach(jr),e.global!==!1)for(let t in Et)window[t]=Et[t];return x.canvas().focus(),Et},"default");var ws=ks(ps());var ms=e=>{let n=Math.floor(e/60),d=e%60;return`${gs(n)}:${gs(d)}`},gs=e=>e.toString().padStart(2,"0");var c=cs({global:!1,canvas:document.querySelector("#game"),background:[0,0,0]}),Ve=c.isTouchscreen(),lo=[c.color(255,1,152),c.color(2,155,222)],pe=c.width(),te=c.height(),Mr=pe/2,Tr=te/2;c.loadSprite("game-bg","sprites/m-dew.jpg");c.loadSprite("bean","sprites/bean.png");c.loadSprite("crosshair","sprites/crosshair.png");c.loadSound("gun","sprites/sounds/shot.mp3");c.loadSound("shutgun","sprites/sounds/shutgun.mp3");c.loadSound("bg-music","sprites/sounds/bg-music.mp3");c.lo;c.loadFont("f1","sprites/fonts/f1.ttf");c.scene("game",()=>{let e=0,n=120,d=Date.now(),v=c.add([c.sprite("game-bg",{width:c.width(),height:c.height()}),c.opacity(.5)]),R=c.add([c.pos(10,10),c.color(2,155,222),c.pos(10,10),c.text(`Score: ${e}`,{font:"f1",size:Math.min(pe,te)*.05})]),I=c.add([c.opacity(0),c.anchor("center"),c.pos(Mr,Tr),c.color(255,1,152),c.text("Time is up!",{size:Math.min(pe,te)*.06}),c.area({cursor:"pointer"})]),Q=c.add([c.color(255,1,152),c.pos(c.width()-10,Ve?35:20),c.anchor("right"),c.text("00:00",{font:"f1",size:Math.min(pe,te)*.05})]),k=()=>{let $=Math.floor(Math.random()*(c.width()-100))+100,x=Math.floor(Math.random()*(c.height()-100))+100;if(c.get("btntarget").length<=1){let u=c.add(["btntarget",{btnid:"test",created:new Date},c.pos($,x),c.area({cursor:"pointer"}),c.circle(te*.05),c.fadeIn(.5),c.opacity(1),lo[Math.floor(Math.random()*2)]]);c.wait(5,()=>u.destroy())}};k(),c.onClick("btntarget",$=>{d=Date.now();let x=new Date($.created).getTime(),me=Date.now(),u=Math.floor((me-x)/1e3);console.log(`Time elapsed since button creation: ${(0,ws.default)(u)}`),c.play("shutgun",{volume:.5}),$.destroy(),e+=1,R.text=`Score: ${e}`,n>0&&k()});let Y=c.loop(5,()=>{n>0&&k()}),j=c.loop(1,()=>{n>0?(n--,Q.text=ms(n)):(I.opacity=1,v.opacity=.2,j.cancel(),Y.cancel(),c.wait(1,()=>c.go("game-over",{score:e})))})});c.scene("main",()=>{let e=Math.min(pe,te)*.05;c.add([c.sprite("game-bg",{width:c.width(),height:c.height()}),c.opacity(.2)]),c.add([c.text("BFS Aim Trainer",{align:"center",font:"f1",size:Math.min(pe,te)*.05+(Ve?10:5)}),c.color(2,155,222),c.pos(Mr,Tr-te*.08-(Ve?10:1)),c.anchor("center")]);let n=c.add([c.rect(c.width()/2,te*.08-10,{radius:18}),c.anchor("center"),c.pos(Mr,Tr),c.color(255,1,152),c.area({cursor:"pointer"})]);c.add([c.pos(n.pos),c.text("Start",{font:"f1",size:e-(Ve?10:5)}),c.color(255,255,255),c.anchor("center")]),n.onClick(()=>{c.play("bg-music",{loop:!0,volume:.5,seek:2}),c.go("game")})});c.scene("game-over",e=>{c.add([c.sprite("game-bg",{width:c.width(),height:c.height()}),c.opacity(.2)]);let n=c.add([c.rect(c.width()*.9,c.height()*.7,{radius:18}),c.pos(Mr,Tr),c.anchor("center"),c.color(28,28,29),c.opacity(1),c.fadeIn(.5)]);c.add([c.text("Score Board",{font:"f1",size:Math.min(pe,te)*.05}),c.pos(n.pos.x,n.pos.y/3+(Ve?50:30)),c.anchor("center"),c.color(2,155,222)]);let d=c.add([c.rect(c.width()/2,te*.08-(Ve?30:10),{radius:18}),c.anchor("center"),c.pos(n.pos.x,n.height+(Ve?5:50)),c.color(255,1,152),c.area({cursor:"pointer"})]);d.onClick(()=>c.go("game")),c.add([c.pos(d.pos),c.text("Try Again",{font:"f1",size:Math.min(pe,te)*(Ve?.05:.03)}),c.color(255,255,255),c.anchor("center")]),c.add([c.text("Score",{font:"f1",size:Math.min(pe,te)*.04}),c.pos(c.width()-c.width()*.9,c.height()-c.height()*.7),c.anchor("left"),c.color(255,1,152),c.area()]),c.add([c.text(`${e?.score??0}`,{font:"f1",size:Math.min(pe,te)*.04}),c.pos(c.width()*.9-10*2,c.height()-c.height()*.7),c.anchor("right"),c.color(2,155,222),c.area()]),c.add([c.text("MS per target",{font:"f1",size:Math.min(pe,te)*.04}),c.pos(c.width()-c.width()*.9,c.height()-c.height()*.7+(Ve?80:40)),c.anchor("left"),c.color(255,1,152),c.area()]),c.add([c.text("0ms",{font:"f1",size:Math.min(pe,te)*.04}),c.pos(c.width()*.9-10*2,c.height()-c.height()*.7+(Ve?80:40)),c.anchor("right"),c.color(2,155,222),c.area()]),c.add([c.text("Blue",{font:"f1",size:Math.min(pe,te)*.04}),c.pos(c.width()-c.width()*.9,c.height()-c.height()*.7+40*(Ve?4:2)),c.anchor("left"),c.color(255,1,152),c.area()]),c.add([c.text("0",{font:"f1",size:Math.min(pe,te)*.04}),c.pos(c.width()*.9-10*2,c.height()-c.height()*.7+40*(Ve?4:2)),c.anchor("right"),c.color(2,155,222),c.area()]),c.add([c.text("Pink",{font:"f1",size:Math.min(pe,te)*.04}),c.pos(c.width()-c.width()*.9,c.height()-c.height()*.7+40*(Ve?6:3)),c.anchor("left"),c.color(255,1,152),c.area()]),c.add([c.text("0",{font:"f1",size:Math.min(pe,te)*.04}),c.pos(c.width()*.9-10*2,c.height()-c.height()*.7+40*(Ve?6:3)),c.anchor("right"),c.color(2,155,222),c.area()]),c.add([c.text("Bonus",{font:"f1",size:Math.min(pe,te)*.04}),c.pos(c.width()-c.width()*.9,c.height()-c.height()*.7+40*(Ve?8:4)),c.anchor("left"),c.color(255,1,152),c.area()]),c.add([c.text("0",{font:"f1",size:Math.min(pe,te)*.04}),c.pos(c.width()*.9-10*2,c.height()-c.height()*.7+40*(Ve?8:4)),c.anchor("right"),c.color(2,155,222),c.area()])});var uo=()=>c.go("main");requestAnimationFrame(uo);})();
